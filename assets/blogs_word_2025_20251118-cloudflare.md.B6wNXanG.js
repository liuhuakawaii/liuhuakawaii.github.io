import{_ as s,c as i,o as a,a7 as n}from"./chunks/framework.DLSH1pMh.js";const F=JSON.parse('{"title":"Cloudflare - Pages Functions","description":"","frontmatter":{"title":"Cloudflare - Pages Functions","date":"2025-11-18T00:00:00.000Z","categories":["å‰ç«¯è¿›é˜¶","å·¥ä½œéšè®°","javascript","react"]},"headers":[],"relativePath":"blogs/word/2025/20251118-cloudflare.md","filePath":"blogs/word/2025/20251118-cloudflare.md"}'),p={name:"blogs/word/2025/20251118-cloudflare.md"},l=n(`<h1 id="cloudflare-pages-functions" tabindex="-1">Cloudflare - Pages Functions <a class="header-anchor" href="#cloudflare-pages-functions" aria-label="Permalink to &quot;Cloudflare - Pages Functions&quot;">â€‹</a></h1><h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-label="Permalink to &quot;å‰è¨€&quot;">â€‹</a></h2><p>é¦–å…ˆæˆ‘ä»¬æ¥è®²è§£ä¸€ä¸‹å¹³æ—¶å¼€å‘çš„æ—¶å€™ dev server çš„ç›¸å…³æµç¨‹</p><h3 id="pnpm-dev-æ—¶çš„è°ƒç”¨æµç¨‹-å…¸å‹æƒ…å†µ" tabindex="-1">pnpm dev æ—¶çš„è°ƒç”¨æµç¨‹ï¼ˆå…¸å‹æƒ…å†µï¼‰ <a class="header-anchor" href="#pnpm-dev-æ—¶çš„è°ƒç”¨æµç¨‹-å…¸å‹æƒ…å†µ" aria-label="Permalink to &quot;pnpm dev æ—¶çš„è°ƒç”¨æµç¨‹ï¼ˆå…¸å‹æƒ…å†µï¼‰&quot;">â€‹</a></h3><ol><li><strong>è¯·æ±‚å‘èµ·ï¼ˆæµè§ˆå™¨ â†’ Vite dev server æˆ– ç›´æ¥åˆ°ç›®æ ‡ï¼‰</strong></li></ol><ul><li>å‰ç«¯è¿è¡Œåœ¨ Vite æä¾›çš„å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ <code>http://localhost:5173</code>ï¼‰ã€‚</li><li>å‘èµ·è¯·æ±‚çš„ URL å–å†³äºä»£ç ä¸­çš„å‰ç¼€å†™æ³•ï¼š <ul><li>å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„æˆ–ä»¥ <code>/api</code> å¼€å¤´ï¼ˆä¾‹å¦‚ <code>fetch(&#39;/api/run&#39;)</code>ï¼‰ï¼Œæµè§ˆå™¨ä¼šå‘å½“å‰ originï¼ˆlocalhost:5173ï¼‰å‘èµ·è¯·æ±‚ã€‚</li><li>å¦‚æœæ˜¯å®Œæ•´å¤–éƒ¨åœ°å€ï¼ˆä¾‹å¦‚ <code>fetch(&#39;https://api.example.com/run&#39;)</code>ï¼‰ï¼Œæµè§ˆå™¨ä¼šç›´æ¥å‘è¯¥åœ°å€å‘èµ·è¯·æ±‚ï¼ˆä¼šé­é‡ CORS é™åˆ¶ï¼Œé™¤éè¿œç«¯å…è®¸ï¼‰ã€‚</li></ul></li></ul><ol start="2"><li><strong>Vite çš„ proxyï¼ˆ<code>vite.config.ts</code> çš„ <code>server.proxy</code>ï¼‰çš„ä½œç”¨</strong></li></ol><ul><li>å½“ä½ åœ¨ vite.config.ts ä¸­é…ç½®äº†ï¼š</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://api.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">api</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>æµè§ˆå™¨è¯·æ±‚ <code>http://localhost:5173/api/run</code> æ—¶ï¼ŒVite dev server ä¼šæ‹¦æˆªè¯¥è¯·æ±‚å¹¶åœ¨å¼€å‘æœåŠ¡å™¨ç«¯å°†å®ƒè½¬å‘åˆ° <code>https://api.example.com/run</code>ï¼ˆæˆ–æŒ‰ rewrite åçš„è·¯å¾„ï¼‰ã€‚</li><li>ä»£ç†å¯ä¿®æ”¹è¯·æ±‚å¤´ã€è½¬å‘ bodyï¼Œå¹¶é¿å…æµè§ˆå™¨ç«¯ CORSï¼ˆå› ä¸ºæµè§ˆå™¨åªçœ‹åˆ°å’Œ Vite çš„åŒæºè¯·æ±‚ï¼‰ã€‚</li><li>ä»£ç†ä¸ä¼šæ”¹å˜å®¢æˆ·ç«¯ä»£ç é‡Œçš„ API_PREFIX å€¼â€”â€”å®ƒåªæ˜¯å¯¹åŒ¹é…åˆ°çš„ç½‘ç»œè¯·æ±‚â€œæ›¿èº«â€è½¬å‘ã€‚</li></ul><ol start="3"><li><strong>å‰ç¼€ï¼ˆAPI_PREFIXï¼‰ä»å“ªé‡Œæ¥ï¼ˆåœ¨ Vite devï¼‰</strong></li></ol><ul><li>å¸¸è§æ¥æºï¼š <ul><li><strong>æ„å»ºæ—¶æ³¨å…¥</strong>ï¼š<code>import.meta.env.VITE_API_PREFIX</code>ï¼ˆåœ¨ dev æ¨¡å¼åŒæ ·å¯ç”¨ï¼‰â€”â€”Vite åœ¨è¿è¡Œæ—¶æŠŠ <code>import.meta.env</code> æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œå€¼æ¥è‡ª .env æ–‡ä»¶ï¼ˆè¯¦è§ env éƒ¨åˆ†ï¼‰ã€‚</li><li><strong>ç¡¬ç¼–ç </strong>ï¼šç›´æ¥å†™ &#39;<code>/api</code>&#39; æˆ– &#39;<code>/backend</code>&#39;ã€‚</li><li><strong>è¿è¡Œæ—¶æ³¨å…¥ï¼ˆå°‘è§ï¼‰</strong>ï¼šé€šè¿‡ <code>&lt;script&gt;window.__CONFIG__ = {...}&lt;/script&gt;</code> åœ¨ <code>index.html</code> ä¸­æ³¨å…¥å¹¶åœ¨å®¢æˆ·ç«¯è¯»å–ï¼ˆä¼˜ç‚¹ï¼šå¯åœ¨ä¸é‡å»ºçš„æƒ…å†µä¸‹æ”¹å˜ï¼‰ã€‚</li></ul></li></ul><ol start="4"><li>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨devé˜¶æ®µé€šè¿‡vite serveræ¥ä»£ç†æ·»åŠ headerï¼ˆæ¯”å¦‚åœ¨networké‡Œé¢éšè—tokenï¼‰ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢è¿™æ ·åš</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, loadEnv} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> react </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;path&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ProxyOptions } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(({</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mode, process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">react</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  resolve: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    alias: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;@&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./src&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  build: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;esnext&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  esbuild: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;esnext&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  optimizeDeps: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    esbuildOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;esnext&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  define: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    __APP_CONFIG__: {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      proxy: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ä»»ä½• /api/rodin çš„è¯·æ±‚éƒ½ä¼šè¢«æœ¬åœ° dev-server è½¬å‘å¹¶æ³¨å…¥ Authorization</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        target: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://api.hyper3d.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        changeOrigin: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        secure: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // configure ç”¨æ¥è®¿é—®åº•å±‚çš„ http-proxy å®ä¾‹å¹¶æ³¨å†Œäº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // proxy æ˜¯ http-proxy å®ä¾‹ï¼ˆæ¥è‡ª http-proxy-middleware / http-proxyï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          proxy.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;proxyReq&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">proxyReq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ä»…åœ¨æœ¬åœ° dev æ—¶æŠŠ token åŠ åˆ°å‘å¾€ä¸Šæ¸¸çš„è¯·æ±‚é‡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_RODIN_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              proxyReq.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_RODIN_TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProxyOptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="wrangler-pages-dev-dist-ç”¨æœ¬åœ°æ„å»ºçš„-dist-ç”±-wrangler-pages-workers-æä¾›-æ—¶çš„è°ƒç”¨æµç¨‹" tabindex="-1"><code>wrangler pages dev ./dist</code>ï¼ˆç”¨æœ¬åœ°æ„å»ºçš„ dist ç”± wrangler Pages/Workers æä¾›ï¼‰æ—¶çš„è°ƒç”¨æµç¨‹ <a class="header-anchor" href="#wrangler-pages-dev-dist-ç”¨æœ¬åœ°æ„å»ºçš„-dist-ç”±-wrangler-pages-workers-æä¾›-æ—¶çš„è°ƒç”¨æµç¨‹" aria-label="Permalink to &quot;\`wrangler pages dev ./dist\`ï¼ˆç”¨æœ¬åœ°æ„å»ºçš„ dist ç”± wrangler Pages/Workers æä¾›ï¼‰æ—¶çš„è°ƒç”¨æµç¨‹&quot;">â€‹</a></h3><p>æµè§ˆå™¨å‘å‡ºçš„è¯·æ±‚ï¼Œåªè¦åŒ…å« tokenï¼Œå°±ä¼šåœ¨ DevTools çš„ Network é‡Œå¯è§ï¼›è¦â€œçœ‹ä¸è§â€å°±å¿…é¡»è®© token ä¸ä»æµè§ˆå™¨å‘å‡ºï¼Œè€Œç”±æœåŠ¡ç«¯ï¼ˆPages Function / dev proxyï¼‰ä»£ä¸ºæ·»åŠ å¹¶è½¬å‘åˆ°ä¸Šæ¸¸ã€‚Pages Functions å¯ä»¥é€šè¿‡ç»‘å®šçš„ secrets / environment variables åœ¨è¿è¡Œæ—¶è¯»å– token å¹¶æ³¨å…¥ã€‚</p><blockquote><p>è¯´æ˜ï¼š<code>wrangler pages dev ./dist</code> ä¼šæŠŠ ./dist å½“ä½œ Pages çš„é™æ€ç«™ç‚¹æ¥æœåŠ¡ï¼›åŒæ—¶ Cloudflare Pages æ”¯æŒ Functionsï¼ˆWorkerï¼‰ ç”¨äºå¤„ç†æ¯”å¦‚ /api/* çš„è¯·æ±‚ï¼›wrangler èƒ½æŠŠä½ çš„ Worker æœ¬åœ°è¿è¡Œå¹¶ä¸ Pages é›†æˆ â€” è¡Œä¸ºå–å†³äºä½ çš„ <code>wrangler.toml</code>ã€<code>functions</code> ç›®å½•æˆ– <code>routes</code> é…ç½®ã€‚</p></blockquote><ol><li><strong>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘èµ·è¯·æ±‚ â€”â€” è·¯å¾„è§£æ</strong></li></ol><ul><li>ç¼–è¯‘åçš„å‰ç«¯ä»£ç ï¼ˆdistï¼‰é‡Œ URL æ˜¯<strong>æ„å»ºæ—¶å·²ç¡®å®šçš„</strong>ï¼š <ul><li>å¦‚æœä½ åœ¨æºç ä¸­ä½¿ç”¨ <code>import.meta.env.VITE_API_PREFIX</code>ï¼Œè¿™äº›å€¼åœ¨æ„å»ºæ—¶å°±å·²è¢«å†…è”åˆ° JS æ–‡ä»¶é‡Œï¼ˆä¾‹å¦‚æ›¿æˆ &quot;<code>/api</code>&quot; æˆ– &quot;<code>https://api.example.com</code>&quot;ï¼‰ã€‚</li><li>å› æ­¤ï¼Œå½“ wrangler pages dev æä¾› index.html ä¸é™æ€èµ„æºæ—¶ï¼Œæµè§ˆå™¨ä¼šæŒ‰æ„å»ºåå›ºåŒ–çš„ URL å‘èµ·è¯·æ±‚ã€‚</li></ul></li><li><strong>å…³é”®ç‚¹ï¼šåœ¨ dist æ¨¡å¼ä¸‹è¦æ”¹å˜ API å‰ç¼€é€šå¸¸éœ€è¦é‡æ–°æ„å»ºï¼Œé™¤éä½ é‡‡ç”¨è¿è¡Œæ—¶é…ç½®ï¼ˆwindow.CONFIGï¼‰æ‰‹æ®µã€‚</strong></li></ul><ol start="2"><li><strong>å¦‚ä½•è¢«è½¬å‘ / ç”±è°å¤„ç†</strong></li></ol><ul><li>å¯èƒ½çš„å¤„ç†æ–¹å¼ï¼š <ul><li><strong>Pages Functionsï¼ˆæˆ– Workerï¼‰å¤„ç† <code>/api/*</code></strong>ï¼šå¦‚æœä½ çš„é¡¹ç›®åœ¨ Pages è®¾ç½®äº† Functionsï¼ˆä¾‹å¦‚ functions/ ä¸‹çš„ Worker è„šæœ¬ï¼‰å¹¶ä¸” route è§„åˆ™åŒ¹é… /api/*ï¼Œé‚£ä¹ˆ wrangler pages dev ä¼šåœ¨æœ¬åœ°ç”¨ Worker æ‹¦æˆªè¿™äº›è¯·æ±‚å¹¶æ‰§è¡Œå‡½æ•°é€»è¾‘ï¼ˆå¯ä»¥è°ƒç”¨å¤–éƒ¨ APIã€æ³¨å…¥ secrets ç­‰ï¼‰ã€‚è¿™æ—¶æµè§ˆå™¨è¯·æ±‚åˆ°è¾¾æœ¬åœ° wranglerï¼Œç„¶åç”± Worker ä»£ä¸º fetch() åˆ°å¤–éƒ¨æœåŠ¡å¹¶æŠŠå“åº”è¿”å›ç»™æµè§ˆå™¨ï¼ˆWorker èƒ½å®‰å…¨è¯»å–ç»‘å®šçš„ç¯å¢ƒå˜é‡/Secretsï¼‰ã€‚</li><li><strong>ç›´æ¥è¯·æ±‚å¤–éƒ¨ä¸»æœº</strong>ï¼šå¦‚æœæ„å»ºæ—¶ API_PREFIX æŒ‡å‘ <a href="https://api.example.com" target="_blank" rel="noreferrer">https://api.example.com</a>ï¼Œæµè§ˆå™¨ä¼šç›´æ¥å‘å¤–éƒ¨ä¸»æœºå‘èµ·è¯·æ±‚ï¼ˆè¿™å—è¿œç«¯ CORS æ§åˆ¶ï¼‰ã€‚</li><li><strong>wrangler æœ¬èº«æ²¡æœ‰è‡ªåŠ¨ä»£ç†åˆ°å¤–éƒ¨</strong>ï¼šä¸åƒ Vite dev proxyï¼Œwrangler pages dev å¹¶ä¸ä¼šè‡ªåŠ¨ä¸º /api åšè¿œç«¯ä»£ç†ï¼Œé™¤éä½ æ˜ç¡®åˆ›å»ºäº†ä¸€ä¸ª Worker/Function å»è½¬å‘ã€‚</li></ul></li><li>æ€»ç»“ï¼šè¦åœ¨ wrangler pages dev ä¸‹åšåˆ°â€œæœ¬åœ°ç«¯ç»Ÿä¸€å…¥å£å¹¶è½¬å‘ APIã€éšè— tokenâ€ï¼Œä½ é€šå¸¸éœ€è¦å®ç°ä¸€ä¸ª Workerï¼ˆPages Functionï¼‰æ¥å¤„ç† /api/* å¹¶åœ¨ Worker ä¸­ç”¨ fetch() è°ƒç”¨çœŸå®åç«¯ã€‚Worker å¯ä»¥ä» wrangler.toml çš„ env / secrets ä¸­è¯»å–æ•æ„Ÿå€¼ï¼ˆä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ï¼‰ã€‚</li></ul><ol start="3"><li><strong>Env ä¸ secrets çš„è·å–</strong></li></ol><ul><li><strong>å®¢æˆ·ç«¯ envï¼ˆæ„å»ºæ—¶ï¼‰</strong>ï¼šimport.meta.env.VITE_* åœ¨æ„å»ºæ—¶è¢«æ›¿æ¢æˆå­—é¢é‡ï¼Œdist ä¸­åŒ…å«è¿™äº›å€¼ã€‚wrangler pages dev ./dist æ— æ³•åœ¨è¿è¡Œæ—¶æ›¿æ¢è¿™äº›å€¼ï¼ˆé™¤éä½ åœ¨é¡µé¢é‡Œä½¿ç”¨è¿è¡Œæ—¶æ³¨å…¥çš„ window.<strong>CONFIG</strong>ï¼‰ã€‚</li><li><strong>Worker/Pages Function çš„ env / secretï¼š</strong><ul><li>åœ¨ wrangler.toml ä¸­æˆ–é€šè¿‡ wrangler secret put è®¾ç½®çš„ secretï¼Œä¼šä»¥ç»‘å®šçš„å½¢å¼ä¼ å…¥ Worker çš„ envï¼ˆæˆ– globalï¼‰ã€‚åœ¨ Worker ä»£ç ä¸­å¯ä»¥è®¿é—®å¹¶ç”¨äºè½¬å‘è¯·æ±‚ï¼ˆä¾‹å¦‚ env.API_KEYï¼‰ã€‚</li><li>è¿™äº›å¯¹æµè§ˆå™¨ä¸å¯è§ï¼ˆå®‰å…¨ï¼‰ï¼Œé€‚åˆåœ¨ Worker é‡Œæ³¨å…¥ Authorization header åå† fetch åˆ°åç«¯ã€‚</li><li>ç¤ºä¾‹ Worker è½¬å‘ä¼ªä»£ç ï¼š</li></ul></li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`https://api.example.com\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pathname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">api</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstream, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        method: request.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_SECRET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // copy other headers as needed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body: request.body</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// or return static asset</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="ğŸ“-æ–‡ä»¶ç»“æ„" tabindex="-1">ğŸ“ æ–‡ä»¶ç»“æ„ <a class="header-anchor" href="#ğŸ“-æ–‡ä»¶ç»“æ„" aria-label="Permalink to &quot;ğŸ“ æ–‡ä»¶ç»“æ„&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>mulerun-agent/</span></span>
<span class="line"><span>â”œâ”€â”€ functions/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ [[path]].ts              â† ç»Ÿä¸€ API ç½‘å…³ (æ–°å»º)</span></span>
<span class="line"><span>â”œâ”€â”€ .dev.vars                    â† æœ¬åœ° token é…ç½®ï¼ˆä¸æäº¤ Gitï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ .env.development             â† å‰ç«¯æœ¬åœ° envï¼ˆå·²æ›´æ–°ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ .env.production              â† å‰ç«¯ç”Ÿäº§ envï¼ˆå·²æ›´æ–°ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ .gitignore                   â† æ·»åŠ  .dev.varsï¼ˆå·²æ›´æ–°ï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ QUICK_START.md               â† å¿«é€Ÿå¯åŠ¨æŒ‡å—ï¼ˆæ–°å»ºï¼‰</span></span>
<span class="line"><span>â”œâ”€â”€ PAGES_FUNCTION_GUIDE.md      â† å®Œæ•´ä½¿ç”¨æ–‡æ¡£ï¼ˆæ–°å»ºï¼‰</span></span>
<span class="line"><span>â””â”€â”€ src/</span></span>
<span class="line"><span>    â””â”€â”€ pages/Home.tsx           â† è°ƒç”¨ API çš„ç¤ºä¾‹ä½ç½®</span></span></code></pre></div><h2 id="âœ…-å·²å®Œæˆçš„ä¼˜åŒ–" tabindex="-1">âœ… å·²å®Œæˆçš„ä¼˜åŒ– <a class="header-anchor" href="#âœ…-å·²å®Œæˆçš„ä¼˜åŒ–" aria-label="Permalink to &quot;âœ… å·²å®Œæˆçš„ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="_1-å¤š-provider-è·¯ç”±æ”¯æŒ" tabindex="-1">1. <strong>å¤š Provider è·¯ç”±æ”¯æŒ</strong> <a class="header-anchor" href="#_1-å¤š-provider-è·¯ç”±æ”¯æŒ" aria-label="Permalink to &quot;1. **å¤š Provider è·¯ç”±æ”¯æŒ**&quot;">â€‹</a></h3><p>æ–°å»ºç»Ÿä¸€çš„æ ¹è·¯ç”±æ–‡ä»¶ <code>functions/[[path]].ts</code>ï¼Œæ”¯æŒï¼š</p><ul><li>âœ… <code>/api/v2/*</code> â†’ RODIN API (Bearer token)</li><li>âœ… <code>/sessions/metering*</code> â†’ MULE API (x-api-key)</li><li>âœ… è‡ªåŠ¨ CORS å¤„ç†</li><li>âœ… å®Œæ•´çš„è°ƒè¯•æ—¥å¿—</li></ul><p><strong>å…³é”®ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ä¸éœ€è¦ <code>/api</code> å‰ç¼€ä¹Ÿèƒ½è¢«æ‹¦æˆªï¼ˆ<code>/sessions/metering</code> ç›´æ¥è·¯ç”±ï¼‰</li><li>æ¯ä¸ª provider ç‹¬ç«‹ç®¡ç† tokenï¼Œä¾¿äºæƒé™éš”ç¦»</li><li>æ˜“äºæ‰©å±•æ–°çš„ provider</li></ul><h3 id="_2-å®‰å…¨çš„ç¯å¢ƒå˜é‡ç®¡ç†" tabindex="-1">2. <strong>å®‰å…¨çš„ç¯å¢ƒå˜é‡ç®¡ç†</strong> <a class="header-anchor" href="#_2-å®‰å…¨çš„ç¯å¢ƒå˜é‡ç®¡ç†" aria-label="Permalink to &quot;2. **å®‰å…¨çš„ç¯å¢ƒå˜é‡ç®¡ç†**&quot;">â€‹</a></h3><table><thead><tr><th>æ–‡ä»¶</th><th>ç”¨é€”</th><th>Git</th><th>å®‰å…¨æ€§</th></tr></thead><tbody><tr><td><code>.dev.vars</code></td><td>æœ¬åœ° wrangler ç¯å¢ƒ</td><td>âŒ ä¸æäº¤</td><td>ğŸ” æœ¬æœºä»…æœ‰</td></tr><tr><td><code>.env.development</code></td><td>å‰ç«¯æœ¬åœ°æ„å»º</td><td>âœ… æäº¤</td><td>ğŸŸ¡ éæ•æ„Ÿæ•°æ®</td></tr><tr><td><code>.env.production</code></td><td>å‰ç«¯ç”Ÿäº§æ„å»º</td><td>âœ… æäº¤</td><td>ğŸŸ¡ éæ•æ„Ÿæ•°æ®</td></tr><tr><td>Cloudflare Secrets</td><td>çº¿ä¸Š token å­˜å‚¨</td><td>N/A</td><td>ğŸ” åŠ å¯†å­˜å‚¨</td></tr></tbody></table><h3 id="_3-å®Œæ•´çš„è°ƒè¯•ä¸æ–‡æ¡£" tabindex="-1">3. <strong>å®Œæ•´çš„è°ƒè¯•ä¸æ–‡æ¡£</strong> <a class="header-anchor" href="#_3-å®Œæ•´çš„è°ƒè¯•ä¸æ–‡æ¡£" aria-label="Permalink to &quot;3. **å®Œæ•´çš„è°ƒè¯•ä¸æ–‡æ¡£**&quot;">â€‹</a></h3><ul><li>ğŸ“„ <code>QUICK_START.md</code> - ä¸€é”®å¯åŠ¨æŒ‡å—</li><li>ğŸ“„ <code>PAGES_FUNCTION_GUIDE.md</code> - å®Œæ•´éƒ¨ç½²ä¸ä½¿ç”¨æ–‡æ¡£</li><li>ğŸ“ ä»£ç æ³¨é‡Š - Pages Function ä¸­è¯¦ç»†çš„é€»è¾‘è¯´æ˜</li><li>ğŸ” ç»“æ„åŒ–æ—¥å¿— - <code>[Request]</code>ã€<code>[Proxy]</code>ã€<code>[Response]</code> ä¾¿äºæ’æŸ¥</li></ul><hr><h2 id="ğŸ”„-å·¥ä½œæµæ€»ç»“" tabindex="-1">ğŸ”„ å·¥ä½œæµæ€»ç»“ <a class="header-anchor" href="#ğŸ”„-å·¥ä½œæµæ€»ç»“" aria-label="Permalink to &quot;ğŸ”„ å·¥ä½œæµæ€»ç»“&quot;">â€‹</a></h2><h3 id="æœ¬åœ°å¼€å‘" tabindex="-1">æœ¬åœ°å¼€å‘ <a class="header-anchor" href="#æœ¬åœ°å¼€å‘" aria-label="Permalink to &quot;æœ¬åœ°å¼€å‘&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>.dev.vars (RODIN_API_TOKEN, MULE_AGENT_KEY)</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>pnpm build</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>pnpm wrangler pages dev ./dist</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>æµè§ˆå™¨è®¿é—® http://localhost:8788</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>å‰ç«¯è¯·æ±‚ /api/v2/rodin æˆ– /sessions/metering</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Pages Function æ‹¦æˆªå¹¶æ ¹æ®è·¯å¾„è½¬å‘åˆ°å¯¹åº” provider</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Token ç”±æœåŠ¡ç«¯æ·»åŠ ï¼Œæµè§ˆå™¨æ— æ³•çœ‹åˆ° âœ…</span></span></code></pre></div><h3 id="ç”Ÿäº§éƒ¨ç½²" tabindex="-1">ç”Ÿäº§éƒ¨ç½² <a class="header-anchor" href="#ç”Ÿäº§éƒ¨ç½²" aria-label="Permalink to &quot;ç”Ÿäº§éƒ¨ç½²&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ç¼–è¾‘ .env.production ä¸­çš„ VITE_API_URL</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>åœ¨ Cloudflare Pages UI é…ç½® Secrets:</span></span>
<span class="line"><span>  - RODIN_API_BASE, RODIN_API_TOKEN</span></span>
<span class="line"><span>  - MULE_API_BASE, MULE_AGENT_KEY</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>pnpm build &amp;&amp; wrangler pages deploy ./dist</span></span>
<span class="line"><span>æˆ– Git è‡ªåŠ¨éƒ¨ç½²</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Cloudflare Pages è¿è¡Œ functions/[[path]].ts</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>å‰ç«¯è¯·æ±‚åˆ° https://yoursite.pages.dev/api/v2/rodin</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Pages Function ä» Secrets è¯»å– tokenï¼Œè½¬å‘è¯·æ±‚</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>Token å®‰å…¨éšè— âœ…</span></span></code></pre></div><hr><h2 id="ğŸ“‹-å‰ç«¯ä»£ç ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ğŸ“‹ å‰ç«¯ä»£ç ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ğŸ“‹-å‰ç«¯ä»£ç ä½¿ç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;ğŸ“‹ å‰ç«¯ä»£ç ä½¿ç”¨ç¤ºä¾‹&quot;">â€‹</a></h2><h3 id="rodin-api-è°ƒç”¨" tabindex="-1">RODIN API è°ƒç”¨ <a class="header-anchor" href="#rodin-api-è°ƒç”¨" aria-label="Permalink to &quot;RODIN API è°ƒç”¨&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { request } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/services&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è°ƒç”¨ RODIN ç”Ÿæˆæ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/v2/rodin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prompt: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;A 3D cat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  settings: { quality: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;high&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>è·¯ç”±è¿‡ç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/api/v2/rodin </span></span>
<span class="line"><span>  â†’ åŒ¹é… pathname.startsWith(&#39;/api/v2&#39;)</span></span>
<span class="line"><span>  â†’ ä½¿ç”¨ RODIN_API_BASE + RODIN_API_TOKEN</span></span>
<span class="line"><span>  â†’ https://api.hyper3d.com/api/v2/rodin (Bearer Token)</span></span></code></pre></div><h3 id="mule-api-è°ƒç”¨" tabindex="-1">MULE API è°ƒç”¨ <a class="header-anchor" href="#mule-api-è°ƒç”¨" aria-label="Permalink to &quot;MULE API è°ƒç”¨&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æŸ¥è¯¢è®¡è´¹æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/sessions/metering?user_id=123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>è·¯ç”±è¿‡ç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/sessions/metering</span></span>
<span class="line"><span>  â†’ åŒ¹é… pathname.startsWith(&#39;/sessions/metering&#39;)</span></span>
<span class="line"><span>  â†’ ä½¿ç”¨ MULE_API_BASE + MULE_AGENT_KEY</span></span>
<span class="line"><span>  â†’ https://api.mulerun.com/sessions/metering (x-api-key)</span></span></code></pre></div><hr><h2 id="âš™ï¸-æ‰©å±•æ–°çš„-provider" tabindex="-1">âš™ï¸ æ‰©å±•æ–°çš„ Provider <a class="header-anchor" href="#âš™ï¸-æ‰©å±•æ–°çš„-provider" aria-label="Permalink to &quot;âš™ï¸ æ‰©å±•æ–°çš„ Provider&quot;">â€‹</a></h2><p>å¦‚æœéœ€è¦æ·»åŠ ç¬¬ä¸‰ä¸ª providerï¼ˆæ¯”å¦‚ <code>/billing/*</code> ç”¨å¦ä¸€ä¸ª APIï¼‰ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><h3 id="_1-ä¿®æ”¹-functions-path-ts" tabindex="-1">1. ä¿®æ”¹ <code>functions/[[path]].ts</code> <a class="header-anchor" href="#_1-ä¿®æ”¹-functions-path-ts" aria-label="Permalink to &quot;1. ä¿®æ”¹ \`functions/[[path]].ts\`&quot;">â€‹</a></h3><p>åœ¨ <code>getProvider()</code> å‡½æ•°ä¸­æ·»åŠ æ–°è·¯ç”±ï¼š</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ getProvider å‡½æ•°ä¸­æ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/billing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      base: env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BILLING_API_BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      token: env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BILLING_API_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      authType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bearer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æˆ– &#39;key&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pathForUpstream: pathname,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-æ›´æ–°-dev-vars" tabindex="-1">2. æ›´æ–° <code>.dev.vars</code> <a class="header-anchor" href="#_2-æ›´æ–°-dev-vars" aria-label="Permalink to &quot;2. æ›´æ–° \`.dev.vars\`&quot;">â€‹</a></h3><div class="language-dotenv vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dotenv</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>BILLING_API_BASE=&quot;https://billing.example.com&quot;</span></span>
<span class="line"><span>BILLING_API_KEY=&quot;your-billing-key&quot;</span></span></code></pre></div><h3 id="_3-çº¿ä¸Šéƒ¨ç½²" tabindex="-1">3. çº¿ä¸Šéƒ¨ç½² <a class="header-anchor" href="#_3-çº¿ä¸Šéƒ¨ç½²" aria-label="Permalink to &quot;3. çº¿ä¸Šéƒ¨ç½²&quot;">â€‹</a></h3><p>åœ¨ Cloudflare Pages UI â†’ Settings â†’ Environment variables ä¸­æ·»åŠ ç›¸åŒçš„å˜é‡ã€‚</p><h3 id="_4-å‰ç«¯ä½¿ç”¨" tabindex="-1">4. å‰ç«¯ä½¿ç”¨ <a class="header-anchor" href="#_4-å‰ç«¯ä½¿ç”¨" aria-label="Permalink to &quot;4. å‰ç«¯ä½¿ç”¨&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/billing/invoices&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><hr><h2 id="ğŸ”-å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1">ğŸ” å®‰å…¨æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ”-å®‰å…¨æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ” å®‰å…¨æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="âœ…-åº”è¯¥åš" tabindex="-1">âœ… åº”è¯¥åš <a class="header-anchor" href="#âœ…-åº”è¯¥åš" aria-label="Permalink to &quot;âœ… åº”è¯¥åš&quot;">â€‹</a></h3><ul><li>âœ… æŠŠæ‰€æœ‰ token/key æ”¾åœ¨ <code>.dev.vars</code> æˆ– Cloudflare Secretsï¼ˆä¸æäº¤ Gitï¼‰</li><li>âœ… ä½¿ç”¨ Pages Function ä½œä¸º API ç½‘å…³éšè— token</li><li>âœ… åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ ‡è®° Secrets ä¸ºåŠ å¯†ç±»å‹</li><li>âœ… å®šæœŸè½®æ¢ token</li><li>âœ… ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ token</li></ul><h3 id="âŒ-ä¸åº”è¯¥åš" tabindex="-1">âŒ ä¸åº”è¯¥åš <a class="header-anchor" href="#âŒ-ä¸åº”è¯¥åš" aria-label="Permalink to &quot;âŒ ä¸åº”è¯¥åš&quot;">â€‹</a></h3><ul><li>âŒ æŠŠ token æ”¾åœ¨ <code>VITE_*</code> æˆ– <code>.env.production</code> ï¼ˆä¼šè¢«ç¼–è¯‘è¿›å‰ç«¯ä»£ç ï¼‰</li><li>âŒ æŠŠ <code>.dev.vars</code> æäº¤åˆ° Git</li><li>âŒ åœ¨æµè§ˆå™¨ Console ä¸­è¾“å‡º token</li><li>âŒ ä½¿ç”¨ç”Ÿäº§ token åœ¨æœ¬åœ°å¼€å‘</li></ul><hr><h2 id="ğŸ“Š-å¯¹æ¯”-ä¿®æ”¹å‰å" tabindex="-1">ğŸ“Š å¯¹æ¯”ï¼šä¿®æ”¹å‰å <a class="header-anchor" href="#ğŸ“Š-å¯¹æ¯”-ä¿®æ”¹å‰å" aria-label="Permalink to &quot;ğŸ“Š å¯¹æ¯”ï¼šä¿®æ”¹å‰å&quot;">â€‹</a></h2><h3 id="ä¿®æ”¹å‰" tabindex="-1">ä¿®æ”¹å‰ <a class="header-anchor" href="#ä¿®æ”¹å‰" aria-label="Permalink to &quot;ä¿®æ”¹å‰&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>âŒ ä¸¤ä¸ªç‹¬ç«‹çš„ API è°ƒç”¨æ–¹å¼</span></span>
<span class="line"><span>âŒ /api/v2/* å’Œ /sessions/metering æ— æ³•åŒºåˆ†è®¤è¯æ–¹å¼</span></span>
<span class="line"><span>âŒ æ— æ³•åŒæ—¶éšè—å¤šä¸ª token</span></span>
<span class="line"><span>âŒ æ‰©å±•æ–° provider éœ€è¦æ–°å»ºæ–‡ä»¶</span></span>
<span class="line"><span>âŒ è·¯ç”±é€»è¾‘æ•£è½</span></span></code></pre></div><h3 id="ä¿®æ”¹å" tabindex="-1">ä¿®æ”¹å <a class="header-anchor" href="#ä¿®æ”¹å" aria-label="Permalink to &quot;ä¿®æ”¹å&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>âœ… ç»Ÿä¸€çš„ API ç½‘å…³ (functions/[[path]].ts)</span></span>
<span class="line"><span>âœ… æ”¯æŒå¤š providerï¼Œçµæ´»è·¯ç”±</span></span>
<span class="line"><span>âœ… æ¯ä¸ª provider ç‹¬ç«‹ token ç®¡ç†</span></span>
<span class="line"><span>âœ… æ‰€æœ‰ token åœ¨æœåŠ¡ç«¯ï¼Œæµè§ˆå™¨æ— æ³•çœ‹åˆ°</span></span>
<span class="line"><span>âœ… æ˜“äºæ‰©å±•ï¼Œæ·»åŠ æ–° provider åªéœ€ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span>âœ… å®Œæ•´çš„æ—¥å¿—ä¸è°ƒè¯•ä¿¡æ¯</span></span></code></pre></div><p>ä¸€ã€å…ˆç»™ç»“è®ºï¼ˆæ–¹ä¾¿å¿«é€Ÿå†³å®šï¼‰</p><p>å¦‚æœä½ å·²ç»æŠŠå‰ç«¯éƒ¨ç½²åœ¨ Cloudflare Pages ä¸”ä»…éœ€ä¸€ä¸ªç®€å•ä»£ç† /api/v2 æ¥éšè— tokenï¼šä¼˜å…ˆé€‰ Pages Functionsï¼ˆæœ€ç®€å•ã€åŒä»“éƒ¨ç½²ã€åŒåŸŸã€æ˜“è°ƒè¯•ï¼‰ã€‚</p><p>å¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„è·¯ç”±ã€å¤šä¸ªç‹¬ç«‹æœåŠ¡ã€æˆ–æƒ³æŠŠä»£ç†ç‹¬ç«‹ç®¡ç†ï¼šé€‰ Cloudflare Workerï¼ˆç‹¬ç«‹ Workerï¼‰ï¼ˆæ›´çµæ´»ã€å¯å¤ç”¨ã€é€‚åˆå¤§å‹åœºæ™¯ï¼‰ã€‚</p><p>ä¸‹é¢å…ˆæŠŠæ¦‚å¿µè®²æ¸…ï¼Œå†åˆ†åˆ«ç»™å‡ºä¸¤å¥—å®Œæ•´å¯è¿è¡Œç¤ºä¾‹ï¼ˆPages Functions ç‰ˆæœ¬ä¸ç‹¬ç«‹ Worker ç‰ˆæœ¬ï¼‰ï¼ŒåŒ…å«æœ¬åœ°è°ƒè¯•ã€å¦‚ä½•å†™ secretã€å¦‚ä½•éƒ¨ç½²ã€å¦‚ä½•åœ¨å‰ç«¯è°ƒç”¨ã€æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜æ’æŸ¥ã€‚</p><p>äºŒã€æ¦‚å¿µä¸å·®å¼‚é€Ÿè§ˆï¼ˆå›¾æ–‡å¹¶èŒ‚å£è¯­åŒ–ï¼‰</p><p>Cloudflare Workerï¼šä¸€ä¸ªç‹¬ç«‹çš„è¾¹ç¼˜ JavaScript ç¯å¢ƒï¼ˆç±»ä¼¼åœ¨å…¨çƒæœ‰å¾ˆå¤šå°å‹ serverless èŠ‚ç‚¹ï¼‰ï¼Œä½ å¯ä»¥å†™ä»»æ„åç«¯é€»è¾‘ã€ç»‘å®šä»»æ„åŸŸåæˆ– routeã€‚é€šå¸¸é€šè¿‡ wrangler ç®¡ç†ä¸éƒ¨ç½²ã€‚ ä¼˜ç‚¹ï¼šç‹¬ç«‹ã€çµæ´»ã€å¼ºï¼›ç¼ºç‚¹ï¼šå¯¹åˆå­¦è€…å¤šä¸€æ­¥é…ç½®ï¼ˆwranglerã€routeã€zone_id ç­‰ï¼‰ã€‚</p><p>Pages Functionsï¼šCloudflare Pages å†…ç½®çš„â€œå‡½æ•°ç›®å½•â€æ–¹æ¡ˆï¼Œæ„å‘³ç€ä½ çš„é™æ€ç«™ï¼ˆPagesï¼‰ä¸åç«¯å‡½æ•°æ”¾åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ &amp; ä¸€æ¬¡éƒ¨ç½²ã€‚æ–‡ä»¶æ”¾åœ¨ functions/ï¼ˆæˆ– Pages è¦æ±‚çš„è·¯å¾„ï¼‰ï¼ŒPages ä¼šè‡ªåŠ¨éƒ¨ç½²å¹¶å°†è·¯å¾„æ˜ å°„åˆ°å‡½æ•°ã€‚ ä¼˜ç‚¹ï¼šæç®€ä½“éªŒï¼ˆåŒä¸€ repoã€ä¸€é”®éƒ¨ç½²ï¼‰ï¼Œå¯¹å‰ç«¯å·¥ç¨‹å¸ˆå‹å¥½ï¼›ç¼ºç‚¹ï¼šåœ¨å¤šé¡¹ç›®/å¾®æœåŠ¡åœºæ™¯ä¸‹ä¸å¤Ÿç‹¬ç«‹ã€‚</p><p>ä¸‰ã€ç¯å¢ƒå‡†å¤‡ï¼ˆé€šç”¨ï¼‰</p><p>Node.jsï¼ˆå»ºè®® &gt;=18ï¼‰</p><p>Cloudflare å¸å·ï¼ˆå·²æ³¨å†Œï¼‰</p><p>ä½ å·²æœ‰å‰ç«¯é¡¹ç›®ï¼ˆReact + Viteï¼‰ï¼Œå¹¶ä¸”å·²éƒ¨ç½²/å‡†å¤‡éƒ¨ç½²åˆ° Cloudflare Pagesï¼ˆå¯é€‰ï¼‰</p><p>æœ¬åœ°ç»ˆç«¯ã€ç¼–è¾‘å™¨ï¼ˆVSCode ç­‰ï¼‰</p><p>å®‰è£…/ç™»å½• wranglerï¼ˆç”¨äºç‹¬ç«‹ Worker æˆ– pages secret æ“ä½œï¼‰ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler@latest</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # å¯é€‰ï¼šä¹Ÿå¯ç”¨ npx æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> login</span></span></code></pre></div><p>å››ã€é‡è¦æ¦‚å¿µï¼šVariable vs Secretï¼ˆå¿…é¡»è®°ä½ï¼‰</p><p>Variableï¼ˆenv / varsï¼‰ï¼šå¯ä»¥æ˜¯æ˜æ–‡ï¼Œç”¨äºéæ•æ„Ÿé…ç½®ï¼ˆæ„å»ºæ—¶æ³¨å…¥ã€æˆ– env è¿è¡Œæ—¶ä½¿ç”¨ï¼‰ã€‚ä¸è¦æ”¾æ•æ„Ÿ tokenã€‚</p><p>Secretï¼ˆåŠ å¯†ï¼‰ï¼šåŠ å¯†å­˜å‚¨ï¼Œåªèƒ½åœ¨ Worker/Pages Function çš„è¿è¡Œæ—¶è¯»å–ï¼Œä¸èƒ½æ³„éœ²åœ¨æ„å»ºæˆ–æµè§ˆå™¨ç«¯ã€‚æŠŠ Bearer token æ”¾åˆ° Secret é‡Œã€‚</p><p>åœ¨ CLIï¼š</p><p>Pages secretï¼ˆç»‘å®šåˆ° Pages é¡¹ç›®ï¼‰ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --project-name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-pages-projec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>Worker secretï¼ˆç‹¬ç«‹ Workerï¼‰ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MY_TOKEN&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span></span></code></pre></div><p>äº”ã€æ–¹æ¡ˆ Aï¼šPages Functionsï¼ˆæ¨èä½ çš„åœºæ™¯ï¼‰</p><p>åœºæ™¯é€‚ç”¨ï¼šä½ çš„ç½‘ç«™å·²ç»éƒ¨ç½²åœ¨ Cloudflare Pagesï¼Œæƒ³åœ¨åŒåŸŸä¸‹æŠŠ /api/v2/* ä»£ç†åˆ°åç«¯å¹¶éšè— Bearer tokenã€‚é¡µé¢ä¸å‡½æ•°æ”¾åŒä»“ï¼Œä¸€èµ·éƒ¨ç½²æœ€æ–¹ä¾¿ã€‚</p><ol><li>æ–‡ä»¶ä½ç½® &amp; çº¦å®šï¼ˆä»¥å¸¸è§ Pages é¡¹ç›®ç»“æ„ä¸ºä¾‹ï¼‰</li></ol><p>åœ¨ä½ çš„é¡¹ç›®é‡Œï¼ˆä¸ dist / build è¾“å‡ºå¹¶åˆ—ï¼‰åˆ›å»ºï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">project-root/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”œâ”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # React æºç ï¼ˆä¸å—å½±å“ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”œâ”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> functions/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   â””â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       â””â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           â””â”€</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [...path].js   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># catch-allï¼Œå¤„ç† /api/v2/*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”œâ”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â””â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> other</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files...</span></span></code></pre></div><p>functions/api/v2/[...path].jsï¼ˆå®Œæ•´ä»£ç ï¼‰ï¼š</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// functions/api/v2/[...path].js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // context åŒ…å« request, env, params, etc.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // params.path æ˜¯ catch-all æ•è·åˆ°çš„éƒ¨åˆ†ï¼ˆæ•°ç»„å½¢å¼æˆ–å­—ç¬¦ä¸²ï¼Œä¾æ® runtimeï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨ pathname æ›¿æ¢æ›´ç®€å•ï¼š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamBase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GLOBAL_UPSTREAM_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://api.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Not Found&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // æ˜ å°„è·¯å¾„ï¼š /api/v2/foo/bar -&gt; /v2/foo/bar</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">api</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">v2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upstreamBase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upstreamPath </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.search;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pages secret / environment binding</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apiToken) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Server misconfigured: API_TOKEN missing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤åˆ¶åŸè¯·æ±‚çš„ headers å’Œ body</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apiToken</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Host&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: request.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    body: (request.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GET&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;HEAD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.body,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redirect: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;manual&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamUrl, init);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç† CORSï¼ˆå¦‚æœåŒåŸŸéƒ¨ç½²ï¼Œä¸¥æ ¼é™åˆ¶ origin æ›´å®‰å…¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> respHeaders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resp.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Methods&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET,POST,PUT,DELETE,OPTIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Headers&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type,Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resp.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: resp.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    statusText: resp.statusText,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: respHeaders</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¯´æ˜è¦ç‚¹</p><p>env.API_TOKENï¼šåœ¨ Pages é¡¹ç›®é‡Œé€šè¿‡ CLI æˆ– Dashboard æŠŠ secret åŠ å…¥ï¼ˆè§ä¸‹ï¼‰ã€‚</p><p>Path catch-allï¼šPages Functions æ”¯æŒä»¥ [...] æ–¹å¼æ•è·ä»»æ„å­è·¯å¾„ã€‚</p><p>CORSï¼šç¤ºä¾‹ä½¿ç”¨ *ï¼Œä¸Šçº¿è¯·æŠŠ * æ¢æˆä½ çš„åŸŸåä»¥æ›´å®‰å…¨ï¼ˆä¾‹å¦‚ <a href="https://mulerun-rodin.pages.dev" target="_blank" rel="noreferrer">https://mulerun-rodin.pages.dev</a>ï¼‰ã€‚</p><ol start="2"><li>æŠŠ Secret åŠ å…¥ Pagesï¼ˆCLIï¼‰</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‡è®¾ä½ çš„ pages é¡¹ç›®åæ˜¯ mulerun-rodinï¼ˆåœ¨ dashboard å¯ä»¥çœ‹åˆ° project nameï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --project-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mulerun-rodin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®ƒä¼šæç¤ºä½ ç²˜è´´ tokenï¼ˆä¸ä¼šåœ¨æ§åˆ¶å°å›æ˜¾ï¼‰ï¼Œç²˜è´´åå›è½¦ä¿å­˜</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥åœ¨ Cloudflare Dashboard â†’ Pages â†’ ä½ çš„ Project â†’ Settings â†’ Variables &amp; Secrets æ·»åŠ ã€‚</p><ol start="3"><li>æœ¬åœ°å¼€å‘ä¸è°ƒè¯•</li></ol><p>Pages Functions åœ¨æœ¬åœ°å¯ç”¨ wrangler dev è°ƒè¯•ï¼Œä½†é€šå¸¸ä½ ä¼šå…ˆç”¨ Vite æœ¬åœ°å¼€å‘ï¼š</p><p>æ–¹æ³• Aï¼šåœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œ npx wrangler devï¼ˆæ¨¡æ‹Ÿ functionsï¼‰ï¼Œç„¶åæŠŠ Vite çš„ proxy æŒ‡å‘ <a href="http://127.0.0.1:8787" target="_blank" rel="noreferrer">http://127.0.0.1:8787</a>ï¼Œåœ¨ Vite ä¸­é…ç½® server.proxyï¼š</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://127.0.0.1:8787&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>æ–¹æ³• Bï¼šç›´æ¥ wrangler pages devï¼ˆå¦‚æœä½ è¦æ¨¡æ‹Ÿå®Œæ•´ Pages è¡Œä¸ºï¼Œéœ€å‚ç…§ docsï¼‰ã€‚ 4) éƒ¨ç½²</p><p>æäº¤ä»£ç åˆ°ä½ çš„ Pages ä»“åº“ï¼ˆå¦‚æœä½ ä½¿ç”¨ GitHub + Cloudflare Pagesï¼‰ï¼ŒCloudflare ä¼šåœ¨ä½  push åè‡ªåŠ¨ build &amp; deployï¼ˆä¼šè‡ªåŠ¨éƒ¨ç½² functionsï¼‰ã€‚</p><p>æˆ–ç”¨ wrangler æ‰‹åŠ¨æ“ä½œï¼ˆè§† Pages æµç¨‹è€Œå®šï¼‰ã€‚ å…­ã€æ–¹æ¡ˆ Bï¼šç‹¬ç«‹ Cloudflare Workerï¼ˆé€‚åˆæ›´å¤æ‚åœºæ™¯ï¼‰</p><p>åœºæ™¯é€‚ç”¨ï¼šä½ æƒ³æŠŠä»£ç†åšæˆç‹¬ç«‹æœåŠ¡ã€éœ€è¦è‡ªå®šä¹‰è·¯ç”±æˆ–å¤šä¸ªç«™ç‚¹å…±ç”¨åŒä¸€ä¸ªä»£ç†ï¼Œæˆ–æƒ³ç‹¬ç«‹è¿ç»´ã€‚</p><ol><li>é¡¹ç›®ç»“æ„ï¼ˆæœ€å°ï¼‰</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">my-wrangler/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”œâ”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”‚</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   â””â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â”œâ”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler.toml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  â””â”€</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span></span></code></pre></div><p>src/index.jsï¼ˆæ¨¡å—åŒ– Workerï¼‰ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// passthrough æˆ– 404</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamBase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GLOBAL_UPSTREAM_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://api.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.pathname.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">api</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;--shiki-light-font-weight:bold;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">v2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upstreamBase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upstreamPath </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.search;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> apiToken</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apiToken) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Server misconfigured: API_TOKEN missing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apiToken</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Host&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> init</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      method: request.method,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      body: (request.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GET&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;HEAD&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.body,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      redirect: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;manual&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> upstreamResp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamUrl, init);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> respHeaders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamResp.headers);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Methods&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GET,POST,PUT,DELETE,OPTIONS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    respHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Headers&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type,Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(upstreamResp.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: upstreamResp.status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      statusText: upstreamResp.statusText,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      headers: respHeaders</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><ol start="2"><li>wrangler.tomlï¼ˆæœ€å°ï¼‰</li></ol><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mulerun-rodin-proxy&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">main = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/index.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">compatibility_date = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-18&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">workers_dev = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‹¥è¦ç»‘å®šåˆ° pages åŸŸåä¸‹çš„ routeï¼Œå¯åœ¨ Dashboard é…ç½® route:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># route = &quot;mulerun-rodin.pages.dev/api/*&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># zone_id = &quot;&lt;your-zone-id&gt;&quot;</span></span></code></pre></div><ol start="3"><li>æŠŠ Secret åŠ åˆ° Worker</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;YOUR_REAL_API_TOKEN&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–åœ¨äº¤äº’ä¸­è¿è¡Œï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç„¶åç²˜è´´å€¼</span></span></code></pre></div><ol start="4"><li>æœ¬åœ°è°ƒè¯•</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/index.js</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰“å¼€ http://127.0.0.1:8787 å¹¶æµ‹è¯• /api/v2/...</span></span></code></pre></div><p>æ³¨æ„ï¼šwrangler dev æœ¬åœ°è°ƒè¯•ä¸ä¼šè‡ªåŠ¨è¯»å– Dashboard ä¸Šçš„ secretï¼Œä½ éœ€è¦ä½¿ç”¨ .dev.vars æˆ–åœ¨æœ¬åœ°æ¨¡æ‹Ÿï¼ˆè¯¦è§ä¸‹é¢ã€Œæœ¬åœ° secret ä¸ .dev.varsã€ï¼‰ã€‚ 5) éƒ¨ç½²å¹¶ç»‘å®šåˆ° Pages åŸŸåï¼ˆå¦‚æœä½ æƒ³è®© mulerun-rodin.pages.dev/api/* è§¦å‘ Workerï¼‰</p><p>æ–¹æ³• Aï¼ˆDashboardï¼‰ï¼šCloudflare Dashboard â†’ Workers â†’ é€‰æ‹©ä½ çš„ Worker â†’ Routes â†’ æ·»åŠ  mulerun-rodin.pages.dev/api/*ã€‚è¿™æ ·è®¿é—® mulerun-rodin.pages.dev/api/... æ—¶ä¼šå…ˆèµ° Workerã€‚</p><p>æ–¹æ³• Bï¼ˆwranglerï¼‰ï¼šåœ¨ wrangler.toml å¡« routeã€zone_id å¹¶ wrangler publishï¼ˆè¿™ç§æ–¹å¼é€šå¸¸éœ€è¦ zone_idï¼Œè·å– zone_id å¯åœ¨ dash æˆ– API æŸ¥æ‰¾ï¼‰ã€‚</p><p>ä¸ƒã€æœ¬åœ°å¼€å‘ç»†èŠ‚ï¼š.dev.vars ä¸ Vite æœ¬åœ°ä»£ç†</p><p>å¼€å‘æ—¶ä½ ä¸è¯¥æŠŠçœŸå® token æ”¾åˆ°ä»“åº“ã€‚ä¸¤ç§å¸¸ç”¨æ–¹æ³•ï¼š</p><ol><li>ç”¨ .dev.varsï¼ˆä»…æœ¬åœ°ã€NOT committedï¼‰æ¥æä¾› envï¼š</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">API_TOKEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;LOCAL_FAKE_TOKEN&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GLOBAL_UPSTREAM_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://api.example.com&quot;</span></span></code></pre></div><p>wrangler dev ä¼šè¯»å– .dev.vars å¹¶æ³¨å…¥ envã€‚ 2. Vite æœ¬åœ° dev æ—¶ï¼Œç”¨ server.proxy æŠŠ /api/v2 è½¬å‘åˆ° wrangler dev æœ¬åœ°åœ°å€ï¼ˆ<a href="http://127.0.0.1:8787" target="_blank" rel="noreferrer">http://127.0.0.1:8787</a>ï¼‰ï¼Œä»è€Œåœ¨æœ¬åœ°ä½“éªŒåŒåŸŸè°ƒç”¨ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proxy: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;/api/v2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://127.0.0.1:8787&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å…«ã€å‰ç«¯ï¼ˆReactï¼‰å¦‚ä½•è°ƒç”¨ä»£ç†</p><p>å‰ç«¯åªéœ€è¦åƒè°ƒç”¨æœ¬åœ° API ä¸€æ ·è°ƒç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸å¸¦ä»»ä½•æ•æ„Ÿ tokenï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// src/api.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`/api/v2/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    method: data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;POST&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;GET&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    headers: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;application/json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    body: data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    credentials: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;same-origin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res.ok) { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`HTTP \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>æ³¨æ„åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œè‹¥ä½ æ²¡æœ‰è¿è¡Œ wrangler devï¼Œå¯ä»¥åœ¨ Vite ä¸­é…ç½®ä»£ç†æŠŠ /api/v2 æŒ‡å‘çœŸå®ä¸Šæ¸¸ï¼ˆä»…ç”¨äºå¼€å‘ï¼Œåˆ‡å‹¿æŠŠçœŸå® token æ”¾åœ¨å‰ç«¯ env ä¸­ï¼‰ã€‚</p><p>ä¹ã€CORSã€å®‰å…¨ä¸æ³¨æ„äº‹é¡¹</p><p>CORSï¼šå¦‚æœä½ æŠŠå‰ç«¯ä¸ Functions/Worker æ”¾åœ¨åŒåŸŸï¼ˆpages domainï¼‰ï¼Œé€šå¸¸æ— éœ€ CORSï¼›å¦‚æœè·¨åŸŸè®¿é—®ï¼Œéœ€è¦åœ¨ Worker/Function è¿”å› Access-Control-Allow-Origin ç­‰å¤´ã€‚ç”Ÿäº§ç¯å¢ƒè¯·æ›¿æ¢ * ä¸ºå…·ä½“åŸŸåã€‚</p><p>ä¸è¦æŠŠ token å†™æˆ VITE_ å‰ç¼€çš„ envï¼šVite ä¸­ä»¥ VITE_ å¼€å¤´çš„ç¯å¢ƒå˜é‡ä¼šè¢«æ‰“åŒ…è¿›å‰ç«¯ä»£ç å¹¶èƒ½è¢«æµè§ˆå™¨çœ‹åˆ° â€”â€” ç»å¯¹ä¸è¦æ”¾æ•æ„Ÿä¿¡æ¯ã€‚</p><p>ä¸è¦æŠŠ secret å†™åˆ° wrangler.toml çš„ varsï¼šé‚£æ˜¯æ˜æ–‡ã€‚åº”è¯¥ä½¿ç”¨ wrangler secret put æˆ– Pages çš„ secret åŠŸèƒ½ã€‚</p><p>é‰´æƒï¼šWorker/Function èƒ½éšè—åç«¯ tokenï¼Œä½†ä»éœ€åšä¸šåŠ¡çº§é‰´æƒï¼ˆæ¯”å¦‚ç”¨æˆ·èº«ä»½éªŒè¯ã€è®¿é—®é¢‘ç‡æ§åˆ¶ç­‰ï¼‰ï¼Œå¦åˆ™ä»»ä½•äººéƒ½èƒ½è°ƒç”¨ä»£ç†ï¼ˆå¯ä»¥é™åˆ¶ origin / refererï¼Œä½†è¿™äº›å¤´å¯ä¼ªé€ ï¼‰ã€‚æ›´å®‰å…¨çš„æ–¹å¼æ˜¯è®©å‰ç«¯å…ˆç™»å½•å¹¶å¸¦ä¸Šç”¨æˆ· tokenï¼ˆçŸ­æœŸ tokenï¼‰è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼ŒWorker å†ç”¨æœåŠ¡å™¨ token å’Œä¸Šæ¸¸æœåŠ¡æ²Ÿé€šã€‚ åã€å®Œæ•´æ“ä½œæ¸…å•ï¼ˆCopy &amp; Pasteï¼‰</p><p>ä¸‹é¢ç»™å‡ºæœ€å¸¸ç”¨çš„ Pages Functions æµç¨‹ï¼ˆä½ é€‰æ‹© Pages Functions æ—¶ç…§åšï¼‰ï¼š</p><p>åœ¨ä½ çš„é¡¹ç›®æ ¹åˆ›å»º function æ–‡ä»¶ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> functions/api/v2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å°†ä¸Šé¢çš„ [...path].js å†…å®¹ç²˜è´´è¿›å»</span></span></code></pre></div><p>åœ¨ Cloudflare Pages Dashboard æŸ¥çœ‹ä½ çš„ project nameï¼ˆå¦‚ mulerun-rodinï¼‰ã€‚</p><p>æœ¬åœ°å¼€å‘ï¼ˆå¯é€‰ï¼‰ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»™æœ¬åœ° dev ç”¨ä¸€ä¸ªå‡çš„ tokenï¼ˆä»…æœ¬åœ°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .dev.vars</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">API_TOKEN = &quot;LOCAL_FAKE_TOKEN&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GLOBAL_UPSTREAM_BASE = &quot;https://api.example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨ wrangler devï¼ˆå¦‚æœéœ€è¦æ¨¡æ‹Ÿ functionsï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨ vite</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>åœ¨ Pages é¡¹ç›®ä¸­æ·»åŠ  Secretï¼ˆç”Ÿäº§ï¼‰ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API_TOKEN</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --project-name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mulerun-rodin</span></span></code></pre></div><p>æäº¤ä»£ç å¹¶ pushï¼ˆCloudflare Pages è‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²ï¼‰ã€‚éƒ¨ç½²åè®¿é—®ï¼š</p><p><code>https://mulerun-rodin.pages.dev/api/v2/your/path</code></p><p>å‰ç«¯è°ƒç”¨ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/v2/your/path&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‰ç«¯ä¸åŒ…å« tokenï¼ŒWorker/Function æ³¨å…¥ token å†è½¬å‘</span></span></code></pre></div><p>åä¸€ã€æ’é”™æ¸…å•ï¼ˆå¸¸è§é—®é¢˜ï¼‰</p><p>è¯·æ±‚è¿”å› 500ï¼Œæç¤º API_TOKEN missingï¼šè¯´æ˜ env æ²¡æ³¨å…¥ secretï¼Œç¡®è®¤ä½ åœ¨ Pages Dashboard æˆ–ç”¨ wrangler pages secret put æäº¤äº† API_TOKENã€‚</p><p>æœ¬åœ° wrangler dev çœ‹ä¸åˆ° secretï¼šwrangler dev ä¸ä¼šè‡ªåŠ¨è¯»å– Dashboard çš„ secretï¼›ç”¨ .dev.vars æœ¬åœ°æ¨¡æ‹Ÿæˆ–ç”¨ wrangler secret putï¼ˆè¿™ä¼šä¸Šä¼ åˆ° Cloudflareï¼‰ã€‚</p><p>CORS æŠ¥é”™ï¼ˆæµè§ˆå™¨ï¼‰ï¼šæ£€æŸ¥ Worker/Function æ˜¯å¦åœ¨ OPTIONS è¯·æ±‚ä¸­è¿”å› Access-Control-Allow-* å¤´ã€‚å¯¹ preflightï¼ˆOPTIONSï¼‰è¦è¿”å› 200 å¹¶åŒ…å«å…è®¸çš„ headersã€‚</p><p>404ï¼šæ£€æŸ¥ functions æ–‡ä»¶è·¯å¾„ä¸è¯·æ±‚è·¯å¾„æ˜¯å¦åŒ¹é…ï¼ˆPages Functions è·¯å¾„æ˜ å°„ä¸¥æ ¼ï¼Œcatch-all æ–‡ä»¶åè¦å†™å¯¹ï¼‰ã€‚</p>`,165),h=[l];function t(e,k,r,d,E,g){return a(),i("div",null,h)}const c=s(p,[["render",t]]);export{F as __pageData,c as default};
