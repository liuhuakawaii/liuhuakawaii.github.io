import{_ as s,c as i,o as a,a5 as n}from"./chunks/framework.BIhQMg0k.js";const c=JSON.parse('{"title":"NestJSæ·±å…¥æµ…å‡ºç³»åˆ— - æ ¸å¿ƒæ¦‚å¿µæ€»ç»“ä¸æœ€ä½³å®è·µ","description":"","frontmatter":{"title":"NestJSæ·±å…¥æµ…å‡ºç³»åˆ— - æ ¸å¿ƒæ¦‚å¿µæ€»ç»“ä¸æœ€ä½³å®è·µ","date":"2024-12-01T00:00:00.000Z","categories":["nest","backend"]},"headers":[],"relativePath":"blogs/backend/nest/nestç³»åˆ—æ€»ç»“.md","filePath":"blogs/backend/nest/nestç³»åˆ—æ€»ç»“.md"}'),l={name:"blogs/backend/nest/nestç³»åˆ—æ€»ç»“.md"},h=n(`<h2 id="ç³»åˆ—å›é¡¾-ğŸ“š" tabindex="-1">ç³»åˆ—å›é¡¾ ğŸ“š <a class="header-anchor" href="#ç³»åˆ—å›é¡¾-ğŸ“š" aria-label="Permalink to &quot;ç³»åˆ—å›é¡¾ ğŸ“š&quot;">â€‹</a></h2><p>åœ¨è¿™ä¸ª NestJS æ·±å…¥æµ…å‡ºç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†æ¢è®¨äº†ä»¥ä¸‹ä¸»é¢˜ï¼š</p><ol><li><p><strong>æ¡†æ¶ä»‹ç»ä¸é¡¹ç›®æ­å»º</strong> ğŸ—ï¸</p><ul><li>æ¡†æ¶ç‰¹ç‚¹å’Œä¼˜åŠ¿</li><li>é¡¹ç›®åˆå§‹åŒ–å’Œç»“æ„</li><li>åŸºæœ¬æ¦‚å¿µä»‹ç»</li></ul></li><li><p><strong>æ§åˆ¶å™¨(Controller)</strong> ğŸ®</p><ul><li>è·¯ç”±å¤„ç†</li><li>è¯·æ±‚å‚æ•°å¤„ç†</li><li>å“åº”å¤„ç†</li><li>è·¯ç”±è£…é¥°å™¨</li></ul></li><li><p><strong>æä¾›è€…(Provider)</strong> ğŸ’‰</p><ul><li>ä¾èµ–æ³¨å…¥ç³»ç»Ÿ</li><li>æœåŠ¡çš„åˆ›å»ºå’Œä½¿ç”¨</li><li>ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸ</li><li>è‡ªå®šä¹‰æä¾›è€…</li></ul></li><li><p><strong>æ¨¡å—(Module)</strong> ğŸ“¦</p><ul><li>æ¨¡å—ç»„ç»‡</li><li>ä¾èµ–ç®¡ç†</li><li>åŠ¨æ€æ¨¡å—</li><li>å…±äº«æ¨¡å—</li></ul></li><li><p><strong>ä¸­é—´ä»¶(Middleware)</strong> â›“ï¸</p><ul><li>è¯·æ±‚å¤„ç†æµç¨‹</li><li>å…¨å±€ä¸­é—´ä»¶</li><li>è·¯ç”±ä¸­é—´ä»¶</li><li>å‡½æ•°å¼ä¸­é—´ä»¶</li></ul></li><li><p><strong>è£…é¥°å™¨(Decorator)</strong> ğŸ¨</p><ul><li>å†…ç½®è£…é¥°å™¨</li><li>è‡ªå®šä¹‰è£…é¥°å™¨</li><li>å‚æ•°è£…é¥°å™¨</li><li>æ–¹æ³•è£…é¥°å™¨</li></ul></li><li><p><strong>ç®¡é“(Pipe)</strong> ğŸš°</p><ul><li>æ•°æ®è½¬æ¢</li><li>æ•°æ®éªŒè¯</li><li>å†…ç½®ç®¡é“</li><li>è‡ªå®šä¹‰ç®¡é“</li></ul></li><li><p><strong>å®ˆå«(Guard)</strong> ğŸ›¡ï¸</p><ul><li>è®¤è¯æˆæƒ</li><li>è§’è‰²æ§åˆ¶</li><li>æƒé™ç®¡ç†</li><li>è®¿é—®æ§åˆ¶</li></ul></li><li><p><strong>æ‹¦æˆªå™¨(Interceptor)</strong> ğŸ¯</p><ul><li>å“åº”è½¬æ¢</li><li>å¼‚å¸¸å¤„ç†</li><li>ç¼“å­˜å¤„ç†</li><li>æ—¥å¿—è®°å½•</li></ul></li><li><p><strong>å¼‚å¸¸è¿‡æ»¤å™¨(Exception Filter)</strong> ğŸš¨</p><ul><li>é”™è¯¯å¤„ç†</li><li>å¼‚å¸¸æ•è·</li><li>é”™è¯¯å“åº”</li><li>æ—¥å¿—è®°å½•</li></ul></li><li><p><strong>é…ç½®ç³»ç»Ÿ(Configuration)</strong> âš™ï¸</p><ul><li>ç¯å¢ƒé…ç½®</li><li>é…ç½®éªŒè¯</li><li>åŠ¨æ€é…ç½®</li><li>æ•æ„Ÿä¿¡æ¯å¤„ç†</li></ul></li></ol><h2 id="æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾-ğŸ—ºï¸" tabindex="-1">æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾ ğŸ—ºï¸ <a class="header-anchor" href="#æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾-ğŸ—ºï¸" aria-label="Permalink to &quot;æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾ ğŸ—ºï¸&quot;">â€‹</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[å®¢æˆ·ç«¯è¯·æ±‚] --&gt; B[ä¸­é—´ä»¶]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[å®ˆå«]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[æ‹¦æˆªå™¨ Before]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D --&gt; E[ç®¡é“]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    E --&gt; F[æ§åˆ¶å™¨]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    F --&gt; G[æœåŠ¡]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    G --&gt; H[æ‹¦æˆªå™¨ After]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    H --&gt; I[å¼‚å¸¸è¿‡æ»¤å™¨]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    I --&gt; J[å“åº”]</span></span></code></pre></div><h2 id="æœ€ä½³å®è·µæ€»ç»“-ğŸ’¡" tabindex="-1">æœ€ä½³å®è·µæ€»ç»“ ğŸ’¡ <a class="header-anchor" href="#æœ€ä½³å®è·µæ€»ç»“-ğŸ’¡" aria-label="Permalink to &quot;æœ€ä½³å®è·µæ€»ç»“ ğŸ’¡&quot;">â€‹</a></h2><h3 id="_1-é¡¹ç›®ç»“æ„ç»„ç»‡" tabindex="-1">1. é¡¹ç›®ç»“æ„ç»„ç»‡ <a class="header-anchor" href="#_1-é¡¹ç›®ç»“æ„ç»„ç»‡" aria-label="Permalink to &quot;1. é¡¹ç›®ç»“æ„ç»„ç»‡&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>src/</span></span>
<span class="line"><span>â”œâ”€â”€ modules/           # åŠŸèƒ½æ¨¡å—</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ users/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ auth/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ products/</span></span>
<span class="line"><span>â”œâ”€â”€ common/            # å…¬å…±åŠŸèƒ½</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ decorators/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ filters/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ guards/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ interceptors/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ pipes/</span></span>
<span class="line"><span>â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span>â”œâ”€â”€ interfaces/       # ç±»å‹å®šä¹‰</span></span>
<span class="line"><span>â””â”€â”€ main.ts          # åº”ç”¨å…¥å£</span></span></code></pre></div><h3 id="_2-ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ" tabindex="-1">2. ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ <a class="header-anchor" href="#_2-ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ" aria-label="Permalink to &quot;2. ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨æ¥å£å’Œä»¤ç‰Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IUserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreateUserDto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> USER_SERVICE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;USER_SERVICE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IUserService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å®ç°æ¥å£æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨æ¨¡å—ä¸­æä¾›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USER_SERVICE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  useClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: UserService</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-é”™è¯¯å¤„ç†ç­–ç•¥" tabindex="-1">3. é”™è¯¯å¤„ç†ç­–ç•¥ <a class="header-anchor" href="#_3-é”™è¯¯å¤„ç†ç­–ç•¥" aria-label="Permalink to &quot;3. é”™è¯¯å¤„ç†ç­–ç•¥&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ErrorResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  timestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  details</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¸šåŠ¡é”™è¯¯ä»£ç ç®¡ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ErrorCodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  VALIDATION_ERROR: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;E0001&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  UNAUTHORIZED: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;E0002&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FORBIDDEN: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;E0003&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="_4-å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1">4. å®‰å…¨æœ€ä½³å®è·µ <a class="header-anchor" href="#_4-å®‰å…¨æœ€ä½³å®è·µ" aria-label="Permalink to &quot;4. å®‰å…¨æœ€ä½³å®è·µ&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ä½¿ç”¨ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ConfigService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> envConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EnvConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> validateEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(process.env);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.envConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. å¯†ç åŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> validateUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hashedPassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(password, hashedPassword);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. è¯·æ±‚éªŒè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UsePipes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ValidationPipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ transform: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, whitelist: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() createUserDto: CreateUserDto) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-æ€§èƒ½ä¼˜åŒ–" tabindex="-1">5. æ€§èƒ½ä¼˜åŒ– <a class="header-anchor" href="#_5-æ€§èƒ½ä¼˜åŒ–" aria-label="Permalink to &quot;5. æ€§èƒ½ä¼˜åŒ–&quot;">â€‹</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. ç¼“å­˜ç­–ç•¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CacheInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> cacheManager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cached</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cacheManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cached) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cached);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      tap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cacheManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, response))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. æ•°æ®åº“ä¼˜åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProductsService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QueryDto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.productRepository</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createQueryBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;product&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">leftJoinAndSelect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;product.category&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;category&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query.conditions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">take</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query.limit)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">skip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query.offset)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMany</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="è¿›é˜¶ä¸»é¢˜-ğŸš€" tabindex="-1">è¿›é˜¶ä¸»é¢˜ ğŸš€ <a class="header-anchor" href="#è¿›é˜¶ä¸»é¢˜-ğŸš€" aria-label="Permalink to &quot;è¿›é˜¶ä¸»é¢˜ ğŸš€&quot;">â€‹</a></h2><ol><li><p><strong>å¾®æœåŠ¡æ¶æ„</strong></p><ul><li>æ¶ˆæ¯æ¨¡å¼</li><li>gRPC é›†æˆ</li><li>å¾®æœåŠ¡é€šä¿¡</li></ul></li><li><p><strong>GraphQL é›†æˆ</strong></p><ul><li>Schema å®šä¹‰</li><li>è§£æå™¨</li><li>è®¢é˜…</li></ul></li><li><p><strong>WebSocket æ”¯æŒ</strong></p><ul><li>å®æ—¶é€šä¿¡</li><li>äº‹ä»¶å¤„ç†</li><li>æˆ¿é—´ç®¡ç†</li></ul></li><li><p><strong>ä»»åŠ¡è°ƒåº¦</strong></p><ul><li>å®šæ—¶ä»»åŠ¡</li><li>é˜Ÿåˆ—å¤„ç†</li><li>åå°ä½œä¸š</li></ul></li></ol><h2 id="ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®-ğŸ“ˆ" tabindex="-1">ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®® ğŸ“ˆ <a class="header-anchor" href="#ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®-ğŸ“ˆ" aria-label="Permalink to &quot;ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®® ğŸ“ˆ&quot;">â€‹</a></h2><ol><li><p><strong>æ·±å…¥ç†è§£ TypeScript</strong></p><ul><li>ç±»å‹ç³»ç»Ÿ</li><li>è£…é¥°å™¨</li><li>æ³›å‹</li></ul></li><li><p><strong>å­¦ä¹ å“åº”å¼ç¼–ç¨‹</strong></p><ul><li>RxJS</li><li>è§‚å¯Ÿè€…æ¨¡å¼</li><li>æµå¤„ç†</li></ul></li><li><p><strong>æ•°æ®åº“ä¼˜åŒ–</strong></p><ul><li>æŸ¥è¯¢ä¼˜åŒ–</li><li>ç´¢å¼•è®¾è®¡</li><li>äº‹åŠ¡å¤„ç†</li></ul></li><li><p><strong>æµ‹è¯•å®è·µ</strong></p><ul><li>å•å…ƒæµ‹è¯•</li><li>E2E æµ‹è¯•</li><li>æµ‹è¯•è¦†ç›–ç‡</li></ul></li></ol><h2 id="ç›¸å…³èµ„æº-ğŸ“š" tabindex="-1">ç›¸å…³èµ„æº ğŸ“š <a class="header-anchor" href="#ç›¸å…³èµ„æº-ğŸ“š" aria-label="Permalink to &quot;ç›¸å…³èµ„æº ğŸ“š&quot;">â€‹</a></h2><ul><li><a href="https://docs.nestjs.com/" target="_blank" rel="noreferrer">NestJS å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/nestjs/nest/tree/master/sample" target="_blank" rel="noreferrer">NestJS ç¤ºä¾‹é¡¹ç›®</a></li><li><a href="https://www.typescriptlang.org/docs/" target="_blank" rel="noreferrer">TypeScript æ–‡æ¡£</a></li><li><a href="https://rxjs.dev/" target="_blank" rel="noreferrer">RxJS æ–‡æ¡£</a></li></ul><h2 id="ç»“è¯­-ğŸ‰" tabindex="-1">ç»“è¯­ ğŸ‰ <a class="header-anchor" href="#ç»“è¯­-ğŸ‰" aria-label="Permalink to &quot;ç»“è¯­ ğŸ‰&quot;">â€‹</a></h2><p>é€šè¿‡è¿™ä¸ªç³»åˆ—ï¼Œæˆ‘ä»¬å·²ç»å…¨é¢äº†è§£äº† NestJS çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚NestJS ä¸ä»…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒæ¨å¹¿äº†å¾ˆå¤šä¼˜ç§€çš„è®¾è®¡ç†å¿µå’Œå¼€å‘å®è·µã€‚å¸Œæœ›è¿™ä¸ªç³»åˆ—èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨ NestJS å¼€å‘ä¼ä¸šçº§åº”ç”¨ã€‚</p><p>è®°ä½ï¼Œç¼–ç¨‹æ˜¯ä¸€ä¸ªæŒç»­å­¦ä¹ çš„è¿‡ç¨‹ï¼Œä¿æŒå­¦ä¹ çš„çƒ­æƒ…ï¼Œä¸æ–­å®è·µå’Œæ¢ç´¢æ–°çš„å¯èƒ½æ€§ï¼</p>`,25),p=[h];function t(k,e,r,E,d,g){return a(),i("div",null,p)}const F=s(l,[["render",t]]);export{c as __pageData,F as default};
