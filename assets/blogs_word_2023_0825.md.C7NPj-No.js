import{_ as s,c as i,o as a,a5 as n}from"./chunks/framework.Bx-mEslM.js";const c=JSON.parse('{"title":"å‰ç«¯ç™»å½•æ–¹æ¡ˆè¯¦è§£ ğŸ”","description":"","frontmatter":{"title":"å‰ç«¯ç™»å½•æ–¹æ¡ˆè¯¦è§£ ğŸ”","date":"2023-8-25","tags":null,"categories":["javascript","å·¥ä½œéšè®°","é¢è¯•"]},"headers":[],"relativePath":"blogs/word/2023/0825.md","filePath":"blogs/word/2023/0825.md"}'),l={name:"blogs/word/2023/0825.md"},h=n(`<h1 id="å‰ç«¯ç™»å½•æ–¹æ¡ˆå…¨è§£æ-ğŸŒŸ" tabindex="-1">å‰ç«¯ç™»å½•æ–¹æ¡ˆå…¨è§£æ ğŸŒŸ <a class="header-anchor" href="#å‰ç«¯ç™»å½•æ–¹æ¡ˆå…¨è§£æ-ğŸŒŸ" aria-label="Permalink to &quot;å‰ç«¯ç™»å½•æ–¹æ¡ˆå…¨è§£æ ğŸŒŸ&quot;">â€‹</a></h1><h2 id="_1-cookie-session-ç™»å½•-ğŸª" tabindex="-1">1. Cookie + Session ç™»å½• ğŸª <a class="header-anchor" href="#_1-cookie-session-ç™»å½•-ğŸª" aria-label="Permalink to &quot;1. Cookie + Session ç™»å½• ğŸª&quot;">â€‹</a></h2><h3 id="_1-1-åŸºæœ¬æ¦‚å¿µ" tabindex="-1">1.1 åŸºæœ¬æ¦‚å¿µ <a class="header-anchor" href="#_1-1-åŸºæœ¬æ¦‚å¿µ" aria-label="Permalink to &quot;1.1 åŸºæœ¬æ¦‚å¿µ&quot;">â€‹</a></h3><ul><li>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„</li><li>Cookie æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„å°å‹æ–‡æœ¬æ•°æ®</li><li>Session æ˜¯æœåŠ¡å™¨ç«¯çš„ä¼šè¯å­˜å‚¨æœºåˆ¶</li></ul><h3 id="_1-2-å·¥ä½œæµç¨‹-âš™ï¸" tabindex="-1">1.2 å·¥ä½œæµç¨‹ âš™ï¸ <a class="header-anchor" href="#_1-2-å·¥ä½œæµç¨‹-âš™ï¸" aria-label="Permalink to &quot;1.2 å·¥ä½œæµç¨‹ âš™ï¸&quot;">â€‹</a></h3><ol><li>ç”¨æˆ·ç™»å½•æäº¤è´¦å·å¯†ç </li><li>æœåŠ¡å™¨éªŒè¯é€šè¿‡ååˆ›å»º SessionId</li><li>æœåŠ¡å™¨é€šè¿‡ Set-Cookie å“åº”å¤´å°† SessionId å†™å…¥å®¢æˆ·ç«¯ Cookie</li><li>åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie å®ç°èº«ä»½éªŒè¯</li></ol><h3 id="_1-3-ä»£ç ç¤ºä¾‹" tabindex="-1">1.3 ä»£ç ç¤ºä¾‹ <a class="header-anchor" href="#_1-3-ä»£ç ç¤ºä¾‹" aria-label="Permalink to &quot;1.3 ä»£ç ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœåŠ¡å™¨ç«¯ç¤ºä¾‹ (Express)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.body;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (éªŒè¯é€šè¿‡) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        req.session.userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.id; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½® Session</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sessionId&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, req.session.id, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            httpOnly: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            secure: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sameSite: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;strict&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ success: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_1-4-å­˜åœ¨çš„é—®é¢˜-âš ï¸" tabindex="-1">1.4 å­˜åœ¨çš„é—®é¢˜ âš ï¸ <a class="header-anchor" href="#_1-4-å­˜åœ¨çš„é—®é¢˜-âš ï¸" aria-label="Permalink to &quot;1.4 å­˜åœ¨çš„é—®é¢˜ âš ï¸&quot;">â€‹</a></h3><ol><li>æœåŠ¡å™¨éœ€å­˜å‚¨å¤§é‡ Sessionï¼Œå¢åŠ æœåŠ¡å™¨è´Ÿè½½</li><li>é›†ç¾¤ç¯å¢ƒä¸‹ Session åŒæ­¥å›°éš¾</li><li>å®¹æ˜“é­å— CSRF æ”»å‡»</li></ol><h2 id="_2-token-ç™»å½•-ğŸŸï¸" tabindex="-1">2. Token ç™»å½• ğŸŸï¸ <a class="header-anchor" href="#_2-token-ç™»å½•-ğŸŸï¸" aria-label="Permalink to &quot;2. Token ç™»å½• ğŸŸï¸&quot;">â€‹</a></h2><h3 id="_2-1-jwt-json-web-token-å®ç°" tabindex="-1">2.1 JWT (JSON Web Token) å®ç° <a class="header-anchor" href="#_2-1-jwt-json-web-token-å®ç°" aria-label="Permalink to &quot;2.1 JWT (JSON Web Token) å®ç°&quot;">â€‹</a></h3><ul><li>Header: å£°æ˜åŠ å¯†ç®—æ³•</li><li>Payload: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯</li><li>Signature: ç­¾åç¡®ä¿æ•°æ®å®Œæ•´æ€§</li></ul><h3 id="_2-2-å·¥ä½œæµç¨‹-âš™ï¸" tabindex="-1">2.2 å·¥ä½œæµç¨‹ âš™ï¸ <a class="header-anchor" href="#_2-2-å·¥ä½œæµç¨‹-âš™ï¸" aria-label="Permalink to &quot;2.2 å·¥ä½œæµç¨‹ âš™ï¸&quot;">â€‹</a></h3><ol><li>ç”¨æˆ·ç™»å½•æˆåŠŸåæœåŠ¡å™¨ç”Ÿæˆ Token</li><li>å®¢æˆ·ç«¯å­˜å‚¨ Tokenï¼ˆlocalStorage/å†…å­˜ï¼‰</li><li>è¯·æ±‚æ—¶åœ¨ Authorization å¤´æºå¸¦ Token</li></ol><h3 id="_2-3-ä»£ç ç¤ºä¾‹" tabindex="-1">2.3 ä»£ç ç¤ºä¾‹ <a class="header-anchor" href="#_2-3-ä»£ç ç¤ºä¾‹" aria-label="Permalink to &quot;2.3 ä»£ç ç¤ºä¾‹&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æœåŠ¡å™¨ç«¯ç”Ÿæˆ JWT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jwt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jsonwebtoken&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jwt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { userId: user.id },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;secret_key&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { expiresIn: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;24h&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‰ç«¯ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å­˜å‚¨ Token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// API è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  headers: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Bearer \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="_2-4-ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹-ğŸ“" tabindex="-1">2.4 ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹ ğŸ“ <a class="header-anchor" href="#_2-4-ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹-ğŸ“" aria-label="Permalink to &quot;2.4 ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹ ğŸ“&quot;">â€‹</a></h3><ul><li>âœ… æœåŠ¡å™¨æ— çŠ¶æ€ï¼Œæ˜“äºæ‰©å±•</li><li>âœ… å¯è·¨åŸŸä½¿ç”¨</li><li>âš ï¸ Token æ— æ³•ä¸»åŠ¨åºŸé™¤</li><li>âš ï¸ éœ€æ³¨æ„ Token çš„å®‰å…¨å­˜å‚¨</li></ul><h2 id="_3-sso-å•ç‚¹ç™»å½•-ğŸ”‘" tabindex="-1">3. SSO å•ç‚¹ç™»å½• ğŸ”‘ <a class="header-anchor" href="#_3-sso-å•ç‚¹ç™»å½•-ğŸ”‘" aria-label="Permalink to &quot;3. SSO å•ç‚¹ç™»å½• ğŸ”‘&quot;">â€‹</a></h2><h3 id="_3-1-å®ç°è¦ç‚¹" tabindex="-1">3.1 å®ç°è¦ç‚¹ <a class="header-anchor" href="#_3-1-å®ç°è¦ç‚¹" aria-label="Permalink to &quot;3.1 å®ç°è¦ç‚¹&quot;">â€‹</a></h3><ul><li>ç»Ÿä¸€çš„è®¤è¯ä¸­å¿ƒ</li><li>å…±äº«çš„ç™»å½•çŠ¶æ€</li><li>å¤šç³»ç»Ÿé—´çš„é€šä¿¡æœºåˆ¶</li></ul><h3 id="_3-2-æœ€ä½³å®è·µ-ğŸ’¡" tabindex="-1">3.2 æœ€ä½³å®è·µ ğŸ’¡ <a class="header-anchor" href="#_3-2-æœ€ä½³å®è·µ-ğŸ’¡" aria-label="Permalink to &quot;3.2 æœ€ä½³å®è·µ ğŸ’¡&quot;">â€‹</a></h3><ol><li>ä½¿ç”¨ HTTPS ç¡®ä¿ä¼ è¾“å®‰å…¨</li><li>å®ç°ç»Ÿä¸€çš„ç™»å‡ºæœºåˆ¶</li><li>æ³¨æ„ Cookie çš„åŸŸåè®¾ç½®</li></ol><h3 id="_3-3-ç¤ºä¾‹æµç¨‹å›¾" tabindex="-1">3.3 ç¤ºä¾‹æµç¨‹å›¾ <a class="header-anchor" href="#_3-3-ç¤ºä¾‹æµç¨‹å›¾" aria-label="Permalink to &quot;3.3 ç¤ºä¾‹æµç¨‹å›¾&quot;">â€‹</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ç”¨æˆ·-&gt;&gt;ç³»ç»ŸA: è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ç³»ç»ŸA-&gt;&gt;SSOä¸­å¿ƒ: é‡å®šå‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SSOä¸­å¿ƒ--&gt;&gt;ç”¨æˆ·: ç™»å½•é¡µé¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ç”¨æˆ·-&gt;&gt;SSOä¸­å¿ƒ: æäº¤å‡­è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SSOä¸­å¿ƒ--&gt;&gt;ç³»ç»ŸA: è¿”å›ç¥¨æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ç³»ç»ŸA-&gt;&gt;ç”¨æˆ·: ç™»å½•æˆåŠŸ</span></span></code></pre></div><h2 id="_4-oauth-ç¬¬ä¸‰æ–¹ç™»å½•-ğŸŒ" tabindex="-1">4. OAuth ç¬¬ä¸‰æ–¹ç™»å½• ğŸŒ <a class="header-anchor" href="#_4-oauth-ç¬¬ä¸‰æ–¹ç™»å½•-ğŸŒ" aria-label="Permalink to &quot;4. OAuth ç¬¬ä¸‰æ–¹ç™»å½• ğŸŒ&quot;">â€‹</a></h2><h3 id="_4-1-ä¸»æµå¹³å°æ”¯æŒ" tabindex="-1">4.1 ä¸»æµå¹³å°æ”¯æŒ <a class="header-anchor" href="#_4-1-ä¸»æµå¹³å°æ”¯æŒ" aria-label="Permalink to &quot;4.1 ä¸»æµå¹³å°æ”¯æŒ&quot;">â€‹</a></h3><ul><li>å¾®ä¿¡ ğŸ“±</li><li>GitHub ğŸ’»</li><li>Google ğŸ”</li><li>Facebook ğŸ‘¥</li></ul><h3 id="_4-2-å®‰å…¨å»ºè®®-ğŸ›¡ï¸" tabindex="-1">4.2 å®‰å…¨å»ºè®® ğŸ›¡ï¸ <a class="header-anchor" href="#_4-2-å®‰å…¨å»ºè®®-ğŸ›¡ï¸" aria-label="Permalink to &quot;4.2 å®‰å…¨å»ºè®® ğŸ›¡ï¸&quot;">â€‹</a></h3><ol><li>åŠ¡å¿…åœ¨æœåŠ¡å™¨ç«¯éªŒè¯ OAuth å›è°ƒ</li><li>ä½¿ç”¨ state å‚æ•°é˜²æ­¢ CSRF</li><li>å¦¥å–„ä¿ç®¡ appId å’Œ secret</li><li>å®ç°ç”¨æˆ·æˆæƒèŒƒå›´æ§åˆ¶</li></ol><h3 id="_4-3-ç¤ºä¾‹ä»£ç " tabindex="-1">4.3 ç¤ºä¾‹ä»£ç  <a class="header-anchor" href="#_4-3-ç¤ºä¾‹ä»£ç " aria-label="Permalink to &quot;4.3 ç¤ºä¾‹ä»£ç &quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// OAuth 2.0 å›è°ƒå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/oauth/callback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.query;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // éªŒè¯ state é˜²æ­¢ CSRF</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.session.oauthState) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ error: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;éæ³•è¯·æ±‚&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ä½¿ç”¨ code æ¢å– access_token</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getAccessToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // è·å–ç”¨æˆ·ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> userInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å¤„ç†ç™»å½•...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="æ€»ç»“-ğŸ“" tabindex="-1">æ€»ç»“ ğŸ“ <a class="header-anchor" href="#æ€»ç»“-ğŸ“" aria-label="Permalink to &quot;æ€»ç»“ ğŸ“&quot;">â€‹</a></h2><p>é€‰æ‹©åˆé€‚çš„ç™»å½•æ–¹æ¡ˆéœ€è¦è€ƒè™‘ï¼š</p><ol><li>ç³»ç»Ÿè§„æ¨¡å’Œç”¨æˆ·é‡</li><li>å®‰å…¨æ€§è¦æ±‚</li><li>è·¨åŸŸéœ€æ±‚</li><li>ç»´æŠ¤æˆæœ¬</li></ol><p>å»ºè®®ï¼š</p><ul><li>å°å‹é¡¹ç›®ï¼šToken + localStorage</li><li>å¤§å‹å•ä½“åº”ç”¨ï¼šSession + Cookie</li><li>å¾®æœåŠ¡æ¶æ„ï¼šSSO + JWT</li><li>å¼€æ”¾å¹³å°ï¼šOAuth 2.0</li></ul>`,38),t=[h];function e(k,p,r,E,d,o){return a(),i("div",null,t)}const y=s(l,[["render",e]]);export{c as __pageData,y as default};
