import{_ as s,c as i,o as a,a5 as n}from"./chunks/framework.Bx-mEslM.js";const c=JSON.parse('{"title":"ğŸ–¼ï¸ Canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ–","description":"","frontmatter":{"title":"ğŸ–¼ï¸ Canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ–","date":"2023-8-10","categories":["canvas","å·¥ä½œéšè®°","å·¥å…·è½®å­","å¯è§†åŒ–"],"tags":["å›¾åƒå¤„ç†","Canvas","å‰ç«¯ä¼˜åŒ–"]},"headers":[],"relativePath":"blogs/visualization/canvas/0810.md","filePath":"blogs/visualization/canvas/0810.md"}'),l={name:"blogs/visualization/canvas/0810.md"},h=n(`<h1 id="ğŸ¨-canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ–" tabindex="-1">ğŸ¨ Canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ– <a class="header-anchor" href="#ğŸ¨-canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ–" aria-label="Permalink to &quot;ğŸ¨ Canvaså®ç°æ™ºèƒ½å›¾åƒå‹ç¼©ä¸å°ºå¯¸ä¼˜åŒ–&quot;">â€‹</a></h1><h2 id="ğŸ“-éœ€æ±‚èƒŒæ™¯" tabindex="-1">ğŸ“ éœ€æ±‚èƒŒæ™¯ <a class="header-anchor" href="#ğŸ“-éœ€æ±‚èƒŒæ™¯" aria-label="Permalink to &quot;ğŸ“ éœ€æ±‚èƒŒæ™¯&quot;">â€‹</a></h2><p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ã€‚è¿‡å¤§çš„å›¾ç‰‡ä¼šå½±å“åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒï¼Œå› æ­¤éœ€è¦åœ¨ä¿è¯å›¾ç‰‡è´¨é‡çš„åŒæ—¶è¿›è¡Œåˆç†å‹ç¼©ã€‚</p><h2 id="ğŸ”§-æ ¸å¿ƒå®ç°" tabindex="-1">ğŸ”§ æ ¸å¿ƒå®ç° <a class="header-anchor" href="#ğŸ”§-æ ¸å¿ƒå®ç°" aria-label="Permalink to &quot;ğŸ”§ æ ¸å¿ƒå®ç°&quot;">â€‹</a></h2><h3 id="å®Œæ•´ä»£ç å®ç°" tabindex="-1">å®Œæ•´ä»£ç å®ç° <a class="header-anchor" href="#å®Œæ•´ä»£ç å®ç°" aria-label="Permalink to &quot;å®Œæ•´ä»£ç å®ç°&quot;">â€‹</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å›¾ç‰‡å‹ç¼©å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {File[]}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imgFiles</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> - å¾…å‹ç¼©çš„å›¾ç‰‡æ–‡ä»¶æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {Promise}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è¿”å›å‹ç¼©åçš„å›¾ç‰‡æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compressImg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">imgFiles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å­˜å‚¨å‹ç¼©åçš„å›¾ç‰‡å’ŒåŸå§‹æ–‡ä»¶ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> compressedImages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fileData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compressedCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        imgFiles.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">imgFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // åˆ›å»ºæ–‡ä»¶è¯»å–å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FileReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // åˆ›å»ºå›¾ç‰‡å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> img</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                img.src </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event.target.result;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                img.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onload</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // åˆ›å»ºCanvasç¯å¢ƒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;canvas&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // è®¾ç½®æœ€å¤§å°ºå¯¸é˜ˆå€¼ï¼ˆåƒç´ ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> maxThreshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> img.width;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> img.height;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // æ™ºèƒ½è°ƒæ•´å°ºå¯¸ï¼Œä¿æŒå®½é«˜æ¯”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img.width, img.height) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxThreshold) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aspectRatio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> img.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> img.height;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (img.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> img.height) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxThreshold;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxThreshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aspectRatio;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            canvas.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxThreshold;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            canvas.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxThreshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aspectRatio;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶è°ƒæ•´åçš„å›¾ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">drawImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(img, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, canvas.width, canvas.height);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // å°†ç”»å¸ƒå†…å®¹è½¬æ¢ä¸ºBlob</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBlob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            compressedImages.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            fileData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                fileName: imgFile.name, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                data: reader.result </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            compressedCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                            // æ‰€æœ‰å›¾ç‰‡å¤„ç†å®Œæˆåè¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (compressedCount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> imgFiles.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ compressedImages, fileData });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &#39;image/jpeg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¾“å‡ºæ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                        0.8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å‹ç¼©è´¨é‡ï¼ˆ0-1ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onerror</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ä»¥DataURLå½¢å¼è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readAsDataURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(imgFile);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h2 id="ğŸ”-æ ¸å¿ƒåŸç†è§£æ" tabindex="-1">ğŸ” æ ¸å¿ƒåŸç†è§£æ <a class="header-anchor" href="#ğŸ”-æ ¸å¿ƒåŸç†è§£æ" aria-label="Permalink to &quot;ğŸ” æ ¸å¿ƒåŸç†è§£æ&quot;">â€‹</a></h2><h3 id="_1-å›¾ç‰‡åŠ è½½æµç¨‹" tabindex="-1">1. å›¾ç‰‡åŠ è½½æµç¨‹ <a class="header-anchor" href="#_1-å›¾ç‰‡åŠ è½½æµç¨‹" aria-label="Permalink to &quot;1. å›¾ç‰‡åŠ è½½æµç¨‹&quot;">â€‹</a></h3><ol><li>ä½¿ç”¨<code>FileReader</code>è¯»å–æ–‡ä»¶</li><li>åˆ›å»º<code>Image</code>å¯¹è±¡åŠ è½½å›¾ç‰‡</li><li>ä½¿ç”¨<code>Canvas</code>è¿›è¡Œå¤„ç†</li></ol><h3 id="_2-æ™ºèƒ½å‹ç¼©ç­–ç•¥" tabindex="-1">2. æ™ºèƒ½å‹ç¼©ç­–ç•¥ <a class="header-anchor" href="#_2-æ™ºèƒ½å‹ç¼©ç­–ç•¥" aria-label="Permalink to &quot;2. æ™ºèƒ½å‹ç¼©ç­–ç•¥&quot;">â€‹</a></h3><ul><li><p>ğŸ“ <strong>å°ºå¯¸æ§åˆ¶</strong>ï¼š</p><ul><li>è®¾ç½®æœ€å¤§é˜ˆå€¼ï¼ˆ2048pxï¼‰</li><li>ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼Œä¿æŒå›¾ç‰‡æ¯”ä¾‹</li><li>æ™ºèƒ½åˆ¤æ–­é•¿è¾¹è¿›è¡Œé€‚é…</li></ul></li><li><p>ğŸ¯ <strong>è´¨é‡æ§åˆ¶</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>toBlob</code>æ–¹æ³•å‹ç¼©</li><li>è´¨é‡å‚æ•°è®¾ä¸º0.8ï¼ˆå¯è°ƒæ•´ï¼‰</li><li>è¾“å‡ºæ ¼å¼ä¸ºJPEGï¼ˆä½“ç§¯æ›´å°ï¼‰</li></ul></li></ul><h3 id="_3-å…³é”®æŠ€æœ¯ç‚¹" tabindex="-1">3. å…³é”®æŠ€æœ¯ç‚¹ <a class="header-anchor" href="#_3-å…³é”®æŠ€æœ¯ç‚¹" aria-label="Permalink to &quot;3. å…³é”®æŠ€æœ¯ç‚¹&quot;">â€‹</a></h3><ul><li>âš¡ <strong>å¼‚æ­¥å¤„ç†</strong>ï¼šä½¿ç”¨Promiseå¤„ç†å¤šå›¾ç‰‡å‹ç¼©</li><li>ğŸ”„ <strong>ç­‰æ¯”ç¼©æ”¾</strong>ï¼šä¿æŒå®½é«˜æ¯”ä¾‹ä¸å˜</li><li>ğŸ“Š <strong>æ‰¹é‡å¤„ç†</strong>ï¼šæ”¯æŒå¤šå›¾ç‰‡åŒæ—¶å‹ç¼©</li></ul><h2 id="ğŸ“ˆ-ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ğŸ“ˆ ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ğŸ“ˆ-ä½¿ç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;ğŸ“ˆ ä½¿ç”¨ç¤ºä¾‹&quot;">â€‹</a></h2><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å•å›¾ç‰‡å‹ç¼©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleSingleImage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compressImg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([file]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å‹ç¼©åçš„å›¾ç‰‡:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result.compressedImages[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å‹ç¼©å¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤šå›¾ç‰‡å‹ç¼©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleMultipleImages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compressImg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Array.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(files));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å‹ç¼©åçš„å›¾ç‰‡ç»„:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result.compressedImages);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å‹ç¼©å¤±è´¥:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><h2 id="ğŸ’¡-ä¼˜åŒ–å»ºè®®" tabindex="-1">ğŸ’¡ ä¼˜åŒ–å»ºè®® <a class="header-anchor" href="#ğŸ’¡-ä¼˜åŒ–å»ºè®®" aria-label="Permalink to &quot;ğŸ’¡ ä¼˜åŒ–å»ºè®®&quot;">â€‹</a></h2><ol><li><p><strong>å†…å­˜ä¼˜åŒ–</strong></p><ul><li>åŠæ—¶é‡Šæ”¾Canvaså¯¹è±¡</li><li>å¤„ç†å¤§é‡å›¾ç‰‡æ—¶è€ƒè™‘åˆ†æ‰¹å¤„ç†</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p><ul><li>å¯ä»¥æ·»åŠ Workerå¤„ç†å¤§é‡å›¾ç‰‡</li><li>è€ƒè™‘ä½¿ç”¨<code>createImageBitmap</code>ä¼˜åŒ–æ€§èƒ½</li></ul></li><li><p><strong>ä½“éªŒä¼˜åŒ–</strong></p><ul><li>æ·»åŠ å‹ç¼©è¿›åº¦æç¤º</li><li>æä¾›å‹ç¼©è´¨é‡å‚æ•°é…ç½®é€‰é¡¹</li></ul></li></ol><h2 id="ğŸ¯-åº”ç”¨åœºæ™¯" tabindex="-1">ğŸ¯ åº”ç”¨åœºæ™¯ <a class="header-anchor" href="#ğŸ¯-åº”ç”¨åœºæ™¯" aria-label="Permalink to &quot;ğŸ¯ åº”ç”¨åœºæ™¯&quot;">â€‹</a></h2><ul><li>ğŸ“± ç§»åŠ¨ç«¯å›¾ç‰‡ä¸Šä¼ </li><li>ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆä¼˜åŒ–</li><li>ğŸ“‚ ç›¸å†Œæ‰¹é‡å¤„ç†</li><li>ğŸš€ å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li></ul><h2 id="ğŸ“š-å‚è€ƒèµ„æ–™" tabindex="-1">ğŸ“š å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#ğŸ“š-å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;ğŸ“š å‚è€ƒèµ„æ–™&quot;">â€‹</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API" target="_blank" rel="noreferrer">Canvas API</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noreferrer">FileReader API</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noreferrer">Blob API</a></li></ul>`,21),k=[h];function p(t,e,E,r,d,g){return a(),i("div",null,k)}const o=s(l,[["render",p]]);export{c as __pageData,o as default};
