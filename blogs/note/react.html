<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React学习笔记 | 小董的Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.webp">
    <meta name="description" content="my-blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.2952188d.css" as="style"><link rel="preload" href="/assets/js/app.6977d595.js" as="script"><link rel="preload" href="/assets/js/4.94eb5d8a.js" as="script"><link rel="preload" href="/assets/js/1.e6e6e62e.js" as="script"><link rel="preload" href="/assets/js/20.daa8a4dd.js" as="script"><link rel="prefetch" href="/assets/js/10.09fb3ca6.js"><link rel="prefetch" href="/assets/js/100.e22ba2a6.js"><link rel="prefetch" href="/assets/js/101.5154a77a.js"><link rel="prefetch" href="/assets/js/102.ecc31d30.js"><link rel="prefetch" href="/assets/js/103.f769adff.js"><link rel="prefetch" href="/assets/js/104.ba33e168.js"><link rel="prefetch" href="/assets/js/105.fc8da5d4.js"><link rel="prefetch" href="/assets/js/106.d1b4f206.js"><link rel="prefetch" href="/assets/js/107.08247260.js"><link rel="prefetch" href="/assets/js/108.5605f12f.js"><link rel="prefetch" href="/assets/js/109.1596e286.js"><link rel="prefetch" href="/assets/js/11.e3bbdf8f.js"><link rel="prefetch" href="/assets/js/110.ed3cff6c.js"><link rel="prefetch" href="/assets/js/111.f7356ca2.js"><link rel="prefetch" href="/assets/js/112.a92bcf10.js"><link rel="prefetch" href="/assets/js/113.b7d088f7.js"><link rel="prefetch" href="/assets/js/114.18dfb89a.js"><link rel="prefetch" href="/assets/js/115.ba5b29c8.js"><link rel="prefetch" href="/assets/js/116.ed7fe13d.js"><link rel="prefetch" href="/assets/js/117.f37957ba.js"><link rel="prefetch" href="/assets/js/118.50703791.js"><link rel="prefetch" href="/assets/js/119.f0ebbd4b.js"><link rel="prefetch" href="/assets/js/12.e38edda3.js"><link rel="prefetch" href="/assets/js/120.bcc8f765.js"><link rel="prefetch" href="/assets/js/121.22f25716.js"><link rel="prefetch" href="/assets/js/122.3d04d694.js"><link rel="prefetch" href="/assets/js/123.be4fd1a2.js"><link rel="prefetch" href="/assets/js/124.4d6e12be.js"><link rel="prefetch" href="/assets/js/125.ac95fdd9.js"><link rel="prefetch" href="/assets/js/126.778044dd.js"><link rel="prefetch" href="/assets/js/127.5d4f7462.js"><link rel="prefetch" href="/assets/js/128.f6d0b1aa.js"><link rel="prefetch" href="/assets/js/129.63dcdc1a.js"><link rel="prefetch" href="/assets/js/13.60815096.js"><link rel="prefetch" href="/assets/js/130.d46d45dd.js"><link rel="prefetch" href="/assets/js/131.adab7473.js"><link rel="prefetch" href="/assets/js/132.078f7c6e.js"><link rel="prefetch" href="/assets/js/133.2a327d6d.js"><link rel="prefetch" href="/assets/js/134.bfa0f128.js"><link rel="prefetch" href="/assets/js/135.97575744.js"><link rel="prefetch" href="/assets/js/136.43f69aa0.js"><link rel="prefetch" href="/assets/js/137.32f186f1.js"><link rel="prefetch" href="/assets/js/138.de871201.js"><link rel="prefetch" href="/assets/js/139.bfeef00b.js"><link rel="prefetch" href="/assets/js/14.72f30259.js"><link rel="prefetch" href="/assets/js/140.bb87b2b7.js"><link rel="prefetch" href="/assets/js/141.1cf30f57.js"><link rel="prefetch" href="/assets/js/142.9ec9762d.js"><link rel="prefetch" href="/assets/js/143.f0cf3c8c.js"><link rel="prefetch" href="/assets/js/144.795ece96.js"><link rel="prefetch" href="/assets/js/145.0b60ef2e.js"><link rel="prefetch" href="/assets/js/146.c3ce17b8.js"><link rel="prefetch" href="/assets/js/147.403aa79f.js"><link rel="prefetch" href="/assets/js/148.404cfd9f.js"><link rel="prefetch" href="/assets/js/149.d3a7b04d.js"><link rel="prefetch" href="/assets/js/15.390ed325.js"><link rel="prefetch" href="/assets/js/150.c83ed657.js"><link rel="prefetch" href="/assets/js/151.ae15cac0.js"><link rel="prefetch" href="/assets/js/16.5c0c7c1d.js"><link rel="prefetch" href="/assets/js/17.bacc1ad5.js"><link rel="prefetch" href="/assets/js/18.a1a1f025.js"><link rel="prefetch" href="/assets/js/19.b7e504d2.js"><link rel="prefetch" href="/assets/js/21.89a8c444.js"><link rel="prefetch" href="/assets/js/22.8de21bf6.js"><link rel="prefetch" href="/assets/js/23.95796661.js"><link rel="prefetch" href="/assets/js/24.c7aa8a7b.js"><link rel="prefetch" href="/assets/js/25.5a36c869.js"><link rel="prefetch" href="/assets/js/26.9269dcab.js"><link rel="prefetch" href="/assets/js/27.791865b7.js"><link rel="prefetch" href="/assets/js/28.34c2ed2c.js"><link rel="prefetch" href="/assets/js/29.c32021f3.js"><link rel="prefetch" href="/assets/js/3.2a0adee7.js"><link rel="prefetch" href="/assets/js/30.69b6def5.js"><link rel="prefetch" href="/assets/js/31.14b16abf.js"><link rel="prefetch" href="/assets/js/32.75175d77.js"><link rel="prefetch" href="/assets/js/33.9bc4bab4.js"><link rel="prefetch" href="/assets/js/34.40987cc0.js"><link rel="prefetch" href="/assets/js/35.7940ff74.js"><link rel="prefetch" href="/assets/js/36.cd695f6b.js"><link rel="prefetch" href="/assets/js/37.edf13901.js"><link rel="prefetch" href="/assets/js/38.837702d2.js"><link rel="prefetch" href="/assets/js/39.0fa18ba6.js"><link rel="prefetch" href="/assets/js/40.d44523e1.js"><link rel="prefetch" href="/assets/js/41.7306a85b.js"><link rel="prefetch" href="/assets/js/42.d31c31ee.js"><link rel="prefetch" href="/assets/js/43.f2432a0b.js"><link rel="prefetch" href="/assets/js/44.0c2ddae2.js"><link rel="prefetch" href="/assets/js/45.905ebf26.js"><link rel="prefetch" href="/assets/js/46.9b1512b9.js"><link rel="prefetch" href="/assets/js/47.f103ede6.js"><link rel="prefetch" href="/assets/js/48.04708e27.js"><link rel="prefetch" href="/assets/js/49.3a3c75ca.js"><link rel="prefetch" href="/assets/js/5.5b1c691b.js"><link rel="prefetch" href="/assets/js/50.256050f8.js"><link rel="prefetch" href="/assets/js/51.dbadc095.js"><link rel="prefetch" href="/assets/js/52.05d7cc3e.js"><link rel="prefetch" href="/assets/js/53.85b38766.js"><link rel="prefetch" href="/assets/js/54.fb405994.js"><link rel="prefetch" href="/assets/js/55.9e910633.js"><link rel="prefetch" href="/assets/js/56.f2ad8d03.js"><link rel="prefetch" href="/assets/js/57.0de35738.js"><link rel="prefetch" href="/assets/js/58.52a6936a.js"><link rel="prefetch" href="/assets/js/59.03b3c4ce.js"><link rel="prefetch" href="/assets/js/6.78990d05.js"><link rel="prefetch" href="/assets/js/60.17845187.js"><link rel="prefetch" href="/assets/js/61.e10fd7c1.js"><link rel="prefetch" href="/assets/js/62.0ec4e353.js"><link rel="prefetch" href="/assets/js/63.9af6db51.js"><link rel="prefetch" href="/assets/js/64.df0c7286.js"><link rel="prefetch" href="/assets/js/65.b07ecbe8.js"><link rel="prefetch" href="/assets/js/66.6eec5b7c.js"><link rel="prefetch" href="/assets/js/67.e7b78e7e.js"><link rel="prefetch" href="/assets/js/68.908bd0fd.js"><link rel="prefetch" href="/assets/js/69.43c6e32c.js"><link rel="prefetch" href="/assets/js/7.281fbb64.js"><link rel="prefetch" href="/assets/js/70.69ee8d84.js"><link rel="prefetch" href="/assets/js/71.19768fd2.js"><link rel="prefetch" href="/assets/js/72.09333752.js"><link rel="prefetch" href="/assets/js/73.fc8b7fea.js"><link rel="prefetch" href="/assets/js/74.60440b95.js"><link rel="prefetch" href="/assets/js/75.fca3573e.js"><link rel="prefetch" href="/assets/js/76.0969a149.js"><link rel="prefetch" href="/assets/js/77.f737c3c1.js"><link rel="prefetch" href="/assets/js/78.2ebfc1af.js"><link rel="prefetch" href="/assets/js/79.83423921.js"><link rel="prefetch" href="/assets/js/8.c0e9e3b8.js"><link rel="prefetch" href="/assets/js/80.83d49b50.js"><link rel="prefetch" href="/assets/js/81.6b727ae1.js"><link rel="prefetch" href="/assets/js/82.4904d1c1.js"><link rel="prefetch" href="/assets/js/83.f1e0e96c.js"><link rel="prefetch" href="/assets/js/84.69f47593.js"><link rel="prefetch" href="/assets/js/85.9a45b148.js"><link rel="prefetch" href="/assets/js/86.9107fea7.js"><link rel="prefetch" href="/assets/js/87.752371b7.js"><link rel="prefetch" href="/assets/js/88.2457d126.js"><link rel="prefetch" href="/assets/js/89.e4caac1b.js"><link rel="prefetch" href="/assets/js/9.14294c63.js"><link rel="prefetch" href="/assets/js/90.bd41fbe7.js"><link rel="prefetch" href="/assets/js/91.1848886f.js"><link rel="prefetch" href="/assets/js/92.9695ad06.js"><link rel="prefetch" href="/assets/js/93.69d7d08c.js"><link rel="prefetch" href="/assets/js/94.caefb821.js"><link rel="prefetch" href="/assets/js/95.5c119d68.js"><link rel="prefetch" href="/assets/js/96.32a883c7.js"><link rel="prefetch" href="/assets/js/97.f8efb733.js"><link rel="prefetch" href="/assets/js/98.a5cfd97a.js"><link rel="prefetch" href="/assets/js/99.2b9ddfb7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2952188d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-6853d236><div data-v-6853d236><div class="password-shadow password-wrapper-out" style="display:none;" data-v-2d5d5590 data-v-6853d236 data-v-6853d236><h3 class="title" data-v-2d5d5590>小董的Blog</h3> <p class="description" data-v-2d5d5590>my-blog</p> <label id="box" class="inputBox" data-v-2d5d5590><input type="password" value="" data-v-2d5d5590> <span data-v-2d5d5590>Konck! Knock!</span> <button data-v-2d5d5590>OK</button></label> <div class="footer" data-v-2d5d5590><span data-v-2d5d5590><i class="iconfont reco-theme" data-v-2d5d5590></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2d5d5590>vuePress-theme-reco</a></span> <span data-v-2d5d5590><i class="iconfont reco-copyright" data-v-2d5d5590></i> <a data-v-2d5d5590><span data-v-2d5d5590>小董</span>
          
        <span data-v-2d5d5590>2017 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-6853d236><header class="navbar" data-v-6853d236><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.webp" alt="小董的Blog" class="logo"> <span class="site-name">小董的Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具类/" class="nav-link"><i class="undefined"></i>
  工具类
</a></li><li class="dropdown-item"><!----> <a href="/categories/神奇的API/" class="nav-link"><i class="undefined"></i>
  神奇的API
</a></li><li class="dropdown-item"><!----> <a href="/categories/css小知识/" class="nav-link"><i class="undefined"></i>
  css小知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/css-demo/" class="nav-link"><i class="undefined"></i>
  css-demo
</a></li><li class="dropdown-item"><!----> <a href="/categories/es6/" class="nav-link"><i class="undefined"></i>
  es6
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试细节/" class="nav-link"><i class="undefined"></i>
  面试细节
</a></li><li class="dropdown-item"><!----> <a href="/categories/js小知识/" class="nav-link"><i class="undefined"></i>
  js小知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/踩坑/" class="nav-link"><i class="undefined"></i>
  踩坑
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuhuakawaii/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6853d236></div> <aside class="sidebar" data-v-6853d236><div class="personal-info-wrapper" data-v-3c280276 data-v-6853d236><img src="/favicon.webp" alt="author-avatar" class="personal-img" data-v-3c280276> <h3 class="name" data-v-3c280276>
    小董
  </h3> <div class="num" data-v-3c280276><div data-v-3c280276><h3 data-v-3c280276>140</h3> <h6 data-v-3c280276>Articles</h6></div> <div data-v-3c280276><h3 data-v-3c280276>26</h3> <h6 data-v-3c280276>Tags</h6></div></div> <ul class="social-links" data-v-3c280276></ul> <hr data-v-3c280276></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具类/" class="nav-link"><i class="undefined"></i>
  工具类
</a></li><li class="dropdown-item"><!----> <a href="/categories/神奇的API/" class="nav-link"><i class="undefined"></i>
  神奇的API
</a></li><li class="dropdown-item"><!----> <a href="/categories/css小知识/" class="nav-link"><i class="undefined"></i>
  css小知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/css-demo/" class="nav-link"><i class="undefined"></i>
  css-demo
</a></li><li class="dropdown-item"><!----> <a href="/categories/es6/" class="nav-link"><i class="undefined"></i>
  es6
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试细节/" class="nav-link"><i class="undefined"></i>
  面试细节
</a></li><li class="dropdown-item"><!----> <a href="/categories/js小知识/" class="nav-link"><i class="undefined"></i>
  js小知识
</a></li><li class="dropdown-item"><!----> <a href="/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/踩坑/" class="nav-link"><i class="undefined"></i>
  踩坑
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuhuakawaii/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-2d5d5590 data-v-6853d236><h3 class="title" data-v-2d5d5590>React学习笔记</h3> <!----> <label id="box" class="inputBox" data-v-2d5d5590><input type="password" value="" data-v-2d5d5590> <span data-v-2d5d5590>Konck! Knock!</span> <button data-v-2d5d5590>OK</button></label> <div class="footer" data-v-2d5d5590><span data-v-2d5d5590><i class="iconfont reco-theme" data-v-2d5d5590></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2d5d5590>vuePress-theme-reco</a></span> <span data-v-2d5d5590><i class="iconfont reco-copyright" data-v-2d5d5590></i> <a data-v-2d5d5590><span data-v-2d5d5590>小董</span>
          
        <span data-v-2d5d5590>2017 - </span>
        2023
      </a></span></div></div> <div data-v-6853d236><div data-v-6853d236><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">React学习笔记</h1> <div data-v-305db890><i class="iconfont reco-account" data-v-305db890><span data-v-305db890>小董</span></i> <i class="iconfont reco-date" data-v-305db890><span data-v-305db890>5/8/2023</span></i> <i class="iconfont reco-eye" data-v-305db890><span id="/blogs/note/react.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-305db890><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-305db890><span class="tag-item" data-v-305db890>React</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="react基础"><a href="#react基础" class="header-anchor">#</a> React基础</h2> <h3 id="项目搭建"><a href="#项目搭建" class="header-anchor">#</a> <strong>项目搭建</strong></h3> <ol><li><p>安装脚手架:<code>npm i create-react-app -g</code> mac前面要设置sudo</p></li> <li><p>检查安装情况：<code>create-react-app --version</code></p></li> <li><p>基于脚手架创建React工程化项目:<code>create-react-app 项目名称</code>,项目名称遵循npm命名规范  <code>数字 小写字母 _</code></p></li> <li><p><strong>React项目中默认安装</strong></p> <ul><li><code>react</code> 框架核心</li> <li><code>react-dom</code> 视图渲染的核心，基于react构建webapp（html页面）</li> <li><code>react-native</code> 构建和渲染app的</li> <li><code>react-scripts</code>:脚手架为了让项目目录看起来干净一些，把webpack打包的规则及相关的插件/loader等都隐藏到了<code>node_modules</code>目录下，<code>react-scripts</code>就是脚手架中自己对打包命令的一种封装，基于它打包，会调用<code>node_modules</code>中的webpack来进行打包</li> <li><code>web-vitals</code>:性能检测工具</li> <li><code>eslintConfig</code>：<br>
+ 对webpack中ESlint词法检测的相关配置<br>
+ 词法错误---不符合标准规范<br>
+ 符合标准，代码本身不会报错，但是不符合ESlint的检测规范</li> <li><code>browserslist</code>：基于browserslist规范，设置浏览器的兼容情况<br>
1. 对<code>postcss-loader + autoprefixer</code>生效，会给CSS3设置相关的前缀<br>
2. 对<code>babel-loader</code>生效，会把ES6编译成ES5<br>
3. 无法处理ES6内置API的兼容，我们需要<code>@babel/polyfill</code>对常见内置的API重写了<br>
4. 脚手架中内置兼容处理<code>react-app-polyfill</code></li></ul></li> <li><p><strong><code>scripts</code>命令</strong></p> <ul><li><code>start</code> ：开发环境--在本地启动web服务器，预览打包内容</li> <li><code>build</code> ：生产环境--打包部署，打包的内容输出到dist目录中</li> <li><code>test</code> ：单元测试</li> <li><code>eject</code> : 暴露<code>webpack</code>配置规则，修改默认打包规则</li></ul></li> <li><p><strong>处理跨域</strong></p> <ul><li>安装<code>http-proxy-middleware</code></li> <li><code>src/setupProxy.js</code><div class="language-js line-numbers-mode"><pre class="language-js"><code>          <span class="token comment">//处理跨域问题  跨域代理</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span>createProxyMiddleware<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span>
          module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
          <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token string">'/jian'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">'https://www.jianshu.com/asimov'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">ws</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;^/jian&quot;</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
          <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token string">'/zhi'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">'https://news-at.zhihu.com/api/4'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">ws</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;^/zhi&quot;</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul></li></ol> <h3 id="react基础语法"><a href="#react基础语法" class="header-anchor">#</a> <strong>React基础语法</strong></h3> <ol><li><p><strong>MVC与MVVM</strong></p> <ol><li>React采用的是MVC体系，Vue采取的是MVVM体系</li> <li>MVC：model数据层 + view视图层 + controller控制层 （单向数据驱动视图）
<ul><li>我们需要按照专业的语法去构建视图（页面）：react中是基于jsx语法来构建视图的</li> <li>构建数据层：但凡在视图中，需要'动态'处理的（获取需要变化的，不论是样式还是内容），我们都要有对应的数据模型</li> <li>控制层：当我们在视图中进行某些操作时，修改了相关数据，react会根据最新的数据重新渲染</li></ul></li> <li>MVVM：model数据层 + view视图层 + viewModel数据/视图监听层 （双向数据驱动视图）</li></ol></li> <li><p><strong>JSX构建视图的基本知识（javascript and xml）</strong></p> <ol><li>vscode如何支持JSX语法（格式化、快捷提示）
<ul><li>右下角修改成jsx语言格式</li> <li>后缀名改成jsx</li></ul></li> <li>在HTML中嵌入&quot;js表达式&quot;，需要使用<code>{}单胡子语法</code></li> <li>在<code>ReactDOM.createRoot()</code>的时候，不能直接把<code>HTML/body</code>作为根容器，需要指定一个额外的盒子，例如<code>#root</code></li> <li>每个构建的视图中，只能有一个根节点
<ul><li>react提供了一个特殊的空文档标记标签<code>&lt;&gt;React.Fragment&lt;/&gt;</code></li></ul></li> <li><strong><font color="red">胡子语法中嵌入不同的值，所呈现的特点</font></strong> <ol><li><code>number/string</code>：直接渲染值</li> <li><code>Boolean/null/undefined/Symbol/Bigint</code>:渲染内容是空</li> <li>对象：一般不支持渲染，也有特殊情况
<ul><li>JSX虚拟DOM对象<code>{React.createElement('button',null,'提交')}</code></li> <li>给元素设置style行内样式，要求必须写成一个对象格式</li></ul></li> <li>数组对象：把数组每一项分别拿出来渲染，<strong><font color="red">并不是变为字符串渲染，中间没有逗号</font></strong></li> <li>函数对象：不支持在<code>{}</code>中渲染，但是可以作为函数组件，用<code>&lt;Component/&gt;</code>方式渲染</li></ol></li> <li><strong>给元素设置样式</strong> <ol><li>行内样式：需要基于<strong>胡子语法 + 对象格式</strong>处理<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'red'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fontSize</span><span class="token operator">:</span><span class="token string">'18px'</span> <span class="token comment">//样式属性要基于驼峰命名法处理</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>设置样式类名：需要把<code>class</code>替换为<code>className</code><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>title<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol></li> <li>需求案例
<ol><li>需求一：基于数据的值，来判断元素的显示隐藏<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token punctuation">{</span><span class="token comment">/* 控制元素的display样式，元素渲染出来了 */</span><span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      <span class="token literal-property property">display</span><span class="token operator">:</span>flag<span class="token operator">?</span><span class="token string">'block'</span><span class="token operator">:</span><span class="token string">'none'</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">按钮1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

      <span class="token punctuation">{</span><span class="token comment">/* 控制元素渲染或者不渲染 */</span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span><span class="token operator">!</span>flag <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">按钮2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> <span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li>需求二: 从服务器获取了一组列表数据，循环动态绑定相关的内容<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>title<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">今日新闻</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>news-box<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span>stories<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">/*循环创建的元素设置key属性，优DOM-diff*/</span> 
      <span class="token keyword">return</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            &amp;nbsp;&amp;nbsp;
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">欢迎大家学习</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li>扩展需求：没有数组，就想单独循环五次<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token comment">//需要使用fill，将稀疏数组填充成密集数组</span>
      <span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  按钮</span><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>          
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol></li></ol></li> <li><p><strong>JSX底层渲染机制</strong></p> <ol><li>把我们编写的JSX语法，基于<code>babel-preset-react-app</code>为<code>React.createElement(...)</code>这种格式！
<ul><li>只要是元素节点，必然会基于<code>createElement</code>进行处理</li> <li><code>React.createElement(ele,props,...children)</code><br>
+ <code>ele</code>:元素标签名（或组件）
+ <code>props</code>：元素的属性集合对象（如果没有设置过任何属性则为<code>null</code>）<br>
+ <code>children</code>：第三个往后都是当前元素的子节点</li></ul></li> <li>再把<code>createElement</code>执行创建出虚拟DOM对象（virtualDOM，也有称之为：jsx元素、jsx对象、ReactChild对象...）<div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span>props<span class="token punctuation">,</span><span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> virtualDOM <span class="token operator">=</span> <span class="token punctuation">{</span>
                  $$<span class="token keyword">typeof</span><span class="token operator">:</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'react.element'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">key</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">ref</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">props</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> len <span class="token operator">=</span> children<span class="token punctuation">.</span>length
            virtualDOM<span class="token punctuation">.</span>type <span class="token operator">=</span> ele
            <span class="token keyword">if</span><span class="token punctuation">(</span>props <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  virtualDOM<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token operator">...</span>props
                  <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> virtualDOM<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> virtualDOM<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children <span class="token operator">=</span> children
            <span class="token keyword">return</span> virtualDOM
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li>把构建的虚拟DOM渲染为真实DOM（基于<code>ReactDOM</code>中的<code>render</code>方法）
<ul><li>v16<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>          ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>v18<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>          <span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li>第一次渲染页面是直接从Vdom--&gt;真实dom，并且把<code>oldVdom</code>缓存起来，后期视图更新的时候，需要经过一个新老Vdom的 <code>dom--diff</code>的对比，计算出补丁包<code>Patch</code>（两次视图差异的部分），把patch补丁包进行渲染</li></ol></li></ol> <h2 id="react组件基础"><a href="#react组件基础" class="header-anchor">#</a> <strong>React组件基础</strong></h2> <h3 id="函数组件"><a href="#函数组件" class="header-anchor">#</a> 函数组件</h3> <ol><li><p><strong>基本使用</strong></p> <ul><li>创建：在src目录中，创建一个xxx.jsx的文件，就是要创建一个组件，我们在此文件中，<strong>创建一个函数，让函数返回jsx视图（或者jsx元素，VDOM对象），这就是创建一个函数组件</strong></li> <li>调用：基于ES6Module规范，导入创建的组件</li> <li><strong>双闭合调用区别：我们可以传递子节点，传递给函数的props中，有一个children属性存储这些子节点</strong></li> <li>调用组件的时候，我们可以传递各种属性，<strong>如果属性值不是字符串，需要用胡子语法嵌套</strong></li> <li><strong>底层渲染的主要区别就是，函数组件的type属性值不是字符串，而是一个函数，他会把函数执行，把Vdom中的props作为实参，传给了函数</strong></li></ul></li> <li><p><strong>属性props的处理</strong></p> <ol><li><p>调用组件，传递进来的属性是‘只读’的，<strong>对象是被冻结的</strong></p></li> <li><p>虽然不能修改props，但是可以做规则校验,<strong>不影响使用，但是校验错误会抛出警告</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">DemoOne</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>className<span class="token punctuation">,</span>style<span class="token punctuation">,</span>title<span class="token punctuation">}</span> <span class="token operator">=</span> props
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">demo-box </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                  我是<span class="token constant">DEMO</span><span class="token operator">-</span><span class="token constant">ONE</span>
                  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
      DemoOne<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">//把函数当做对象，设置静态的私有属性方法，来设置校验规则</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'默认值'</span>
      <span class="token punctuation">}</span>
      DemoOne<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">//设置其他规则依赖官方插件prop-types</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span> <span class="token comment">//类型是字符串 必传</span>
            <span class="token literal-property property">x</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>number  <span class="token comment">//类型是数字</span>
            <span class="token literal-property property">y</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span><span class="token function">oneOfType</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token comment">//多种校验规则中的一个</span>
            PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
            PropTypes<span class="token punctuation">.</span>string    
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> DemoOne  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol></li> <li><p><strong>插槽机制</strong></p> <ol><li>和属性作用是一致的：让组件具备更强的复用性</li> <li>传递数据用属性，传递结构用插槽，通过子节点用<code>children</code>来获取<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token comment">//父组件</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DemoOne</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>demo1<span class="token punctuation">'</span></span>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'red'</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>  <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>footer<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是尾部2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>  <span class="token punctuation">&gt;</span></span><span class="token plain-text">我是moren</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>header<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是头部</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>  <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>footer<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是尾部1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">DemoOne</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">//子组件</span>
      <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">DemoOne</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>children<span class="token punctuation">}</span> <span class="token operator">=</span> props
            <span class="token comment">//要对children的类型做处理</span>
            <span class="token comment">//可以基于React.Children对象中提供的方法，对props.children做处理</span>
            <span class="token comment">//count/forEach/map/toArray这些方法的内部，已经对children的各种形式做了处理</span>
            children <span class="token operator">=</span> React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
            <span class="token keyword">let</span> headerSlot <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            footerSlot <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            defaultSlot <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
            children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//传递进来的插槽信息，都是编译为Vdom对象，而不是传递的标签</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">let</span> <span class="token punctuation">{</span>slot<span class="token punctuation">}</span> <span class="token operator">=</span> child<span class="token punctuation">.</span>props
                  <span class="token keyword">if</span><span class="token punctuation">(</span>slot <span class="token operator">===</span> <span class="token string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//按照插槽名字 进行筛选不同的插槽信息</span>
                        headerSlot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>slot <span class="token operator">===</span> <span class="token string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        footerSlot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        defaultSlot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>demo-box<span class="token punctuation">'</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token punctuation">{</span>headerSlot<span class="token punctuation">}</span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是DEMO-ONE</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token punctuation">{</span>footerSlot<span class="token punctuation">}</span><span class="token plain-text">
                  </span><span class="token punctuation">{</span>defaultSlot<span class="token punctuation">}</span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li></ol></li> <li><p><strong>封装一个Dialog组件</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>
      <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">Dialog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Dialog</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>title<span class="token punctuation">,</span>content<span class="token punctuation">,</span>children<span class="token punctuation">}</span> <span class="token operator">=</span> props
      children <span class="token operator">=</span> React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
      <span class="token keyword">let</span> submitSlot <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>defaultSlot<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> count <span class="token operator">=</span> React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
      children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>slot<span class="token punctuation">}</span> <span class="token operator">=</span> child<span class="token punctuation">.</span>props
      <span class="token keyword">if</span><span class="token punctuation">(</span>slot <span class="token operator">===</span> <span class="token string">'submit'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            submitSlot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            defaultSlot<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span>submitSlot<span class="token punctuation">,</span>defaultSlot<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>dialog-box<span class="token punctuation">'</span></span>  <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token literal-property property">border</span><span class="token operator">:</span><span class="token string">'1px solid red'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">padding</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span>
            <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token string">'300px'</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token literal-property property">borderBottom</span><span class="token operator">:</span><span class="token string">'1px solid #000'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>
            count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>submitSlot<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>defaultSlot<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span> <span class="token operator">:</span><span class="token keyword">null</span>
            <span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span>
      <span class="token comment">//属性规则校验</span>
      Dialog<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'提示'</span>
      <span class="token punctuation">}</span>
      Dialog<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired 
      <span class="token punctuation">}</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> Dialog
      <span class="token comment">//父组件渲染</span>
        root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>温馨提示<span class="token punctuation">'</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>大家出门做好防护！<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Dialog</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span>  <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>这是一个没有标题的dialog<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">确定</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">yes</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Dialog</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span>  <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>这是一个提交弹窗<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">提交</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Dialog</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div></li></ol> <h3 id="静态组件和动态组件"><a href="#静态组件和动态组件" class="header-anchor">#</a> <strong>静态组件和动态组件</strong></h3> <ol><li><p><strong>区别</strong></p> <ul><li>函数是<strong>静态组件</strong> <ul><li><strong>第一次渲染组件，把函数执行，产生一个私有的上下文：EC(V)</strong>，把解析出来的props（含children）传递进来，但是<strong>被冻结了</strong>，对函数返回的JSX元素（vdom）进行渲染</li> <li>当我们点击按钮时，会把绑定的小函数执行，修改上级上下文EC(V)中的变量，<strong>私有变量值改变了，但是不会更新视图</strong></li> <li>无法自更新，除非调用它的父组件更新了，那么相关的子组件也一定会更新「可能传递最新的属性值进来」</li> <li>函数组件具备：属性...「其他状态等内容几乎没有」</li> <li>优势：比类组件处理的机制简单，这样导致函数组件渲染速度更快！！</li></ul></li> <li>类组件是<strong>动态组件</strong>：
<ul><li>组件在第一渲染完毕后，除了父组件更新可以触发其更新外，我们还可以通过：<code>this.setState</code>修改状态 或者 <code>this.forceUpdate</code> 等方式，让组件实现“自更新”！！</li> <li>类组件具备：属性、状态、周期函数、ref...「几乎组件应该有的东西它都具备」</li> <li>优势：功能强大！！</li></ul></li> <li>Hooks组件「推荐」：具备了函数组件和类组件的各自优势，在函数组件的基础上，基于hooks函数，让函数组件也可以拥有状态、周期函数等，让函数组件也可以实现自更新「动态化」！！</li></ul></li> <li><p><strong>类组件</strong></p> <ol><li><p>创建类组件：创建一个构造函数（类）</p> <ul><li>要求必须继承<code>React.Component/PureComponent</code>这个类</li> <li>必须给当前类设置一个render的方法（放在其原型上）<div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>     
      <span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token comment">//在render方法中，返回需要渲染的视图</span>
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>  
      <span class="token keyword">export</span> <span class="token keyword">default</span> Sub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></li> <li><p>class基本语法回顾</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
            <span class="token comment">//new的时候，执行的构造函数（需要接收传递进来的实参信息，才需要设置constructor）</span>
            <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token comment">//this --&gt; 创建的实例</span>
                  <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> x<span class="token operator">+</span>y
            <span class="token punctuation">}</span>
            <span class="token comment">// = 赋值--&gt; 相当于this.num = 200--&gt;创建的实例</span>
            num <span class="token operator">=</span> <span class="token number">200</span>
            <span class="token comment">//箭头函数没有自己的this，所用到的this是宿主环境中的</span>
            <span class="token function-variable function">getNum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//this--&gt;实例</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//给Parent.prototype设置的公共方法，不可枚举</span>
            <span class="token function">getNum2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">'原型'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//把构造函数当做一个普通对象，为其设置静态的私有属性方法 Parent.xxx</span>
            <span class="token keyword">static</span> avg <span class="token operator">=</span> <span class="token number">100</span>  
            <span class="token keyword">static</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">200</span> <span class="token comment">//外部手动给原型上设置公共属性</span>

      <span class="token comment">/*基于extends实现继承  
      1. 首先基于call继承 React.Component.call(this)  --&gt;  this--&gt;Parent类的实例P 

      2.给创建的实例p设置四个私有属性  

      3. 再基于原型继承 Parent.prototype.__proto__ === React.Component.prototype
      实例--&gt;Parent.prototype--&gt;React.Component.prototype--&gt;Object.prototype
      继承forceUpdate isReactComponent setState方法

      4.只要自己设置了constructor，则内部第一句话一定要执行super() 
      */</span> 
      <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span>m</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//等价于React.component.call()</span>
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> 
        
      <span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context<span class="token punctuation">,</span>updater</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props
            <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context
            <span class="token keyword">this</span><span class="token punctuation">.</span>refs <span class="token operator">=</span> emptyObject
            <span class="token keyword">this</span><span class="token punctuation">.</span>updater <span class="token operator">=</span> updater <span class="token operator">||</span> ReactNoopUpdateQueue
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div></li> <li><p>render函数在渲染的时候，如果type是：</p> <ul><li>字符串：创建一个标签</li> <li>普通函数：把函数执行，并且把props传递给函数，<strong>每次执行会创造新的执行上下文，所以多个组件不影响</strong></li> <li>构造函数：把构造函数基于new执行，也会把解析出来的props传递过去，
<ul><li><strong>每次执行会创造新的实例，所以多个组件不影响</strong></li> <li>把类组件中的render函数执行，把返回的jsx渲染</li></ul></li></ul></li> <li><p>调用类组件（new Vote({..})）开始，类组件内部发生的事情</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/*1. 规则校验 &amp;&amp; 属性初始化
          方案一：super(props)
          方案二：不在constructor中处理或者不写constructor，React也会在内部把传递的props挂载到实例上，所以在其它函数中，只要保证this是实例，就可以基于this.props获取传递的属性
            */</span>
      <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
            <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token comment">//会把传递进来的属性挂载到this实例上</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token comment">//获取到传递的属性</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//属性规则校验</span>
            <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">num</span><span class="token operator">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">title</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>    
      <span class="token comment">/* 2.初始化状态 
                  1. 需要手动初始化，如果我们没有去做相关的处理，则默认会在实例上挂载一个state：null
                  state = {
                        ...
                  }
                  2. 修改状态，视图更新
                        1. this.state.xxx = xxx  只能修改状态，不能视图更新
                        2. this.setState(partialState) 既可以修改状态，也可以让视图更新
                        this.setState({
                              xxx:xxx,
                        })
                        3. this.forceUpdate()强制更新
      */</span>     
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li> <li><p>类组件第一次渲染过程 &amp;&amp; 视图更新过程</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/*
      1. 第一次渲染过程
            + 触发 `UNSAFE_componentWillMount`钩子函数:组件第一次渲染之前
            + 为了不抛出黄色警告，可以暂时用`UNSAFE_componentWillMount`,React严格模式使用UNSAFE则会抛出红色警告           
            + 触发`render`周期函数
            + 触发`componentDidMount`钩子函数：第一次渲染完毕 
      */</span>
     <span class="token comment">/*    
     2. 组件更新的逻辑「第一种：组件内部的状态（state）被修改，组件会更新」       
            + 触发`shouldComponentUpdate`，
            特殊说明：this.forceUpdate()会跳过shouldComponentUpdate校验  
            + 触发`UNSAFE_componentWillUpdate`
            + 触发`render`
            + 触发`componentDidUpdate`
       组件更新的逻辑「第二种：父组件更新（props改变），触发的子组件更新」
            + 触发 UNSAFE_componentWillReceiveProps 周期函数：接收最新属性之前
            + ...
      */</span>
     <span class="token comment">/*
       3.组件卸载的逻辑
            1. 触发 componentWillUnmount 周期函数：组件销毁之前
            2. 销毁
     */</span>
      <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render渲染'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">UNSAFE_componentWillMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentWillMount:第一次渲染之前'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">componentDidMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentDidMount:第一次渲染完毕'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">shouldComponentUpdate</span> <span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//nextState:存储要修改的最新状态</span>
            <span class="token comment">//this.state：存储的还是修改前的状态，此时还未改变状态</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'shouldComponentUpdate,是否允许修改，更新之前'</span><span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
            <span class="token comment">//此周期函数需要返回true(允许更新)/false(不允许更新)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
      <span class="token function">UNSAFE_componentWillUpdate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentWillUpdate,状态还未修改，更新之前'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">componentDidUpdate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentDidUpdate,状态已经修改，更新完毕'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">UNSAFE_componentWillReceiveProps</span> <span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentWillReceiveProps,父组件修改特殊周期'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></li> <li><p><code>PureComponent</code>和<code>Component</code>的区别</p> <ul><li><code>PureComponent</code>会给类组件默认添加<code>shouldComponentUpdate</code>周期函数
1. 在此周期函数中，他对新老的属性进行浅比较<br>
2. 如果比较后发现属性和状态没有变，则返回false，也就不执行后续生命周期了</li></ul></li> <li><p>ref</p> <ul><li>受控组件：基于修改数据/状态，让视图更新，达到需要的效果</li> <li>非受控组件：基于ref获取dom元素，操作dom来实现需求</li> <li>基于ref获取DOM的语法<br>
1. 元素设置<code>ref='xxx'</code>,通过<code>this.refs.xxx</code>来获取<br>
2. 把ref属性设置为一个函数<code>ref =（x=&gt;this.xxx = x）</code>，直接通过<code>this.xxx</code>来获取（推荐）
3. 基于<code>xxx = React.createRef()</code>创建一个对象--&gt;<code>{current:null}</code>,设置<code>ref = {xxx}</code>,通过<code>this.xxx.current</code>来获取</li> <li>给元素标签设置ref获取对应的dom元素</li> <li><strong>给类组件设置ref，获取的是当前组件的实例</strong></li> <li>给函数组件直接设置ref会报错，但是我们让其配合<code>React.forwardRef</code>实现ref的转发，可以获取函数子组件内部的某个元素<div class="language-js line-numbers-mode"><pre class="language-js"><code>     <span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>ref</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>button ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token comment">//父组件</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">x</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> x<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Child<span class="token operator">&gt;</span>
     <span class="token punctuation">}</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li></ol></li></ol> <h3 id="setstate进阶"><a href="#setstate进阶" class="header-anchor">#</a> setState进阶</h3> <ol><li><p><strong>语法分析</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>partialState<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
      <span class="token literal-property property">partialState</span><span class="token operator">:</span>支持部分状态更改
      <span class="token literal-property property">callback</span><span class="token operator">:</span>在状态更改<span class="token operator">/</span>视图更新完毕（componentDidUpdate）后触发执行，如果shouldComponentUpdate拦截更新，componentDidUpdate不会执行，但是callback依旧会执行！！！
      类似于$nextTick
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><strong>异步更新</strong></p> <ul><li>在<code>React18</code>中，产生的私有上下文中，遇到<code>setState</code>,不会立即更新状态和视图，而是加入到更新队列<code>updaterQueue</code>中。</li> <li>当上下文中代码都处理完毕后，会让更新队列中的任务，统一渲染/更新一次（批处理）</li> <li>能够有效减少更新次数，降低性能消耗，有效管理代码执行的逻辑顺序</li> <li><strong><font color="red">在<code>React18</code>和<code>React16</code>中，关于<code>setState</code>的区别</font></strong><br>
+ <strong>在<code>React18</code>中，不论什么地方，都是异步的，基于<code>updaterQueue</code>处理机制实现批处理</strong><br>
+ <strong>在<code>React16</code>中，在合成事件（On绑定事件），周期函数中，<code>setState</code>是异步的，但是如果<code>setState</code>出现在其他异步操作中，比如定时器，手动获取DOM元素做的事件绑定，它将变为同步的操作（立即更新状态和视图渲染）</strong></li></ul></li> <li><p><strong>flushSync</strong></p> <ul><li><code>react-dom</code>中有个<code>flushSync</code>方法，可以刷新<code>updaterQueue</code>，也就是让修改状态的任务立即批处理一次<div class="language-js line-numbers-mode"><pre class="language-js"><code>       <span class="token comment">//写法一 先渲染xy 在渲染z</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
             <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                   <span class="token literal-property property">y</span><span class="token operator">:</span>y<span class="token operator">+</span><span class="token number">1</span>  
             <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">z</span><span class="token operator">:</span>z<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

       <span class="token comment">//写法二 先渲染xy 在渲染z</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">y</span><span class="token operator">:</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">z</span><span class="token operator">:</span>z<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

       <span class="token comment">//写法三 先渲染xz 在渲染y</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">y</span><span class="token operator">:</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">z</span><span class="token operator">:</span>z<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul></li> <li><p><strong><font color="red">短时间内多次修改state的同一值的问题</font></strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/*
            在每一轮循环的时候，x状态没有更新，只是****把修改的任务结果放在了队列中****
            所以每一轮循环，我们获取的this.state.x的初始值都是0，最后导致，放入队列中的任务都是要把x修改为1，并不是只执行最后一次
       */</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/*解决方案：
            利用 this.state((preState)=&gt;{
                  return {}
            })
            这是把回调函数放入队列中！！！
            回调函数中把preState中的x暂存了，这样就保证拿到的初始值不是原始初始值
      */</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'back'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
                  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> state<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol> <h3 id="合成事件-synthetic"><a href="#合成事件-synthetic" class="header-anchor">#</a> <strong>合成事件（Synthetic）</strong></h3> <ol><li><p>合成事件是围绕浏览器原生事件，充当浏览器包装器的对象，他们将不同浏览器的行为合并为一个API，这样做是为了确保事件在不同浏览器中显示一致的属性</p></li> <li><p>合成事件this指向问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">handle1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//方法在实例上</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>  <span class="token comment">//Demo实例 合成事件对象</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//基于React内部的处理，如果给合成事件绑定的是一个普通函数，当事件行为触发，this指向会是undefined</span>
      <span class="token function">handle2</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//方法在原型上</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">//undefined</span>
      <span class="token punctuation">}</span>
      <span class="token function">handle3</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//经过bind处理，name最后一个实参就是传递的合成事件对象</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token comment">//10,Demo实例</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handle1<span class="token punctuation">}</span><span class="token operator">&gt;</span>按钮<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handle2<span class="token punctuation">}</span><span class="token operator">&gt;</span>按钮<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handle3</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>按钮<span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token comment">//Demo实例</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>按钮<span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>合成事件对象<code>SyntheticBaseEvent</code>:我们在React合成事件触发的时候，也可以获取到事件对象，只不过此对象是合成事件对象（内部处理，把各个浏览器的事件对象统一化后，构建的一个事件对象），合成事件对象中，包含了常用的属性方法，也保存着<code>nativeEvent</code>(浏览器内置原生事件对象)</p></li> <li><p>bind在合成事件绑定中的运用</p> <ul><li>绑定的方法是一个普通函数，需要改变函数中的this是实例，此时需要用到bind（不过一般绑定箭头函数不会出现这个情况）</li> <li><strong>想要给函数传递指定的实参，可以基于bind预先处理（bind会把事件对象以最后一个实参传递给函数）</strong></li></ul></li> <li><p>事件</p> <ol><li>事件捕获和事件冒泡
<img src="/assets/img/02.a6f1db0a.png" alt=""><div class="language-js line-numbers-mode"><pre class="language-js"><code>        <span class="token comment">//e.stopPropagation()  阻止事件传播（包括冒泡和捕获）</span>
        body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token comment">//e.stopImmediatePropagaion()</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'body捕获'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

        <span class="token comment">//e.stopImmediatePropagaion() 阻止事件传播（包括冒泡和捕获）同时限制同级的其他绑定的还未执行的方法也阻止</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li>事件委托：只需要给容器做一个事件绑定，点击内部的任何元素，根据事件的冒泡传播机制，都会让容器的点击事件也触发，我们在这里根据事件源（<code>e.target</code>）做不同的事情就可以了</li> <li>React中合成事件的底层原理（<strong>基于事件委托</strong>）
<ol><li><strong>组件渲染中，遇到合成事件绑定，并没有给元素做事件绑定，而是给元素设置对应的合成事件属性，最后都会插入到<code>#root</code>容器中</strong></li> <li>给<code>#root</code>的捕获和冒泡做事件绑定（<strong>17版本以前是给<code>document</code>的冒泡阶段做了绑定</strong>）</li> <li>在<code>#root</code>上绑定的方法执行时，把所有规划的路径中，依次把对应有合成事件属性执行即可</li> <li>对于没有实现事件传播机制的事件，才是单独做的事件绑定，例如<code>onMouseEnter onMouseLeave</code><div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">// 给#root做事件绑定</span>
   root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">let</span> path <span class="token operator">=</span> ev<span class="token punctuation">.</span>path<span class="token punctuation">;</span> <span class="token comment">// path:[事件源-&gt;....-&gt;window] 所有祖先元素</span>
       <span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">let</span> handle <span class="token operator">=</span> ele<span class="token punctuation">.</span>onClickCapture<span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>handle<span class="token punctuation">)</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这就是为什么我们用普通函数时，方法执行，没有调用者，this问题会是undefined的原因！！！！</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">let</span> path <span class="token operator">=</span> ev<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">let</span> handle <span class="token operator">=</span> ele<span class="token punctuation">.</span>onClick<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>handle<span class="token punctuation">)</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><img src="/assets/img/03.eb5f0b78.jpg" alt=""></li> <li>阻止事件传播的底层机制
<ul><li><code>ev.stopPropagation()</code>:阻止原生的事件传播 &amp; 阻止合成事件中的事件传播</li> <li><code>ev.nativeEvent.stopPropagation()</code>:只能阻止原生事件的传播</li> <li><code>ev.nativeEvent.stopImmediatePropagation()</code>:原生事件对象的阻止事件传播，只不过可以阻止#root上其它绑定的方法执行</li></ul></li> <li>在<code>React16</code>中，关于合成事件对象的处理，内部是基于“事件对象池”，做了一个缓存机制，而17以后，去掉了事件对象池和缓存机制
<ul><li>当每一次事件触发的时候，如果传播到了委托的元素上<code>document #root</code>，在委托的方法中，我们首先会对内置事件对象做统一处理，生成合成事件对象</li> <li>在<code>React16</code>中，为了防止每一次都是重新创建出新的合成事件对象，它设置了一个事件对象池（缓存池），当事件触发时，获取事件操作的相关信息后，我们从事件对象池中获取存储的合成事件对象，把信息赋值给相关的成员，等事件触发结束，会清空当前合成事件对象，再放回事件对象池</li></ul></li></ol></li></ol></li> <li><p><strong>移动端click300ms延迟问题</strong></p> <ol><li>移动端的<code>click</code>是单击事件，PC端的<code>click</code>是点击事件，连着点两下，PC端会触发两次<code>click</code>，一次<code>dbclick</code>，移动端则不会触发<code>click</code>，只会触发<code>dbclick</code></li> <li>单击事件：第一次点击后，检测300ms，看是否有第二次点击操作，如果没有就是单击，如果有就是双击,我们要用单手指事件模型来模拟点击效果<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
      <span class="token comment">// 手指按下：记录手指的起始坐标</span>
      <span class="token function-variable function">touchstart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> finger <span class="token operator">=</span> ev<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//记录了操作手指的相关信息</span>
             <span class="token keyword">this</span><span class="token punctuation">.</span>touch <span class="token operator">=</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">startX</span><span class="token operator">:</span> finger<span class="token punctuation">.</span>pageX<span class="token punctuation">,</span>
              <span class="token literal-property property">startY</span><span class="token operator">:</span> finger<span class="token punctuation">.</span>pageY<span class="token punctuation">,</span>
              <span class="token literal-property property">isMove</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 手指移动：记录手指偏移值，和误差值做对比，分析出是否发生移动</span>
       <span class="token function-variable function">touchmove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token keyword">let</span> finger <span class="token operator">=</span> ev<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token punctuation">{</span> startX<span class="token punctuation">,</span> startY <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>touch<span class="token punctuation">;</span>
           <span class="token keyword">let</span> changeX <span class="token operator">=</span> finger<span class="token punctuation">.</span>pageX <span class="token operator">-</span> startX<span class="token punctuation">,</span>
               changeY <span class="token operator">=</span> finger<span class="token punctuation">.</span>pageY <span class="token operator">-</span> startY<span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>changeX<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">||</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>changeY<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token punctuation">.</span>touch<span class="token punctuation">.</span>isMove <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 手指离开：根据isMove判断是否是点击</span>
      <span class="token function-variable function">touchend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> <span class="token punctuation">{</span> isMove <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>touch<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>isMove<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
               <span class="token comment">// 说明触发了点击操作</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击了按钮'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onTouchStart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>touchstart<span class="token punctuation">}</span></span>
                  <span class="token attr-name">onTouchMove</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>touchmove<span class="token punctuation">}</span></span>
                   <span class="token attr-name">onTouchEnd</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>touchend<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                   提交
               </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li> <li>使用<code>FastClick</code>解决移动端300ms问题<div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> FastClick <span class="token keyword">from</span> <span class="token string">'fastclick'</span>
      FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol></li> <li><p><strong>React中表单输入实现</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                  <span class="token keyword">let</span> target <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">,</span>
                        text <span class="token operator">=</span> target<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">email</span><span class="token operator">:</span>text
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><strong>网络请求</strong></p> <ol><li>基于post请求向服务器发送请求，需要基于请求主体把信息传递给服务器
<ul><li>普通对象 --&gt; <code>'[object Object]'</code>字符串传递给服务器不行</li> <li>axios库对其做了处理，会默认把普通对象变成JSON字符串</li> <li>请求主体传给服务器的格式
<ul><li>字符串格式
<ul><li><code>JSON</code>字符串：<code>'{&quot;x&quot;:&quot;10&quot;,&quot;name&quot;:&quot;xxxx&quot;}'</code> <code>application/json</code></li> <li><code>urlencoded</code>字符串: <code>&quot;x=10&amp;name=xxxx&quot;</code> <code>application/x-www-urlencoded</code></li> <li>普通字符串 <code>text/plain</code></li></ul></li> <li><code>FormData</code>对象 （用于文件上传）<code>let fm = new FormData() fm.append('file',file)</code> <code>multipart/form-data</code></li> <li><code>buffer</code>或者进制格式</li></ul></li></ul></li></ol></li></ol> <h2 id="react-hooks-组件化开发"><a href="#react-hooks-组件化开发" class="header-anchor">#</a> <strong>React Hooks 组件化开发</strong></h2> <h3 id="usestate"><a href="#usestate" class="header-anchor">#</a> <strong>useState</strong></h3> <ol><li><p><strong><font color="red">useState</font></strong>：目的是在函数组件中使用状态，并且后期基于状态的修改，可以让组件更新</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
       <span class="token keyword">const</span> <span class="token function-variable function">Demo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 执行`useState`，传递的`initialValue`是初始的状态值，返回结果是一个数组：[状态值,修改状态的方法]
                  + `num`变量存储的是：获取的状态值
                  + `setNum`变量存储的是：修改状态的方法
            */</span>
           <span class="token keyword">let</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">const</span> <span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
               <span class="token function">setNum</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
               </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
               </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handle<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">新增</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
           </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>第一次渲染组件，把函数执行，产生一个私有上下文</li> <li>执行 <code>setNum(value)</code> ：修改状态值为<code>value</code>  &amp;&amp; 通知视图更新</li> <li><strong>把函数（传递属性）重新执行</strong>,num获取到的是新值，setNum获取的是修改状态的新函数，handle也是新函数，产生新的执行上下文...</li></ul></li> <li><p><strong><code>useState</code>处理机制</strong></p> <ul><li>函数组件「或者Hooks组件」不是类组件，所以没有实例的概念「调用组件不再是创建类的实例，而是把函数执行，产生一个私有上下文而已」，所以，在函数组件中不涉及<code>this</code>的处理！！</li> <li>内部涉及的函数需要重新的构建{这些函数的作用域(函数执行的上级上下文)，是每一次执行<code>DEMO</code>产生的闭包}</li> <li>每一次执行<code>DEMO</code>函数，也会把<code>useState</code>重新执行，但是：
+ 执行<code>useState</code>，只有第一次，设置的初始值会生效，其余以后再执行，获取的状态都是最新的状态值「而不是初始值」
+ 返回的修改状态的方法，每一次都是返回一个新的</li></ul></li> <li><p><strong>模拟底层实现</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">var</span> _state<span class="token punctuation">;</span>
      <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> _state <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> initialValue<span class="token operator">===</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  _state <span class="token operator">=</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                  _state <span class="token operator">=</span> initialValue
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>_state<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> value<span class="token operator">===</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                  _state <span class="token operator">=</span> <span class="token function">value</span><span class="token punctuation">(</span>_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                  _state <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 通知视图更新</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>_state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p><strong>useState进阶细节处理</strong></p> <ol><li><p>不像类组件中的<code>this.setState</code>一样，<strong>不支持部分状态的更新</strong>，每次都是修改的整体状态</p> <ul><li>官方建议是：需要多个状态，就把<code>useState</code>执行多次即可</li> <li>其他处理方案<div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">let</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">supNum</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token literal-property property">oppNum</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token comment">//在修改值之前，先把原有的所有状态，都展开赋值给新对象，再去修改要改动的那一项值即可</span>
          <span class="token literal-property property">supNum</span><span class="token operator">:</span> state<span class="token punctuation">.</span>supNum <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li> <li><p><code>useState</code>自带了性能优化的机制：</p> <ul><li>每一次修改状态值的时候，会拿最新要修改的值和之前的状态值做比较「基于<code>Object.is</code>作比较」</li> <li>如果发现两次的值是一样的，则不会修改状态，也不会让视图更新「可以理解为：类似于<code>PureComponent</code>，在<code>shouldComponentUpdate</code>中做了浅比较和优化」<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> setX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">/* 案例一：渲染一次，结果为11 */</span>
            <span class="token function">setX</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

                  <span class="token comment">/* 案例二：渲染一次，结果为20 */</span>
            <span class="token function">setX</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// prev:存储上一次的状态值</span>
            <span class="token keyword">return</span> prev <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">//返回的信息是我们要修改的状态值</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

                  <span class="token comment">/* 案例三：渲染两次flushSync一次，setX一次，结果为11，
                  后续因为作用域的问题，x+1还是11所以不会触发剩下的setX 
                  */</span>
            <span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setX</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ul></li> <li><p>设置初始值惰性处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token keyword">let</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//只有第一次渲染的时候才会执行取值代码</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">,</span>
      <span class="token keyword">return</span> x <span class="token operator">+</span> y 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol></li></ol> <h3 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> <strong>useEffect</strong></h3> <ol><li><p><strong><font color="red">作用：在函数组件中，使用生命周期函数,遇到修改某个状态后（视图更新后），想要依赖新数据做一些事情，不能直接在代码下面编写，只能在新闭包中获取新值，也就是基于useEffect设置状态的依赖，去执行!!!!</font></strong></p></li> <li><p><strong>语法分析</strong></p> <ol><li><p><code>useEffect(callback)</code></p> <ul><li>第一次渲染完毕后，执行<code>callback</code>，等价于 <code>componentDidMount</code></li> <li>在组件每一次更新完毕后，也会执行<code>callback</code>，等价于 <code>componentDidUpdate</code></li></ul></li> <li><p><code>useEffect(callback,[])</code>：设置了，但是无依赖</p> <ul><li><strong>只有第一次渲染完毕后</strong>，才会执行callback，等价于 <code>componentDidMount</code></li></ul></li> <li><p><code>useEffect(callback,[依赖的状态(多个状态)])</code>：</p> <ul><li>第一次渲染完毕会执行<code>callback</code></li> <li>当依赖的状态值(或者多个依赖状态中的一个)发生改变，也会触发<code>callback</code>执行</li> <li>但是依赖的状态如果没有变化，在组件更新的时候，<code>callback</code>是不会执行的</li></ul></li> <li><p>返回函数写法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">let</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@1'</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>  <span class="token comment">// 获取最新的状态值</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@4'</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>   <span class="token comment">//获取的是上一次的状态值</span>
            <span class="token comment">// 返回的小函数，会在组件释放的时候执行</span>
            <span class="token comment">// 如果组件更新，会把上一次返回的小函数执行「可以“理解为”上一次渲染的组件释放了」</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol></li> <li><p><strong>底层逻辑</strong></p> <ul><li>第一次渲染的时候，调用<code>MountEffect</code>方法把所有<code>useEffct</code>中的<code>callback</code>依次加入到<code>effect</code>链表中</li> <li>等到视图渲染完毕的时候，基于<code>UpdateEffect</code>方法通知<code>effect</code>链表中的<code>callback</code>依次执行，<strong>返回小函数的写法会执行返回一个函数遗留在链表中</strong></li> <li>视图更新的时候，触发第二次渲染，依旧把回调放入<code>effect</code>链表</li> <li>先执行上一次遗留的小函数写法的<code>callback</code>,所以他的执行上下文是第一次的。对于依赖发生变化的<code>effect</code>会触发回调并且执行</li></ul></li> <li><p><strong>useEffect细节</strong></p> <ol><li><strong><font color="red"><code>useEffect</code>必须在函数的最外层上下文中调用</font></strong>，不能把其嵌入到条件判断、循环等操作语句中<div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token keyword">let</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> setNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><strong><code>useEffect</code>如果设置返回值，则返回值必须是一个函数「代表组件销毁时触发」</strong><div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token comment">//下面案例中，callback经过async的修饰，返回的是一个promise实例，不符合要求！！</span>
      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">/* 方案一：promise.then可以控制返回值，如果需要则返回一个函数即可 */</span>
   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
               console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">/* 方案二：用小函数调用或者立即执行函数，这样就可以用async await修饰了 */</span>
       <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
               <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功：'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ol></li> <li><p><strong><code>useLayoutEffect</code>的区别</strong></p> <ul><li><code>useLayoutEffect</code>会阻塞浏览器渲染真实DOM，优先执行<code>Effect</code>链表中的<code>callback</code>；</li> <li><code>useEffect</code>不会阻塞浏览器渲染真实DOM，在渲染真实DOM的同时，去执行Effect链表中的<code>callback</code>；
<ul><li><code>useLayoutEffect</code>设置的<code>callback</code>要优先于<code>useEffect</code>去执行！！</li> <li>在两者设置的<code>callback</code>中，依然可以获取DOM元素「<strong>原因：真实DOM对象已经创建了，区别只是浏览器是否渲染</strong>」</li> <li>如果在<code>callback</code>函数中又修改了状态值「视图又要更新」</li> <li><code>useEffect</code>:浏览器肯定是把第一次的真实已经绘制了，再去渲染第二次真实DOM</li> <li><code>useLayoutEffect</code>:浏览器是把两次真实DOM的渲染，合并在一起渲染的</li></ul></li></ul></li> <li><p><strong>视图更新的步骤：</strong></p> <ol><li>基于<code>babel-preset-react-app</code>把<code>JSX</code>编译为<code>createElement</code>格式</li> <li>把<code>createElement</code>执行，创建出<code>virtualDOM</code></li> <li>基于<code>root.render</code>方法把<code>virtualDOM</code>变为真实DOM对象<code>「DOM-DIFF」</code> <ul><li><code>useLayoutEffect</code>阻塞第四步操作，先去执行<code>Effect</code>链表中的方法「同步操作」</li> <li><code>useEffect</code>第四步操作和<code>Effect</code>链表中的方法执行，是同时进行的「异步操作」</li></ul></li> <li>浏览器渲染和绘制真实DOM对象</li></ol></li></ol> <h3 id="useref"><a href="#useref" class="header-anchor">#</a> <strong>useRef</strong></h3> <ol><li><p><strong>获取方式</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/* 基于“ref={函数}”的方式，可以把创建的DOM元素(或者子组件的实例)赋值给box变量「不推荐」 */</span>
       <span class="token keyword">let</span> box<span class="token punctuation">;</span>
      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;num&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> box <span class="token operator">=</span> x<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
     
     <span class="token comment">/* 基于 React.createRef 创建ref对象来获取想要的内容 */</span>
     <span class="token keyword">let</span> box <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>box<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;num&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>box<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>

      <span class="token comment">/* 基于 useRef Hook函数，创建一个ref对象 */</span>
      <span class="token keyword">let</span> box1 <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>box1<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">&quot;num&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>box1<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p><strong>useRef &amp; createRef 区别</strong></p> <ul><li><code>useRef</code>再每一次组件更新的时候（函数重新执行），再次执行<code>useRef</code>方法的时候，不会创建新的<code>REF</code>对象了，获取到的还是第一次创建的那个<code>REF</code>对象！</li> <li><code>createRef</code>在每一次组件更新的时候，都会创建一个全新的<code>REF</code>对象出来，比较浪费性能！！</li> <li><strong>总结：在类组件中，创建<code>REF</code>对象，我们基于 <code>React.createRef</code> 处理，因为更新的时候只会触发<code>render</code>方法，不会重新创建；但是在函数组件中，为了保证性能，我们应该使用专属的 <code>useRef</code> 处理！</strong></li></ul></li> <li><p><strong>基于<code>forwardRef</code>实现<code>ref</code>转发:获取子组件内部的某个元素</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/* 子组件（函数组件） */</span>
      <span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token string">'xxxxx'</span><span class="token punctuation">)</span> <span class="token comment">//在DEMO中，调用Child的时候，传递的ref对象「x」</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;child-box&quot;</span><span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>span ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span>哈哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">/* 父组件 */</span>
      <span class="token keyword">const</span> <span class="token function-variable function">Demo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;demo&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Child ref<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 函数子组件内部，可以有自己的状态和方法了；如何实现：基于forwardRef实现ref转发的同时，获取函数子组件内部的状态或者方法呢？ =&gt; useImperativeHandle</span>
      <span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'你好世界'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token function-variable function">submit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
      <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 在这里返回的内容，都可以被父组件的REF对象获取到</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                  text<span class="token punctuation">,</span>
                  submit
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;child-box&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>哈哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li></ol> <h3 id="usememo-usecallback"><a href="#usememo-usecallback" class="header-anchor">#</a> <strong>useMemo &amp;&amp; useCallback</strong></h3> <ol><li><p><strong>useMemo（callback,[dependencies]）</strong></p> <ul><li>函数组件的每一次更新，都是把函数重新执行，如果依赖值没有发生变化，我们不执行部分逻辑代码</li> <li><code>useMemo</code>具备计算缓存，在依赖的状态值没有发生改变，<code>callback</code>没有触发执行的时候，取得是上一次计算出来的结果</li> <li><code>useMemo</code>是一个优化的Hook函数，如果函数组件中，有消耗性能/时间的计算操作，则竟可能缓存起来，设置相应的依赖</li></ul></li> <li><p><strong>useCallback（callback,[dependencies]）</strong>：避免重复创建函数，开辟新的堆内存</p> <ul><li><p>组件第一次渲染，<code>useCallback</code>执行，把<code>callback</code>存起来设为<code>XXX</code></p></li> <li><p>组件后续每一次更新，判断依赖的状态值是否改变，如果改变，则重新创建新的函数堆，<strong>如果依赖状态没有更新或者没有设置依赖<code>[]</code>，则<code>xxx</code>获取的一直是第一次创建的函数堆</strong></p></li> <li><p>基于<code>useCallback</code>，可以始终获取第一次创建函数的堆内存地址（或者说函数的引用）</p></li> <li><p>使用时机：
+ 父组件嵌套子组件，父组件要把一个内部的函数，基于属性传递给子组件，此时传递的这个方法，用<code>useCallback</code>处理一下会更好
```jsx
/*  父组件使用useCallback缓存一个callback给子组件传递保证此函数每一次是相同的堆内存    */
const Vote = function Vote() {
const change = useCallback((type) =&gt; {}, [supNum, oppNum]);
return <VoteFooter change="{change}"></VoteFooter>
}</p> <div class="language- extra-class"><pre><code>         /* 子组件需要验证父组件传递的属性是否发生改变 */
         /* 类组件:基于React.PureComponent做浅比较 */
         class VoteFooter extends React.PureComponent{

         }

         /* 函数组件:基于React.memo()作比较  写法一*/       
         const VoteFooter = React.memo(function VoteFooter(props){
            let { change } = props 
            ....
         })
         
         /* 写法二 可以传递第二个参数改成深度比较*/
         import React, { memo } from &quot;react&quot;;
         const VoteFooter = function VoteFooter(props){}
         export default memo(VoteFooter,(preProps,nextProps)=&gt;{
            return JSON.Stringfy(preProps) === JSON.Stringfy(nextProps)
         });
         //注意：React.memo的第二个参数进行深度比较时有一定开销，其产生的开销存在大于子组件reRender的可能
    ```
</code></pre></div></li></ul></li></ol> <h3 id="usereducer"><a href="#usereducer" class="header-anchor">#</a> <strong>useReducer</strong></h3> <ol><li>示例<div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token comment">/*
      useReducer是对useState的升级处理
      + 普通需求处理的时候，基本都是useState直接处理，不会使用useReducer
      + 但是如果一个组件的逻辑很复杂，需要大量的状态/大量修改状态的逻辑，此时使用useReducer管理这些状态会更好一些
      @1 不需要再基于useState一个个的去创建状态了
      @2 所有状态修改的逻辑，全部统一化处理了！！
      */</span>
      <span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useReducer<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'plus'</span><span class="token operator">:</span>
                  state<span class="token punctuation">.</span>num<span class="token operator">++</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'minus'</span><span class="token operator">:</span>
                  state<span class="token punctuation">.</span>num<span class="token operator">--</span><span class="token punctuation">;</span>
                  <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> <span class="token function-variable function">A1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token constant">A1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>num<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'plus'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>增加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'minus'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>减少<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">A1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li></ol> <h3 id="自定义hook"><a href="#自定义hook" class="header-anchor">#</a> <strong>自定义Hook</strong></h3> <ol><li><p>作用：提取封装一些公共的处理逻辑</p></li> <li><p><strong>修改部分状态的Hook</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">const</span> <span class="token function-variable function">usePartialState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">usePartialState</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// setState:不支持部分状态更改的</span>
      <span class="token comment">// setPartial:我们期望这个方法可以支持部分状态的更改</span>
      <span class="token keyword">const</span> <span class="token function-variable function">setPartial</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">setPartial</span><span class="token punctuation">(</span><span class="token parameter">partialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token operator">...</span>state<span class="token punctuation">,</span>
                  <span class="token operator">...</span>partialState
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setPartial<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p><strong>首次渲染完统一执行的Hook</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">const</span> <span class="token function-variable function">useDidMount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">useDidMount</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//基于React内置的Hook函数，实现需求</span>
            <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                  <span class="token operator">...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h2 id="复合组件通信"><a href="#复合组件通信" class="header-anchor">#</a> <strong>复合组件通信</strong></h2> <h3 id="单向数据流"><a href="#单向数据流" class="header-anchor">#</a> 单向数据流</h3> <ol><li><strong>理解一：属性的传递方向是单向的</strong> <ul><li>父组件可基于属性把信息传给子组件</li> <li>子组件无法基于属性给父组件传信息；但是可以把父组件传递的方法执行，从而实现子改父</li></ul></li> <li><strong>理解二：关于生命周期函数的延续</strong> <ul><li>父子组件嵌套，处理机制上遵循<strong>深度优先原则</strong>：父组件在操作中，遇到子组件，一定是把子组件处理完，父组件才能继续处理</li> <li>组件第一次渲染
+ 父 <code>willMount</code> --&gt; 父 <code>render</code>
+ 子 <code>willMount</code> --&gt; 子 <code>render</code> --&gt; 子 <code>didMount</code>
+ 父 <code>didMount</code></li> <li>组件更新
+ 父 <code>shouldUpdate</code> --&gt; 父<code>willUpdate</code> --&gt; 父 <code>render</code>
+ 子 <code>willReceiveProps</code> --&gt; 子 <code>shouldUpdate</code> --&gt; 子<code>willUpdate</code> --&gt; 子 <code>render</code> --&gt; 子 <code>didUpdate</code>
+ 父 <code>didUpdate</code></li> <li>父组件销毁：
+ 父 <code>willUnmount</code> --&gt; 释放中
+ 子 <code>willUnmount</code> --&gt; 子销毁
+ 父销毁
<img src="/assets/img/01.6f97f9fd.png" alt=""></li></ul></li></ol> <h3 id="父子通信"><a href="#父子通信" class="header-anchor">#</a> <strong>父子通信</strong></h3> <ol><li><p><strong>类组件</strong></p> <ol><li>以父组件为主导，基于<code>props</code>实现通信：因为只有父组件可以调用子组件
<ul><li>基于<code>props</code>，把信息传递给子组件 （父--&gt;子）</li> <li>基于<code>props.children</code>（插槽），把HTML结构传递给子组件（父--&gt;子）</li> <li>基于<code>props</code>，把方法传递给子组件，子组件可以执行（子--&gt;父）</li></ul></li> <li>父组件基于<code>ref</code>获取子组件实例（或者子组件基于<code>useImperativeHandle</code>暴露的数据和方法）</li></ol> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">class</span> <span class="token class-name">Vote</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 父组件状态 */</span>
            state <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">supNum</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">oppNum</span><span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
            <span class="token comment">/* 父组件方法 */</span>
            <span class="token comment">//设置为箭头函数：不论方法在哪里执行，方法中的this永远都是Vote父组件的实例</span>
            <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">let</span> <span class="token punctuation">{</span> supNum<span class="token punctuation">,</span> oppNum <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
                  type <span class="token operator">===</span> <span class="token string">'sup'</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">supNum</span><span class="token operator">:</span> supNum <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">oppNum</span><span class="token operator">:</span> oppNum <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">let</span> <span class="token punctuation">{</span> supNum<span class="token punctuation">,</span> oppNum <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
                  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VoteMain</span></span> <span class="token attr-name">supNum</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>supNum<span class="token punctuation">}</span></span> <span class="token attr-name">oppNum</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>oppNum<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* 基于PureComponent实现更新优化 */</span>
      <span class="token keyword">class</span> <span class="token class-name">VoteMain</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 属性规则校验 */</span>
            <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">change</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired
            <span class="token punctuation">}</span>
            <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">let</span> <span class="token punctuation">{</span> supNum<span class="token punctuation">,</span> oppNum<span class="token punctuation">,</span> change <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
                  <span class="token keyword">let</span> radio <span class="token operator">=</span> <span class="token string">'--'</span>
                        <span class="token punctuation">,</span> total <span class="token operator">=</span> supNum <span class="token operator">+</span> oppNum
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>total <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> radio <span class="token operator">=</span> <span class="token punctuation">(</span>supNum <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'%'</span>
                  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">支持人数：</span><span class="token punctuation">{</span>supNum<span class="token punctuation">}</span><span class="token plain-text">人</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">反对人数：</span><span class="token punctuation">{</span>oppNum<span class="token punctuation">}</span><span class="token plain-text">人</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">支持比率：</span><span class="token punctuation">{</span>radio<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'sup'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">支持</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'opp'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">danger</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">反对</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li> <li><p><strong>函数组件</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">const</span> <span class="token function-variable function">Vote</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Vote</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">[</span>supNum<span class="token punctuation">,</span> setSupNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span>oppNum<span class="token punctuation">,</span> setOppNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  type <span class="token operator">===</span> <span class="token string">'sup'</span> <span class="token operator">?</span> <span class="token function">setSupNum</span><span class="token punctuation">(</span>supNum <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">setOppNum</span><span class="token punctuation">(</span>oppNum <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vote-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VoteMain</span></span> <span class="token attr-name">supNum</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>supNum<span class="token punctuation">}</span></span> <span class="token attr-name">oppNum</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>oppNum<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VoteFooter</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> <span class="token function-variable function">VoteFooter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VoteFooter</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span> change <span class="token punctuation">}</span> <span class="token operator">=</span> props
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'sup'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">支持</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'opp'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">danger</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">反对</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">}</span>
            VoteFooter<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            VoteFooter<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">change</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>VoteFooter<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ol> <h3 id="context方案实现祖先后代通信"><a href="#context方案实现祖先后代通信" class="header-anchor">#</a> <strong>context方案实现祖先后代通信</strong></h3> <ol><li><p><strong>类组件</strong></p> <ol><li><p>src目录下新建<code>ThemeContext.js</code></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>     <span class="token keyword">import</span> <span class="token punctuation">{</span>createContext<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
     <span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token keyword">export</span> <span class="token keyword">default</span> ThemeContext
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>基于上下文对象中，提供的<code>Provider</code>组件，用来：</p> <ul><li>向上下文中存储信息：<code>value</code>属性指定的值就是要存储的信息</li> <li>当祖先组件更新时，<code>render</code>重新执行，会把最新的状态值存储到上下文对象中<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>  <span class="token keyword">import</span> ThemeContext <span class="token keyword">from</span> <span class="token string">'@/ThemeContext'</span>
  <span class="token keyword">class</span> <span class="token class-name">Dad</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">let</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
             <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeContext.Provide</span></span>
                    <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                          xxx
                    <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeContext.Provide</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul></li> <li><p>在后代组件中，我们需要获取上下文的信息</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>     <span class="token comment">/* 方案一：
           1. 导入创建的上下文对象
           2. 给类组件设置静态私有属性  contextType = ThemeContext
           3. 从this.context中获取对应信息即可
     */</span>
     <span class="token keyword">import</span> ThemeContext <span class="token keyword">from</span> <span class="token string">'@/ThemeContext'</span>
     <span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
           <span class="token keyword">static</span> contextType <span class="token operator">=</span> ThemeContext
           <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                 <span class="token keyword">let</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context
                 <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>

     <span class="token comment">/* 方案二：利用Consumer + 函数形参保存了信息
                 多个上下文对象可以采取这种写法
      */</span>
     <span class="token keyword">import</span> ThemeContext <span class="token keyword">from</span> <span class="token string">'@/ThemeContext'</span>
     <span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
           <span class="token keyword">static</span> contextType <span class="token operator">=</span> ThemeContext
           <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                 <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeContext.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                       </span><span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                             <span class="token keyword">let</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> context
                             <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
                       <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text">
                 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeContext.Consumer</span></span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li></ol></li> <li><p><strong>函数组件</strong></p> <ol><li>创建上下文对象没有区别</li> <li>后代组件使用<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token comment">/* 方案一：利用useContext hook 推荐！*/</span>   
      <span class="token keyword">import</span> ThemeContext <span class="token keyword">from</span> <span class="token string">'@/ThemeContext'</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span>useContext<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span>

      <span class="token comment">/* 方案二：利用Consumer */</span>
      <span class="token keyword">import</span> ThemeContext <span class="token keyword">from</span> <span class="token string">'@/ThemeContext'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeContext.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> context
                              <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeContext.Consumer</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ol></li></ol> <h2 id="react样式私有化方案"><a href="#react样式私有化方案" class="header-anchor">#</a> <strong>React样式私有化方案</strong></h2> <ol><li><p><strong>内联样式</strong></p> <ul><li>每个组件的样式，不再基于样式类名处理了，而是设置为行内样式</li> <li><strong>动态设置样式，或者设置权重较高样式可以使用</strong></li> <li>不利于样式的复用，如果提取为一个通用样式对象，则没有代码提示</li> <li>不能使用伪类</li> <li>编译后的样式结构混淆在一起，也不利于优化</li></ul></li> <li><p><strong>基于样式表、样式类名规范</strong></p> <ul><li>例如：路径+组件名 作为组件外层容器的名字</li> <li>组件内部的元素其样式，都基于<code>less/sass/styles</code>嵌入到指定外层容器的样式类名下</li> <li>容易产生权重冲突问题，<strong>超长的选择器前缀造成性能低</strong>，没有真正的动态样式，只能切换类名</li></ul></li> <li><p><strong>CSSModules</strong></p> <ul><li>利用<code>CSSModules</code>实现私有化管理<div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token comment">/* 基本用法 
         sty来接收样式键值对对象，key值就是编写时的类名，值就是编译后的唯一类名。
   */</span>
   <span class="token keyword">import</span> sty <span class="token keyword">from</span> <span class="token string">'@/xxx.module.css'</span>
   <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>sty<span class="token punctuation">.</span>box<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token comment">//sty.box来设置唯一类名</span>

   <span class="token comment">/* 通过添加:global的类名不会被编译 */</span>
   <span class="token operator">:</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">.</span>clearfix</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token literal-property property">clear</span><span class="token operator">:</span>both
   <span class="token punctuation">}</span>

   <span class="token comment">/* 编译后的结果会有link和list的两个类名，实现继承的效果 */</span>      
   <span class="token punctuation">.</span>link<span class="token punctuation">{</span>
         <span class="token literal-property property">composes</span><span class="token operator">:</span>list<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul></li> <li><p><strong>ReactJSS插件</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>     <span class="token keyword">import</span> <span class="token punctuation">{</span>createUseStyles<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-jss'</span>
     <span class="token comment">/* 基于createUseStyles方法，构建组件需要的样式，返回结果是一个自定义hook函数 */</span>       
     <span class="token keyword">const</span> useStyles <span class="token operator">=</span> <span class="token function">createUseStyles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token literal-property property">box</span><span class="token operator">:</span><span class="token punctuation">{</span>
             <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span>
             <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span><span class="token string">'lightblue'</span><span class="token punctuation">,</span>
             <span class="token function-variable function">color</span><span class="token operator">:</span><span class="token parameter">props</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span>color <span class="token comment">//动态传值</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token function-variable function">title</span><span class="token operator">:</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//函数写法只能给最外层类名加</span>
             <span class="token keyword">return</span> <span class="token punctuation">{</span>
                   <span class="token literal-property property">fontSize</span><span class="token operator">:</span>props<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                   <span class="token string-property property">'&amp;:hover'</span><span class="token operator">:</span><span class="token punctuation">{</span>
                         <span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'green'</span>
                   <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>

     <span class="token keyword">const</span> <span class="token function-variable function">Demo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">let</span> <span class="token punctuation">{</span>box<span class="token punctuation">,</span>list<span class="token punctuation">,</span>title<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useStyles</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
             <span class="token literal-property property">size</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span>
             <span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'orange'</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> <span class="token operator">&lt;</span>nav className<span class="token operator">=</span><span class="token punctuation">{</span>box<span class="token punctuation">}</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>h2 className<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span><span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>a className<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">&gt;</span>
     <span class="token punctuation">}</span>

     <span class="token comment">/* 创建一个代理组件（函数组件）：获取基于ReactJSS编写的样式，把获取的样式基于属性传递给类组件 */</span>        
     <span class="token keyword">const</span> <span class="token function-variable function">ProxyComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">ProxyComponent</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">//Component：真实要渲染的组件</span>
       <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token keyword">let</span> sty <span class="token operator">=</span> <span class="token function">useStyles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props <span class="token punctuation">,</span><span class="token operator">...</span>sty<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">//方法执行要返回一个函数组件：我们导出的是这个组件，在app中调用的也是这个组件(HOC)</span>
       <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">ProxyComponent</span><span class="token punctuation">(</span>Demo<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li> <li><p><strong>style-components插件</strong></p> <ol><li>使用方法<div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token comment">/* 
     创建js文件 NavStyle.js
     基于'styled.标签名'这种方式编写需要的样式
        + 样式要写在&quot;es6模板字符串&quot;中
        + 返回并且导出的结果是一个自定义组件
        + 提示插件--vscode-styled-components
    */</span>
   <span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
   <span class="token keyword">export</span> <span class="token keyword">const</span> NavBox <span class="token operator">=</span> styled<span class="token punctuation">.</span>nav<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
         background-color:lightblue;
         width:300px;
         .title{
               font-size:20px;
               color:red
         }
         &amp;:hover{
               color:green
         }
   </span><span class="token template-punctuation string">`</span></span>
   <span class="token keyword">import</span> NavBox <span class="token keyword">from</span> <span class="token string">'@/NavStyle'</span>
         <span class="token keyword">return</span> <span class="token operator">&lt;</span>NavBox<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>NavBox<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li>编写公共通用样式<div class="language-js line-numbers-mode"><pre class="language-js"><code>     <span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
     <span class="token keyword">export</span> <span class="token keyword">const</span> colorRed <span class="token operator">=</span> <span class="token string">'#ff4d4f'</span>
     <span class="token keyword">export</span> <span class="token keyword">const</span> titleSize <span class="token operator">=</span> <span class="token string">'18px'</span>
     <span class="token keyword">export</span> <span class="token keyword">const</span> CommonListBox <span class="token operator">=</span> styled<span class="token punctuation">.</span>ul<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
         box-sizing:border-box;
         padding:10px;
         border:1px solid #999;
         li{
               font-size:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token parameter">props</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;
               white-space:nowrap;
               &amp;:hover{
                     color:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorRed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
               }
         }
     </span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ol></li></ol> <h2 id="react高阶组件"><a href="#react高阶组件" class="header-anchor">#</a> <strong>React高阶组件</strong></h2> <ol><li><p>基本用法：<strong>利用JS中的闭包（珂里化函数）实现的组件代理</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>     <span class="token keyword">const</span> <span class="token function-variable function">Demo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">//Demo组件</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">const</span> <span class="token function-variable function">ProxyTest</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">ProxyTest</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token keyword">let</span> isUse <span class="token operator">=</span> <span class="token boolean">false</span>
             <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">,</span>isUse<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">ProxyTest</span><span class="token punctuation">(</span>Demo<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>我们可以在代理组件中，经过业务逻辑的处理，获取一些信息，然后基于属性的方案，传递给我们最终要渲染的组件</p></li></ol> <h2 id="react生态圈"><a href="#react生态圈" class="header-anchor">#</a> <strong>React生态圈</strong></h2> <h2 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> <strong>react-redux</strong></h2> <ol><li><p><code>react-redux</code>的好处</p> <ul><li><code>react-redux</code>内部自己创建了上下文对象，并且我们可以把<code>store</code>放在上下文中，在组件中使用的时候，无需我们自己再获取上下文中的<code>store</code>了，它可以帮我们获取到</li> <li>在组件中，无需再基于<code>getState</code>获取公共状态，也无需手动把让组件更新的方法放入事件池中了<div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>        <span class="token comment">/* index.jsx */</span>
        <span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigProvider</span></span> <span class="token attr-name">locale</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Vote</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConfigProvider</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* xxx.jsx 
           connect(mapStateToProps,mapDispatchToProps)
              + mapStateToProps:把需要使用的属性返回给组件，组件用props接收
              + mapDispatchToProps:把需要派发的任务，当做属性传递给组件
        */</span>
        <span class="token keyword">import</span> action <span class="token keyword">from</span> <span class="token string">&quot;../store/actions&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
        <span class="token comment">//标准写法</span>
        <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
              <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">supNum</span><span class="token operator">:</span> state<span class="token punctuation">.</span>vote<span class="token punctuation">.</span>supNum<span class="token punctuation">,</span>
                    <span class="token literal-property property">oppNum</span><span class="token operator">:</span> state<span class="token punctuation">.</span>vote<span class="token punctuation">.</span>oppNum<span class="token punctuation">,</span>
                    <span class="token literal-property property">num</span><span class="token operator">:</span> state<span class="token punctuation">.</span>vote<span class="token punctuation">.</span>num
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                          <span class="token function">support</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'xxx'</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">,</span>
                          <span class="token function">oppose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>action<span class="token punctuation">.</span>vote<span class="token punctuation">.</span><span class="token function">oppose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token punctuation">)</span><span class="token punctuation">(</span>VoteFooter<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//简便写法</span>
        <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>vote<span class="token punctuation">,</span>action<span class="token punctuation">.</span>vote<span class="token punctuation">)</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div></li></ul></li> <li><p><strong>源码</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/* Provider:把传递进来的store放在根组件的上下文中 */</span>
      <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Provider</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> store<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                  store
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">/* connect:获取上下文中的store，然后把公共状态、要派发的方法等，都基于属性传递给需要渲染的组件；把让组件更新的方法放在redux事件池中！ */</span>
      <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理默认值</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mapStateToProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 不写则:什么都不给组件传递</span>
                  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mapDispatchToProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 不写则:把dispatch方法传递给组件</span>
                  <span class="token keyword">return</span> <span class="token punctuation">{</span>
                  dispatch
                  <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">currying</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Component:最终要渲染的组件「Vote」</span>
            <span class="token comment">// HOC:我们最后基于export default导出的组件</span>
            <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 我们需要获取上下文中的store</span>
                  <span class="token keyword">let</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span> getState<span class="token punctuation">,</span> dispatch<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">;</span>

                  <span class="token comment">// 向事件池中加入让组件更新的办法</span>
                  <span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 组件释放的时候执行：把放在事件池中的函数移除掉</span>
                        <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token comment">// 把mapStateToProps/mapDispatchToProps，把执行的返回值，作为属性传递给组件！！</span>
                  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  nextState <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>state<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                  <span class="token keyword">let</span> dispatchProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> mapDispatchToProps <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 是函数直接执行即可</span>
                  dispatchProps <span class="token operator">=</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 是actionCreator对象,需要经过bindActionCreators处理</span>
                  dispatchProps <span class="token operator">=</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span>mapDispatchToProps<span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>

                  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component
                  <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span>
                  <span class="token punctuation">{</span><span class="token operator">...</span>nextState<span class="token punctuation">}</span>
                  <span class="token punctuation">{</span><span class="token operator">...</span>dispatchProps<span class="token punctuation">}</span>
                  <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div></li></ol> <h2 id="mobx"><a href="#mobx" class="header-anchor">#</a> <strong>mobx</strong></h2> <ol><li>mobx是一个简单可扩展的状态管理库，它开发难度低，开发代码量少，渲染性能好</li></ol> <h2 id="recoil-专门为react而生的"><a href="#recoil-专门为react而生的" class="header-anchor">#</a> <strong>recoil（专门为React而生的）</strong></h2> <ol><li><p><strong>核心概念</strong></p> <ol><li><strong><code>atom</code>(原子状态)</strong> <ul><li>atom是存储状态的最小单位</li> <li>atomFamily--允许传参</li></ul></li> <li><strong><code>selector</code>（衍生状态 | 计算状态）</strong> <ul><li>selector是以**其他状态（atom | selector）**为参数的纯函数</li> <li>selectorFamily --允许传参</li> <li>constSelector</li> <li>errorSelector</li></ul></li></ol></li> <li><p>使用步骤
+
```js
/* 1. 需要用到recoil的组件包裹起来 */
import React from 'react'
import { RecoilRoot } from 'recoil'
import App from './App'</p> <div class="language- extra-class"><pre><code>        return (
           &lt;RecoilRoot&gt;
                 &lt;App /&gt;
           &lt;/RecoilRoot&gt;
        )
        /* 2. 定义atom 
             + key：在 RecoilRoot 作用域中是唯一的
             + default：静态值、函数、异步函数。
        */
        export const nameState = atom({
           key: 'nameState',
           default: 'ConardLi'
        });
        /* 3.订阅和更新状态
             + useRecoilState：类似 useState 的一个 Hook，可以取到 atom 的值以及 setter 函
             + useSetRecoilState：只获取 setter 函数，如果只使用了这个函数，状态变化不会导致组件重新渲染
             + useRecoilValue：只获取状态
         */
           import { nameState } from './store'
           // useRecoilState
           const NameInput = () =&gt; {
             const [name, setName] = useRecoilState(nameState);
               const onChange = (event) =&gt; {
                   setName(event.target.value);
                 };
               return &lt;&gt;
                 &lt;input type=&quot;text&quot; value={name} onChange={onChange} /&gt;
                 &lt;div&gt;Name: {name}&lt;/div&gt;
               &lt;/&gt;;
           }

           // useRecoilValue
           const SomeOtherComponentWithName = () =&gt; {
              const name = useRecoilValue(nameState);
                 return &lt;div&gt;{name}&lt;/div&gt;;
           }

           // useSetRecoilState  
           const SomeOtherComponentThatSetsName = () =&gt; {
              const setName = useSetRecoilState(nameState);
                 return &lt;button onClick={() =&gt; setName('Jon Doe')}&gt;Set Name&lt;/button&gt;;
           }
        /* 4.派生状态
              + selector 表示一段派生状态，它使我们能够建立依赖于其他 atom 的状态。它有一个强制性的 get 函数，其作用与 redux 的 reselect 或 MobX 的 @computed 类似。
         */
        const lengthState = selector({
           key: 'lengthState', 
           get: ({get}) =&gt; {
           const text = get(nameState);
             return text.length;
           },
        });

        function NameLength() {
           const length = useRecoilValue(charLengthState);
           return &lt;&gt;Name Length: {length}&lt;/&gt;;
        }
        /* 5.异步状态
         */
        const userNameQuery = selector({
           key: 'userName',
           get: async ({get}) =&gt; {
           const response = await myDBQuery({
                 userID: get(currentUserIDState),
           });
           return response.name;
           },
        });

        function CurrentUserInfo() {
           const userName = useRecoilValue(userNameQuery);
           return &lt;div&gt;{userName}&lt;/div&gt;;
        }
        /* 6.捕获状态
              + Suspense：捕获所有异步状态
              + ErrorBoundary:错误捕获
         */
        function MyApp() {
           return (
           &lt;RecoilRoot&gt;
                 &lt;ErrorBoundary&gt;
                 &lt;React.Suspense fallback={&lt;div&gt;Loading...&lt;/div&gt;}&gt;
                 &lt;CurrentUserInfo /&gt;
                 &lt;/React.Suspense&gt;
                 &lt;/ErrorBoundary&gt;
           &lt;/RecoilRoot&gt;
           );
        }
   ```
</code></pre></div></li></ol> <h2 id="react-router-dom"><a href="#react-router-dom" class="header-anchor">#</a> <strong>react-router-dom</strong></h2> <ol><li><p><strong>V5版本写法</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> <span class="token punctuation">{</span> HashRouter<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> Redirect<span class="token punctuation">,</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
      <span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">App</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 
      1.基于&lt;HashRouter&gt;把所有要渲染的内容包起来，开启HASH路由 
            + 后续用到的&lt;Route&gt;、&lt;Link&gt;等，都需要在HashRouter/BrowserRouter中使用
            + 开启后，整个页面地址，默认会设置一个 #/ 哈希值
        Link实现路由切换/跳转的组件
            + 最后渲染完毕的结果依然是A标签
            + 它可以根据路由模式，自动设定点击A切换的方式
      */</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>HashRouter<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>NavBox<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/b&quot;</span><span class="token operator">&gt;</span><span class="token constant">B</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/c&quot;</span><span class="token operator">&gt;</span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>NavBox<span class="token operator">&gt;</span>

      <span class="token punctuation">{</span><span class="token comment">/* 2.路由容器:每一次页面加载或者路由切换完毕，都会根据当前的哈希值，到这里和每一个Route进行匹配，把匹配到的组件，放在容器中渲染！！ 
            + Switch：确保路由中，只要有一项匹配，则不再继续向下匹配
            + exact：设置匹配模式为精准匹配
      */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">A</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/b&quot;</span> component<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">B</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/c&quot;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token punctuation">{</span><span class="token comment">/* 3.当路由地址匹配后，先把render函数执行，返回的返回值就是我们需要渲染的内容
            在此函数中，可以处理一些事情，例如：登录态检验....*/</span><span class="token punctuation">}</span>
            <span class="token keyword">let</span> isLogin <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">C</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token comment">/* 4.放在最后一项，path设置※或者不写，意思是：以上都不匹配，则执行这个规则
                  &lt;Route path=&quot;*&quot; component={404组件} /&gt; 
               当然也可以不设置404组件，而是重定向到默认 / 地址：
                  &lt;Redirect from=&quot;&quot; to=&quot;&quot; exact/&gt;
                  + from:从哪个地址来
                  + to:重定向的地址
                  + exact是对from地址的修饰，开启精准匹配
                  */</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>HashRouter<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div></li> <li><p><strong>路由表配置</strong></p> <ul><li>目录
|-src
|-router
index.js
routes.js</li> <li>routes.js<div class="language-js line-numbers-mode"><pre class="language-js"><code>        <span class="token comment">/* 
              配置路由表：数组，数组中每一项就是每一个需要配置的路由规则
              + redirect:true 此配置是重定向
              + from:来源的地址
              + to:重定向的地址
              + exact:是否精准匹配
              + path:匹配的路径
              + component:渲染的组件
              + name:路由名称(命名路由)
              + meta:{} 路由元信息「包含当前路由的一些信息，当路由匹配后，我们可以拿这些信息做一些事情...」
              + children:[] 子路由
              + ...
        */</span>
        <span class="token comment">//事先只把A组件（页面加载就渲染的组件）导入进来，就是打包到bundle.js中</span>
        <span class="token keyword">import</span> <span class="token punctuation">{</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'../views/A'</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> aRoutes <span class="token keyword">from</span> <span class="token string">'./aRoutes'</span><span class="token punctuation">;</span>
        <span class="token comment">// 一级路由的理由表</span>
        <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exact</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> aRoutes
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/b'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
        <span class="token comment">/* 借助React.lazy函数和ES6中的import实现
              1. 分割打包：每个组件单独打包为一个js
              2. 按需导入/加载：最开始渲染页面不会加载这些单独的js，只有路由规则匹配成功，需要渲染这个组件的时候，再去加载
              3. 注释为webpack来配置别名
         */</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;B&quot; */</span><span class="token string">'../views/B'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/c/:id?/:name?'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/C'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'/a'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">export</span> <span class="token keyword">default</span> routes<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div></li> <li>index.js<div class="language-js line-numbers-mode"><pre class="language-js"><code>   <span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">import</span> <span class="token punctuation">{</span> Switch<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

   <span class="token comment">/* 调用组件的时候，基于属性传递路由表进来，我们根据路由表，动态设定路由的匹配规则 */</span>
   <span class="token keyword">const</span> <span class="token function-variable function">RouterView</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">RouterView</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 获取传递的路由表</span>
   <span class="token keyword">let</span> <span class="token punctuation">{</span> routes <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* 循环设置路由匹配规则 */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span>routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> <span class="token punctuation">{</span> redirect<span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> exact<span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Component <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">,</span>
              config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>redirect<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 重定向的规则</span>
                    config <span class="token operator">=</span> <span class="token punctuation">{</span> to <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> config<span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>exact<span class="token punctuation">)</span> config<span class="token punctuation">.</span>exact <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Redirect key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>config<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token comment">// 正常匹配规则</span>
              config <span class="token operator">=</span> <span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>exact<span class="token punctuation">)</span> config<span class="token punctuation">.</span>exact <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Route key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>config<span class="token punctuation">}</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// 路由懒加载，一定要Suspense的支持</span>
              <span class="token comment">// 统一基于RENDER函数处理，当某个路由匹配，后期在这里可以做一些其它事情</span>
              <span class="token comment">// Suspense.fallback：在异步加载的组件没有处理完成之前，先展示的Loading效果！！</span>
              <span class="token keyword">return</span> <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>正在处理中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">export</span> <span class="token keyword">default</span> RouterView<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li></ul></li> <li><p><strong>路由懒加载</strong></p> <ol><li>原因：如果我们事先把所有组件全部导入进来，再基于Route做路由匹配，这样最后打包的时候，全部组件打包到一个JS中，这样JS会非常大，第一次加载页面，从服务器获取这个文件就会用很久的时间，导致此阶段页面一直白屏。虽然优化方案中，有建议合成为一个JS文件，这样减少HTTP网络请求的次数，但是这个JS文件不宜过大</li> <li>处理方案：<strong>分割打包JS，按需异步加载JS</strong> <ul><li>我们只把最开始展示的内容/组件打包到<strong>主JS</strong>中，其他的组件内容打包成独立的JS（<strong>一般都是几个组件按照模块合并在一起打包</strong>）</li> <li>页面加载的时候，首先只把<strong>主JS</strong><code>bundle.js</code>请求回来渲染，其余的JS先不加载</li> <li>当路由切换的时候，和哪个规则匹配，想要渲染哪个组件，再把这个组件所在的JS文件，动态导入进来进行渲染即可</li></ul></li></ol></li> <li><p><strong>路由传参</strong></p> <ol><li><p><code>&lt;Route path='/a' component={A}&gt;</code></p> <ul><li>给A组件传递三个属性：<code>history、location、match</code></li> <li>类组件我们基于<code>props/this.props</code>获取传递的属性值！</li></ul></li> <li><p><code>&lt;Route path='/a' render={(props)=&gt;{return &lt;A {...props} /&gt;}}&gt;</code></p></li></ol></li> <li><p><strong>react-routerV6版本和V5版本的区别</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>      <span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HashRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HomeHead</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span><span class="token comment">/* 
                              1. 所有的路由匹配规则，放在&lt;Routes&gt;中；每一条规则的匹配，还是基于&lt;Route&gt;；不再需要Switch，默认就是一个匹配成功，就不在匹配下面的了。
                              2. 路由匹配成功，不再基于component/render控制渲染的组件，而是基于element，语法格式是&lt;Component/&gt;
                              3. 不再需要exact，默认每一项匹配都是精准匹配
                              4. 原有的&lt;Redirect&gt;操作，被 &lt;Navigate to=&quot;/&quot; /&gt; 代替！！
                                    + 遇到 &lt;Navigate/&gt; 组件，路由就会跳转，跳转到to指定的路由地址
                                    + 设置replace属性为true，则不会新增地址记录，而是替换现有记录
                                    + &lt;Navigate to={{...}}/&gt; to的值可以是一个对象：pathname需要跳转的地址、search问号传参信息
                              5. index属性也是默认跳转，不推荐
                        */</span><span class="token punctuation">}</span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                              </span><span class="token punctuation">{</span><span class="token comment">/* v6版本中，要求所有的路由(二级或者多级路由)，不在分散到各个组件中编写，利用Route双闭合标签统一都写在一起进行处理！！ */</span><span class="token punctuation">}</span><span class="token plain-text">
                              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A1</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A2</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A3</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/b<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">B</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/c/:id?/:name?<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">C</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span><span class="token comment">/* 如果以上都不匹配，我们可以渲染404组件，也可以重定向到A组件「传递不同的问号参数信息」 */</span><span class="token punctuation">}</span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                              <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
                              <span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">'?from=404'</span>
                        <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">HashRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> <span class="token function-variable function">A</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DemoBox</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">A1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">A2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a/a3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">A3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span><span class="token comment">/* Outlet：路由容器，用来渲染二级(多级)路由匹配的内容 */</span><span class="token punctuation">}</span><span class="token plain-text">
                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">DemoBox</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">/*注意点：
            1. 在v6中 ，即便组件是基于&lt;Route&gt;匹配渲染的，也不会基于属性把history/location/match传递给组件！只能基于Hook函数处理！！
            2. Router「HashRouter或BrowserRouter」内部包裹的组件，才能使用“路由Hook”
            3. 类组件只能如下处理：
                  + 构建路由表的时候，让基于&lt;Route&gt;匹配渲染的组件，可以基于属性获取需要的信息
                  + 不是基于&lt;Route&gt;匹配渲染的组件，我们需要自己重写withRouter「v6中干掉了这个API」，让其和基于&lt;Route&gt;匹配渲染的组件，具备相同的属性！！
            4.  在react-router-dom v6中 ，实现路由跳转的方式：
                  + &lt;Link/NavLink to=&quot;/a&quot; &gt; **点击**实现跳转路由
                  + &lt;Navigate to=&quot;/a&quot; /&gt; 遇到这个组件就会跳转
                  + 编程式导航：取消了history对象，基于navigate函数实现路由跳转
      */</span>
      
      <span class="token comment">/* 编程式导航以及传参方案 */</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span> useNavigate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//跳转并替换现有地址</span>
      <span class="token comment">// 1. 问号显式传参 在地址中展示，不安全，有长度限制，但是刷新的时候不会丢参数</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">'/c'</span><span class="token punctuation">,</span><span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">'?id=100&amp;name=zhufeng'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">'/c'</span><span class="token punctuation">,</span><span class="token literal-property property">search</span><span class="token operator">:</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhufeng'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//qs处理传参</span>

      <span class="token comment">// 2. 路径参数 也有长度限制等...</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/c/100/zhufeng</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/c/:id?/:name?<span class="token punctuation">&quot;</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">C</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>

      <span class="token comment">//3. 隐式传参信息 地址中看不见，但是也不能刷新，刷新就会丢失</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//历史记录池替换现有地址</span>
                  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhufeng'</span>
                  <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/* 常用的路由Hook以及获取传参信息
            1. useNavigate  -&gt; 代替5中的 useHistory   ：实现编程式导航
            2. useLocation 「5中也有」：获取location对象信息  pathname/search/state….
            3. useSearchParams「新增的」：获取问号传参信息，取到的结果是一个URLSearchParams对象
            4. useParams「5中也有」：获取路径参数匹配的信息
            6. useMatch(pathname) -&gt; 代替5中的 useRouteMatch「5中的这个Hook有用，可以基于params获取路径参数匹配的信息；但是在6中，这个Hook需要我们自己传递地址，而且params中也没有获取匹配的信息，用的就比较少了！！」
       */</span>

      <span class="token comment">// useLocation  问号传参接收</span>
      <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">const</span> usp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//location.search:&quot;?id=100&amp;name=zhufeng&quot;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>usp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

      <span class="token comment">// useSearchParams  问号传参接收 推荐</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>usp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//返回的数组第一项就是参数</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>usp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// useParams 路径传参接收</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//=&gt;{id:100,name:'zhufeng'}</span>

      <span class="token comment">// 隐式传参接收</span>
      <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div></li> <li><p><strong>V6路由表搭建</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> <span class="token punctuation">{</span> Navigate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'../views/A'</span><span class="token punctuation">;</span>

      <span class="token comment">/* A版块的二级路由 */</span>
      <span class="token keyword">const</span> aRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">&quot;/a/a1&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a/a1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'a-a1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;AChild&quot; */</span><span class="token string">'../views/a/A1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//指定打包名字</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a/a2'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'a-a2'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;AChild&quot; */</span><span class="token string">'../views/a/A2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a/a3'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'a-a3'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName:&quot;AChild&quot; */</span><span class="token string">'../views/a/A3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">/* 一级路由 */</span>
      <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">&quot;/a&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> aRoutes
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/b'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/B'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/c/:id?/:name?'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../views/C'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">'/a'</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">'?from=404'</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> routes<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li> <li><p><strong>递归构建</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>      <span class="token keyword">import</span> <span class="token punctuation">{</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./routes&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> <span class="token punctuation">{</span> Routes<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> useNavigate<span class="token punctuation">,</span> useLocation<span class="token punctuation">,</span> useParams<span class="token punctuation">,</span> useSearchParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

      <span class="token comment">/* 统一渲染的组件:在这里可以做一些事情「例如：权限/登录态校验，传递路由信息的属性...」 */</span>
      <span class="token keyword">const</span> <span class="token function-variable function">Element</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Element</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span> <span class="token literal-property property">component</span><span class="token operator">:</span> Component <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

            <span class="token comment">// 把路由信息先获取到，最后基于属性传递给组件：只要是基于&lt;Route&gt;匹配渲染的组件，都可以基于属性获取路由信息</span>
            <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span>usp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 最后要把Component进行渲染</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component navigate<span class="token operator">=</span><span class="token punctuation">{</span>navigate<span class="token punctuation">}</span> location<span class="token operator">=</span><span class="token punctuation">{</span>location<span class="token punctuation">}</span> params<span class="token operator">=</span><span class="token punctuation">{</span>params<span class="token punctuation">}</span> usp<span class="token operator">=</span><span class="token punctuation">{</span>usp<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">/* 递归创建Route */</span>
      <span class="token keyword">const</span> <span class="token function-variable function">createRoute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* 空文档标签包裹，因为有多个route并列 */</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> 
                  <span class="token punctuation">{</span>routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">let</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
                        <span class="token comment">// 每一次路由匹配成功，不直接渲染我们设定的组件，而是渲染Element；在Element做一些特殊处理后，再去渲染我们真实要渲染的组件！！</span>
                        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Route key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span> path<span class="token operator">=</span><span class="token punctuation">{</span>path<span class="token punctuation">}</span> element<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Element <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span><span class="token comment">/* 基于递归方式，绑定子集路由 */</span><span class="token punctuation">}</span>
                        <span class="token punctuation">{</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">createRoute</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">/* 路由容器 */</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">RouterView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>正在处理中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>Routes<span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span><span class="token function">createRoute</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">/* 创建withRouter */</span>
      <span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">withRouter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Component:真实要渲染的组件</span>
            <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 提前获取路由信息，作为属性传递给Component</span>
                  <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span>usp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> navigate<span class="token operator">=</span><span class="token punctuation">{</span>navigate<span class="token punctuation">}</span> location<span class="token operator">=</span><span class="token punctuation">{</span>location<span class="token punctuation">}</span> params<span class="token operator">=</span><span class="token punctuation">{</span>params<span class="token punctuation">}</span> usp<span class="token operator">=</span><span class="token punctuation">{</span>usp<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">//withRouter使用</span>
      <span class="token operator">&lt;</span>HomeHead x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>HomeHead<span class="token operator">&gt;</span>
      <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>HomeHead<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div></li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/18/2023, 2:49:30 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-070bf1cb></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-65133105 data-v-65133105><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-65133105><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-65133105></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-65133105></path></svg></div><div class="kanbanniang" data-v-ee8d62e6><div class="banniang-container" style="display:;" data-v-ee8d62e6><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-ee8d62e6>
      欢迎来到我的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-ee8d62e6><i class="kbnfont kbn-ban-home ban-home" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-message message" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-close close" data-v-ee8d62e6></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-ee8d62e6><i class="kbnfont kbn-ban-info info" data-v-ee8d62e6></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-ee8d62e6></i></div> <canvas id="banniang" width="250" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-ee8d62e6></canvas></div> <div class="showBanNiang" style="display:none;" data-v-ee8d62e6>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/assets/js/app.6977d595.js" defer></script><script src="/assets/js/4.94eb5d8a.js" defer></script><script src="/assets/js/1.e6e6e62e.js" defer></script><script src="/assets/js/20.daa8a4dd.js" defer></script>
  </body>
</html>
