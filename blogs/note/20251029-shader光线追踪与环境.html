<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Shader 进阶 - 光线追踪与环境映射的极致渲染 | EnlightenCode</title>
    <meta name="description" content="EnlightenCode,ergo,blog">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.DYxhn1na.css" as="style">
    
    <script type="module" src="/assets/app.Bcf5gyVN.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.0RWXCdb7.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DLSH1pMh.js">
    <link rel="modulepreload" href="/assets/blogs_note_20251029-shader光线追踪与环境.md.kkeECx9Y.lean.js">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="icon" href="/cat.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="theme-container"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>EnlightenCode</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blogs/product/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>我的产品</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blogs/favorites/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>工具库</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blogs/note/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>学习笔记</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blogs/word/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>工作随记</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>前端</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>前端基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/css/" data-v-43f1e123><!--[-->CSS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/javascript/" data-v-43f1e123><!--[-->Javascript<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>前端框架</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/frame/vue/" data-v-43f1e123><!--[-->vue<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/frame/react/" data-v-43f1e123><!--[-->react<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>前端进阶</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/engineering/" data-v-43f1e123><!--[-->工程化<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/frontpromote/browser&amp;network/" data-v-43f1e123><!--[-->浏览器与网络<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/frontpromote/performance/" data-v-43f1e123><!--[-->性能优化<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>前端可视化</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/visualization/canvas/" data-v-43f1e123><!--[-->canvas<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/visualization/svg/" data-v-43f1e123><!--[-->svg<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/visualization/three/" data-v-43f1e123><!--[-->ThreeJS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/blogs/visualization/webgl/" data-v-43f1e123><!--[-->WebGL<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>后端</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/blogs/backend/node/" data-v-43f1e123><!--[-->node<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/blogs/backend/nest/" data-v-43f1e123><!--[-->nest<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blogs/interview/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>面试</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blogs/algorithm/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>算法</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://imgprocessing.liuhuakawaii.icu" target="_blank" rel="noreferrer" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>图像工具集</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/liuhuakawaii" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-twitter" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/liuhuakawaii" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="..." aria-label="twitter" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-twitter" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 is-link" data-v-575e6a36 data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/note/" data-v-b8d55f3b><!--[--><h2 class="text" data-v-b8d55f3b>前端基础</h2><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/note/html.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>HTML基础知识</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/css/" data-v-b8d55f3b><!--[--><h3 class="text" data-v-b8d55f3b>CSS</h3><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/note/css.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>CSS基础知识</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/css/csstips/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>CSS技巧</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/css/demo/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>CSS Demo</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/javascript/" data-v-b8d55f3b><!--[--><h3 class="text" data-v-b8d55f3b>JavaScript</h3><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/note/js.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>JavaScript基础知识</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/javascript/jstips/20220705.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>类型转换</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/javascript/es6/20230301.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>原型和原型链</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frontpromote/browser&amp;network/20210820.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>事件循环</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/javascript/es6/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>ES6进阶知识</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>前端框架</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frame/vue/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Vue</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frame/react/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>React</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>前端进阶</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><section class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/engineering/" data-v-b8d55f3b><!--[--><h3 class="text" data-v-b8d55f3b>前端工程化</h3><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/engineering/20240910.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>工程化详解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/tool/20210718.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Webpack 5 配置</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/visualization/" data-v-b8d55f3b><!--[--><h3 class="text" data-v-b8d55f3b>前端可视化</h3><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/visualization/three/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>ThreeJS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/visualization/canvas/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>canvas</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/visualization/svg/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>svg</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/visualization/webgl/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>WebGL</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frontpromote/browser&amp;network/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>浏览器与网络</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frontpromote/performance/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>性能优化</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/algorithm/" data-v-b8d55f3b><!--[--><h3 class="text" data-v-b8d55f3b>算法</h3><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/algorithm/20220212.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>排序算法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/algorithm/20221209.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>栈与队列</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/algorithm/20221118.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>数组与链表核心技巧</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 is-link" data-v-575e6a36 data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/interview/" data-v-b8d55f3b><!--[--><h2 class="text" data-v-b8d55f3b>前端面试</h2><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/interview/20241116.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>CSS专题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/interview/20241115.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>JavaScript专题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frontpromote/browser&amp;network/20241117.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>浏览器专题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/interview/20241118.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>工程化专题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/frontpromote/browser&amp;network/20241120.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>网络专题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/interview/20241122.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>算法专题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 is-link" data-v-575e6a36 data-v-b8d55f3b><div class="item" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/backend/" data-v-b8d55f3b><!--[--><h2 class="text" data-v-b8d55f3b>后端</h2><!--]--></a><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/backend/node.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>node</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/blogs/backend/nest.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>nest</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-269c27a6><div class="content" data-v-269c27a6><div class="outline-marker" data-v-269c27a6></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-269c27a6>目录</div><ul class="VPDocOutlineItem root" data-v-269c27a6 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _blogs_note_20251029-shader%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E4%B8%8E%E7%8E%AF%E5%A2%83" data-v-39a288b8><div><h1 id="🌅-shader-进阶-光线追踪与环境映射的极致渲染" tabindex="-1">🌅 Shader 进阶 - 光线追踪与环境映射的极致渲染 <a class="header-anchor" href="#🌅-shader-进阶-光线追踪与环境映射的极致渲染" aria-label="Permalink to &quot;🌅 Shader 进阶 - 光线追踪与环境映射的极致渲染&quot;">​</a></h1><h2 id="_1-🌟-传统渲染-vs-光线追踪" tabindex="-1">1. 🌟 传统渲染 vs 光线追踪 <a class="header-anchor" href="#_1-🌟-传统渲染-vs-光线追踪" aria-label="Permalink to &quot;1. 🌟 传统渲染 vs 光线追踪&quot;">​</a></h2><h3 id="_1-1-两种根本不同的渲染思路" tabindex="-1">1.1 两种根本不同的渲染思路 <a class="header-anchor" href="#_1-1-两种根本不同的渲染思路" aria-label="Permalink to &quot;1.1 两种根本不同的渲染思路&quot;">​</a></h3><p>在前面所有文章中，我们使用的是<strong>光栅化渲染</strong> (Rasterization)：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>光栅化流程（投影式）:</span></span>
<span class="line"><span>顶点 → 三角形 → 光栅化 → 像素</span></span></code></pre></div><blockquote><p>💡 <strong>类比理解</strong>：光栅化就像用投影仪投幻灯片</p><ul><li>GPU 把 3D 模型的每个三角形&quot;投影&quot;到 2D 屏幕上</li><li>就像手电筒照在墙上，物体产生影子</li><li>快速但有局限：很难模拟真实的反射、折射和阴影</li></ul></blockquote><p><strong>底层本质</strong>：光栅化是<strong>几何驱动</strong>的，遍历场景中的所有三角形，逐个判断它们覆盖了哪些像素。</p><hr><p>但还有另一种完全不同的思路 - <strong>光线追踪</strong> (Ray Tracing)：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>光线追踪流程（物理模拟式）:</span></span>
<span class="line"><span>相机 → 发射光线 → 碰撞检测 → 着色</span></span></code></pre></div><blockquote><p>💡 <strong>类比理解</strong>：光线追踪模拟人眼看世界的过程</p><ul><li>你的眼睛看向某个方向，接收到该方向反射回来的光</li><li>光线追踪反向模拟：从摄像机发射光线，看它击中了什么</li><li>就像用激光笔一点一点扫描场景，记录每个点的颜色</li></ul></blockquote><p><strong>底层本质</strong>：光线追踪是<strong>像素驱动</strong>的，对屏幕上的每个像素发射一条光线，找出这条光线击中了什么物体。</p><h3 id="_1-2-两种方法的优劣对比" tabindex="-1">1.2 两种方法的优劣对比 <a class="header-anchor" href="#_1-2-两种方法的优劣对比" aria-label="Permalink to &quot;1.2 两种方法的优劣对比&quot;">​</a></h3><table><thead><tr><th>特性</th><th>光栅化</th><th>光线追踪</th></tr></thead><tbody><tr><td><strong>原理</strong></td><td>投影三角形到屏幕</td><td>模拟真实光路</td></tr><tr><td><strong>性能</strong></td><td>⚡⚡⚡ 极快</td><td>🐢 慢 (除非硬件RT)</td></tr><tr><td><strong>反射/折射</strong></td><td>❌ 需要技巧 (环境贴图)</td><td>✅ 天然支持</td></tr><tr><td><strong>软阴影</strong></td><td>❌ 困难</td><td>✅ 简单</td></tr><tr><td><strong>全局光照</strong></td><td>❌ 需要烘焙</td><td>✅ 自然产生</td></tr><tr><td><strong>复杂几何</strong></td><td>✅ 三角形数量决定</td><td>✅ SDF可表示任意形状</td></tr></tbody></table><blockquote><p>💡 <strong>为什么光栅化更快？</strong></p><p><strong>硬件层面</strong>：现代 GPU 的核心架构就是为光栅化设计的：</p><ul><li>专用的光栅化单元 (Rasterizer)，硬件级加速</li><li>深度测试 (Z-Buffer) 自动处理遮挡关系</li><li>纹理缓存 (Texture Cache) 优化内存访问</li></ul><p><strong>算法层面</strong>：光栅化的计算复杂度是 <strong>O(三角形数量)</strong>，每个三角形独立处理。</p><p><strong>光线追踪为什么慢？</strong></p><ul><li>需要大量射线-物体求交计算 (Ray-Object Intersection)</li><li>每条光线可能与多个物体相交，需要找到最近的交点</li><li>复杂度是 <strong>O(光线数量 × 物体数量)</strong></li><li>现代硬件 RT Core (如 NVIDIA RTX) 通过 BVH 加速结构优化这一过程</li></ul></blockquote><h3 id="_1-3-gpu上的挑战与解决方案" tabindex="-1">1.3 GPU上的挑战与解决方案 <a class="header-anchor" href="#_1-3-gpu上的挑战与解决方案" aria-label="Permalink to &quot;1.3 GPU上的挑战与解决方案&quot;">​</a></h3><h4 id="挑战-1-加速结构难以在-shader-中实现" tabindex="-1">挑战 1：加速结构难以在 Shader 中实现 <a class="header-anchor" href="#挑战-1-加速结构难以在-shader-中实现" aria-label="Permalink to &quot;挑战 1：加速结构难以在 Shader 中实现&quot;">​</a></h4><p>传统光线追踪依赖 <strong>BVH (Bounding Volume Hierarchy)</strong> 加速结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>BVH 原理：</span></span>
<span class="line"><span>场景物体 → 层层包裹成树形结构 → 快速剔除不相交的分支</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>        根节点(整个场景包围盒)</span></span>
<span class="line"><span>        ╱              ╲</span></span>
<span class="line"><span>    左子树            右子树</span></span>
<span class="line"><span>   (左半场景)        (右半场景)</span></span>
<span class="line"><span>   ╱    ╲           ╱    ╲</span></span>
<span class="line"><span> 物体A  物体B     物体C  物体D</span></span>
<span class="line"><span></span></span>
<span class="line"><span>查询过程：光线先测试根节点，再递归测试子节点，大幅减少测试次数</span></span></code></pre></div><blockquote><p>💡 <strong>BVH 的困境</strong>：</p><ul><li>需要动态内存访问（指针、数组索引跳转）</li><li>Shader 中难以实现高效的树形遍历</li><li>传统 WebGL/GLSL 不支持递归或复杂数据结构</li></ul></blockquote><hr><h4 id="解决方案-ray-marching-sdf" tabindex="-1">解决方案：Ray Marching + SDF <a class="header-anchor" href="#解决方案-ray-marching-sdf" aria-label="Permalink to &quot;解决方案：Ray Marching + SDF&quot;">​</a></h4><p><strong>核心思想</strong>：用 <strong>SDF (Signed Distance Field)</strong> 替代三角形网格！</p><blockquote><p>💡 <strong>什么是 SDF？</strong></p><p>SDF 是一个数学函数，输入一个 3D 点，返回该点到最近表面的<strong>有向距离</strong>：</p><ul><li>正数 = 点在物体外部，值表示&quot;到表面的距离&quot;</li><li>负数 = 点在物体内部，值表示&quot;到表面的距离&quot;</li><li>零 = 点在表面上</li></ul><p>例如，球体的 SDF：<code>distance = length(point) - radius</code></p></blockquote><p><strong>Ray Marching的优势</strong>：</p><ul><li>✅ 不需要复杂的数据结构（只需要一个函数）</li><li>✅ 可以表示数学定义的曲面（球、环面、分形等）</li><li>✅ 非常适合GPU并行计算（每个像素独立计算）</li><li>✅ 代码简洁，容易理解</li><li>✅ 支持 CSG 布尔运算（并集、交集、差集）</li></ul><hr><h2 id="_2-🚶-ray-marching-gpu上的光线追踪" tabindex="-1">2. 🚶 Ray Marching - GPU上的光线追踪 <a class="header-anchor" href="#_2-🚶-ray-marching-gpu上的光线追踪" aria-label="Permalink to &quot;2. 🚶 Ray Marching - GPU上的光线追踪&quot;">​</a></h2><h3 id="_2-1-核心思想-步进前进" tabindex="-1">2.1 核心思想：步进前进 <a class="header-anchor" href="#_2-1-核心思想-步进前进" aria-label="Permalink to &quot;2.1 核心思想：步进前进&quot;">​</a></h3><p><strong>传统光线追踪</strong>：直接求光线与物体的精确交点（需要复杂的数学求解）</p><p><strong>Ray Marching</strong>：沿着光线<strong>逐步行进</strong>，每次前进&quot;安全距离&quot;，直到接近表面</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>     摄像机               SDF球体</span></span>
<span class="line"><span>       ●                    ●</span></span>
<span class="line"><span>       │╲</span></span>
<span class="line"><span>       │ ╲ 光线</span></span>
<span class="line"><span>       │  ╲</span></span>
<span class="line"><span>       │   ●───→ 步进1 (安全距离d1=3.0)</span></span>
<span class="line"><span>       │        ╲</span></span>
<span class="line"><span>       │         ●──→ 步进2 (安全距离d2=1.5)</span></span>
<span class="line"><span>       │            ╲</span></span>
<span class="line"><span>       │             ●─→ 步进3 (d3=0.001,命中!)</span></span></code></pre></div><blockquote><p>💡 <strong>类比理解</strong>：想象你在浓雾中摸索前进</p><p><strong>场景设定</strong>：你在一个漆黑的房间，手里有一个&quot;距离探测器&quot;，它能告诉你：&quot;前方最近的墙壁距离你 X 米&quot;</p><p><strong>前进策略</strong>：</p><ol><li>探测器显示&quot;前方最近墙壁 3 米&quot; → 你可以安全地向前走 3 米（不会撞到任何东西）</li><li>到达新位置，再次探测：&quot;前方最近墙壁 1.5 米&quot; → 再走 1.5 米</li><li>继续探测：&quot;前方最近墙壁 0.001 米&quot; → 你几乎贴在墙上了，停止！</li></ol><p><strong>关键洞察</strong>：SDF 就是这个&quot;距离探测器&quot;，它保证每次前进的距离是&quot;安全&quot;的（不会穿过物体）</p><p>Ray Marching 就是让光线这样&quot;摸索&quot;前进！</p></blockquote><hr><h4 id="为什么这个方法有效" tabindex="-1">为什么这个方法有效？ <a class="header-anchor" href="#为什么这个方法有效" aria-label="Permalink to &quot;为什么这个方法有效？&quot;">​</a></h4><p><strong>数学保证</strong>：SDF 返回的是&quot;到最近表面的距离&quot;，所以：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>如果 SDF(当前点) = 5.0</span></span>
<span class="line"><span>→ 意味着：以当前点为球心，半径 5.0 的球体内部，没有任何物体表面</span></span>
<span class="line"><span>→ 结论：沿光线前进 5.0 单位，绝对不会穿过物体</span></span></code></pre></div><p>这就是&quot;安全步进&quot;(Sphere Tracing) 的数学基础！</p><h3 id="_2-2-算法步骤详解" tabindex="-1">2.2 算法步骤详解 <a class="header-anchor" href="#_2-2-算法步骤详解" aria-label="Permalink to &quot;2.2 算法步骤详解&quot;">​</a></h3><p><strong>完整流程</strong>：</p><ol><li><p><strong>初始化光线</strong></p><ul><li>起点 <code>origin</code>：摄像机位置</li><li>方向 <code>direction</code>：从摄像机指向屏幕像素的归一化向量</li><li>累计距离 <code>t = 0.0</code></li></ul></li><li><p><strong>开始循环步进</strong> (最多 MAX_STEPS 次，例如 100 次)</p></li><li><p><strong>计算当前位置</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>当前点 = origin + t × direction</span></span></code></pre></div></li><li><p><strong>查询 SDF</strong>：&quot;当前点到最近表面有多远？&quot;</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>d = sceneSDF(当前点)</span></span></code></pre></div></li><li><p><strong>判断三种情况</strong></p><p><strong>情况 A：命中表面</strong> (<code>d &lt; EPSILON</code>，例如 <code>d &lt; 0.001</code>)</p><ul><li>EPSILON 是&quot;足够接近&quot;的阈值</li><li>返回 <code>t</code>（光线走过的总距离）</li><li>跳出循环，开始着色</li></ul><p><strong>情况 B：超出渲染范围</strong> (<code>t &gt; MAX_DISTANCE</code>，例如 <code>t &gt; 100.0</code>)</p><ul><li>说明光线射向无限远，场景中没有物体</li><li>返回 <code>-1</code> 或特殊值表示&quot;未命中&quot;</li><li>跳出循环</li></ul><p><strong>情况 C：继续前进</strong></p><ul><li>更新累计距离：<code>t += d</code> (关键！这是&quot;安全步进&quot;)</li><li>回到步骤 3</li></ul></li><li><p><strong>着色</strong>：如果命中，用 <code>t</code> 计算交点坐标，进行光照计算</p></li></ol><hr><blockquote><p>💡 <strong>为什么是&quot;安全&quot;步进？</strong></p><p>SDF 的定义保证了一个重要性质：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>如果 SDF(P) = d</span></span>
<span class="line"><span>→ 则以 P 为中心、半径为 d 的球体内，没有任何表面</span></span>
<span class="line"><span>→ 沿任意方向前进 d 单位，都不会&quot;穿过&quot;物体</span></span></code></pre></div><p>这就是为什么可以大胆地 <code>t += d</code>，而不用担心跳过物体表面！</p><p>这个技术也被称为 <strong>Sphere Tracing</strong>（球体追踪），因为每次步进都是在一个&quot;安全球&quot;内前进。</p></blockquote><h3 id="_2-3-数学表达" tabindex="-1">2.3 数学表达 <a class="header-anchor" href="#_2-3-数学表达" aria-label="Permalink to &quot;2.3 数学表达&quot;">​</a></h3><p><strong>光线的参数方程</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>P(t) = origin + t × direction</span></span>
<span class="line"><span></span></span>
<span class="line"><span>其中：</span></span>
<span class="line"><span>- origin: 光线起点（摄像机位置），例如 (0, 1, -3)</span></span>
<span class="line"><span>- direction: 光线方向（归一化向量），例如 (0, 0, 1) 表示正前方</span></span>
<span class="line"><span>- t: 参数（沿光线的距离），范围 [0, MAX_DISTANCE]</span></span>
<span class="line"><span>- P(t): 光线上距离起点 t 单位的点</span></span></code></pre></div><blockquote><p>💡 <strong>参数方程的直观理解</strong>：</p><ul><li>当 <code>t = 0</code> 时，<code>P(0) = origin</code>（在摄像机处）</li><li>当 <code>t = 1</code> 时，<code>P(1) = origin + direction</code>（沿光线前进 1 单位）</li><li>当 <code>t = 10</code> 时，<code>P(10) = origin + 10 * direction</code>（沿光线前进 10 单位）</li></ul><p>就像在一条直线上行走，<code>t</code> 就是&quot;已走过的距离&quot;</p></blockquote><hr><p><strong>Ray Marching 伪代码</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>算法 RayMarch(origin, direction):</span></span>
<span class="line"><span>    t = 0.0  // 初始化：当前沿光线的累计距离</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    for i = 0 to MAX_STEPS:  // 最多步进 MAX_STEPS 次（如 100 次）</span></span>
<span class="line"><span>        point = origin + t * direction  // 计算当前位置（光线上的点）</span></span>
<span class="line"><span>        dist = SDF(point)  // 查询：当前点到最近表面的距离</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        // ===== 命中检测 =====</span></span>
<span class="line"><span>        if dist &lt; EPSILON:  // 如果足够接近表面（EPSILON = 0.001）</span></span>
<span class="line"><span>            return t  // 命中！返回距离</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        // ===== 安全步进 =====</span></span>
<span class="line"><span>        t += dist  // 向前移动 dist 单位（保证不会穿过物体）</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        // ===== 超出范围检测 =====</span></span>
<span class="line"><span>        if t &gt; MAX_DISTANCE:  // 如果累计距离超出渲染范围（MAX_DISTANCE = 100.0）</span></span>
<span class="line"><span>            return -1  // 未命中（光线射向无限远）</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    return -1  // 步数用完，仍未命中（可能场景太复杂，或参数不合适）</span></span></code></pre></div><hr><blockquote><p>💡 <strong>关键参数的底层原理</strong>：</p><p><strong>MAX_STEPS (100)</strong>：最多步进次数</p><ul><li><strong>作用</strong>：防止无限循环，保证 Shader 能在有限时间内完成</li><li><strong>太小</strong>（如 20）：复杂场景会遗漏细节，远处物体可能渲染不出来</li><li><strong>太大</strong>（如 500）：性能严重下降，每帧计算时间大增</li><li><strong>推荐值</strong>：简单场景 50-100，复杂场景 100-200</li></ul><p><strong>EPSILON (0.001)</strong>：命中判定阈值</p><ul><li><strong>作用</strong>：定义&quot;足够接近表面&quot;的距离</li><li><strong>太小</strong>（如 0.00001）：浮点精度误差导致永远无法&quot;命中&quot;，出现条纹伪影</li><li><strong>太大</strong>（如 0.1）：提前终止，表面凹凸不准确，细节丢失</li><li><strong>推荐值</strong>：0.001（千分之一单位）是经验最佳值</li><li><strong>场景相关</strong>：如果场景单位是&quot;米&quot;，0.001 = 1 毫米，足够精确</li></ul><p><strong>MAX_DISTANCE (100.0)</strong>：最大渲染距离</p><ul><li><strong>作用</strong>：定义&quot;可见范围&quot;，超出此距离认为&quot;没有物体&quot;</li><li><strong>太小</strong>（如 10.0）：远景物体被裁剪，看不见</li><li><strong>太大</strong>（如 1000.0）：浪费步进次数在空旷区域</li><li><strong>推荐值</strong>：根据场景大小设置，室内 10-50，室外 100-500</li></ul></blockquote><h3 id="_2-4-基础实现" tabindex="-1">2.4 基础实现 <a class="header-anchor" href="#_2-4-基础实现" aria-label="Permalink to &quot;2.4 基础实现&quot;">​</a></h3><blockquote><p>💡 <strong>代码目标</strong>：渲染一个漂浮的球体和地面，理解Ray Marching的完整流程。</p></blockquote><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GL_ES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">precision highp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 高精度（Ray Marching需要精确计算）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> vec2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 屏幕分辨率</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_time;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // 时间（用于动画）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== 常量配置 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_STEPS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 最大步进次数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_DIST </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 最大渲染距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSILON </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 命中阈值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== SDF函数库 ==========</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🔵 SDF: 球体（最简单的 SDF 示例）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdSphere</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> radius</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 返回点 p 到球面的有向距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 数学原理：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 球心在原点，半径 r</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 点 p 到原点的距离 = length(p)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - SDF = length(p) - r</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 示例：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 length(p) = 5.0，radius = 3.0 → SDF = 2.0（点在球外 2 单位）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 length(p) = 3.0，radius = 3.0 → SDF = 0.0（点在球面上）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 length(p) = 1.0，radius = 3.0 → SDF = -2.0（点在球内 2 单位）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 返回值：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 正数 = 在球外，值=到表面的距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 零 = 在球面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 负数 = 在球内，绝对值=到表面的距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> radius;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🔷 SDF: 盒子（立方体，相对复杂）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdBox</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // p: 点的位置（世界坐标）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // b: 盒子的半尺寸（宽/高/深的一半）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    例如 b = (1, 2, 3) 表示盒子尺寸是 2×4×6</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 原理：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. abs(p) - b：计算点到盒子表面的向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. max(q, 0.0)：仅保留&quot;超出盒子&quot;的部分（点在盒子外）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. length(...)：计算外部距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. min(max(q.x, ...), 0.0)：处理内部点的距离（点在盒子内）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q.x, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q.y, q.z)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== 场景定义 ==========</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🌍 场景SDF（定义整个场景中所有物体）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 这个函数是整个 Ray Marching 的核心！</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 它告诉我们：给定一个点 p，到最近物体表面的距离是多少</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 物体 1：漂浮的球体 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 球心在 (0, 1, 0)，半径 1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 技巧：通过 &quot;p - center&quot; 实现球体的位移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sphere </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdSphere</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 等价于：把整个空间向相反方向移动，使球心在原点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 物体 2：无限地面 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 地面是 y=0 的平面</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 技巧：平面的 SDF 就是点到平面的垂直距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 p.y = 5.0 → 点在平面上方 5 单位</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 p.y = 0.0 → 点在平面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果 p.y = -2.0 → 点在平面下方 2 单位</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ground </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== CSG 布尔运算：并集 (Union) ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // min(A, B)：取两个距离的最小值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 含义：&quot;到最近物体的距离&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果球更近 → 返回到球的距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 如果地面更近 → 返回到地面的距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sphere, ground);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 其他 CSG 运算：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 交集 (Intersection)：max(A, B)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 差集 (Subtraction)：max(A, -B)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 平滑并集：smin(A, B, k) = 使用平滑最小值函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== Ray Marching核心算法 ==========</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🚶 Ray Marching 主函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 输入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   ro (Ray Origin)：光线起点（摄像机位置）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   rd (Ray Direction)：光线方向（归一化向量）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   正数：光线击中物体，返回距离起点的距离 t</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   负数：光线未击中任何物体（射向无限远或步数用完）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 沿光线的累计距离（初始在起点）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 循环步进 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_STEPS; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 步骤 1：计算当前位置 =====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // p 是光线上距离起点 t 单位的点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 步骤 2：查询 SDF =====</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // dist 是当前点到最近物体表面的距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 步骤 3：命中检测 =====</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSILON) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 当前点非常接近表面（距离 &lt; 0.001）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 认为已经&quot;命中&quot;物体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 返回累计距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 步骤 4：安全步进 =====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist;  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 关键！向前移动 dist 单位（SDF 保证不会穿过物体）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 步骤 5：超出范围检测 =====</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_DIST) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 累计距离超出最大渲染范围</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 说明光线射向无限远，场景中没有物体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 退出循环</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 如果循环结束都没有命中，返回 -1 表示&quot;未命中&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 未命中的两种情况：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. t &gt; MAX_DIST：光线射向无限远（天空）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 循环次数用完：场景太复杂，或参数设置不合理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== 主渲染函数 ==========</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤1：计算屏幕UV坐标 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 目标：把像素坐标转换为归一化设备坐标 (NDC)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // gl_FragCoord.xy：当前像素的屏幕坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 例如：分辨率 800×600，左下角 (0, 0)，右上角 (800, 600)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 计算步骤：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. gl_FragCoord.xy - 0.5 * u_resolution.xy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    → 将原点移到屏幕中心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    例如：800×600 → 中心点从 (400, 300) 变为 (0, 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 除以 u_resolution.y（注意：是 y，不是 x！）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    → 归一化，并保持长宽比不变</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    例如：800×600 → uv 范围变为 [-0.67, 0.67]×[-0.5, 0.5]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 为什么除以 y 而不是 x？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 这样可以保证垂直方向固定为 [-0.5, 0.5]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 水平方向根据宽高比自动调整</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 避免画面拉伸变形</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤2：设置摄像机 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 📍 相机位置 (Ray Origin)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // (0, 1, -3) 表示：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - x=0：水平居中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - y=1：高度 1 单位（与球心同高）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - z=-3：在球前方 3 单位（OpenGL 右手坐标系，-z 是&quot;向前&quot;）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 🎯 光线方向 (Ray Direction)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 解释：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - vec3(uv, 1.0) = (uv.x, uv.y, 1.0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - uv.x, uv.y 决定横纵方向（对应屏幕上的像素位置）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 1.0 是&quot;焦距&quot;（z 方向的距离）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 焦距的作用：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 焦距越大（如 2.0），视野越窄（类似&quot;望远镜&quot;）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 焦距越小（如 0.5），视野越宽（类似&quot;广角镜头&quot;）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 1.0 是常见的默认值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 为什么要 normalize？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 方向向量必须是单位长度（长度=1）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 确保所有光线以相同的&quot;速度&quot;前进</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤3：执行Ray Marching ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // t &gt; 0：光线击中物体，t 是距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // t &lt; 0：光线未击中物体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤4：着色 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 情况 A：命中物体 =====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 浅蓝色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 当前只是简单地给一个固定颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 后续会添加光照计算、法线、阴影等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 情况 B：背景（天空）=====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 深蓝色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 模拟夜空的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 输出最终颜色（RGBA 格式，A=1.0 表示不透明）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>💡 <strong>代码关键点</strong>：</p><ul><li><strong>sceneSDF</strong>：定义场景中的所有物体，返回&quot;到最近表面的距离&quot;</li><li><strong>rayMarch</strong>：沿光线步进，直到命中或超出范围</li><li><strong>uv坐标</strong>：<code>(gl_FragCoord.xy - 0.5 * u_resolution.xy) / u_resolution.y</code> 保证了画面不会拉伸变形</li></ul></blockquote><p><strong>效果</strong>：渲染出一个浅蓝色球体漂浮在地面上！</p><blockquote><p>⚠️ <strong>常见问题</strong>：</p><ul><li><strong>什么都看不见</strong>：检查摄像机位置<code>ro</code>是否合理，确保在物体前方</li><li><strong>球体变形</strong>：确认UV计算使用了<code>u_resolution.y</code>而非<code>u_resolution.x</code></li><li><strong>性能很差</strong>：降低<code>MAX_STEPS</code>到50，或增大<code>EPSILON</code>到0.01</li></ul></blockquote><hr><h2 id="_3-💡-ray-marching-光照" tabindex="-1">3. 💡 Ray Marching 光照 <a class="header-anchor" href="#_3-💡-ray-marching-光照" aria-label="Permalink to &quot;3. 💡 Ray Marching 光照&quot;">​</a></h2><h3 id="_3-1-计算法线-sdf的魔法" tabindex="-1">3.1 计算法线 - SDF的魔法 <a class="header-anchor" href="#_3-1-计算法线-sdf的魔法" aria-label="Permalink to &quot;3.1 计算法线 - SDF的魔法&quot;">​</a></h3><p>SDF的强大之处：<strong>法线可以通过梯度自动计算</strong>！</p><blockquote><p>💡 <strong>类比理解</strong>：想象一座山的地形图</p><p><strong>场景设定</strong>：你站在山坡上，手里有一个&quot;高度计&quot;，可以测量任何位置的海拔高度</p><p><strong>如何找到&quot;上坡最陡的方向&quot;？</strong></p><ol><li>向东走一小步，测量高度变化 → ΔH_x</li><li>向北走一小步，测量高度变化 → ΔH_y</li><li>向上走一小步，测量高度变化 → ΔH_z</li><li>把这三个变化率组合成向量 <code>(ΔH_x, ΔH_y, ΔH_z)</code>，这就是&quot;最陡上坡方向&quot;</li></ol><p><strong>对于 SDF</strong>：</p><ul><li>山的&quot;高度&quot;类比为&quot;到表面的距离&quot;</li><li>法线就是&quot;距离变化最快的方向&quot;</li><li>这个方向垂直于表面（因为 SDF 在表面上的值是 0，梯度指向距离增加最快的方向）</li></ul></blockquote><hr><p><strong>数学原理</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>法线 = ∇SDF = (∂SDF/∂x, ∂SDF/∂y, ∂SDF/∂z)</span></span>
<span class="line"><span>         ↑</span></span>
<span class="line"><span>      梯度（Gradient）</span></span>
<span class="line"><span>      表示&quot;函数变化最快的方向和速率&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>理论公式（微积分定义）：</span></span>
<span class="line"><span>∂SDF/∂x = lim(ε→0) [SDF(p + εx) - SDF(p)] / ε</span></span>
<span class="line"><span></span></span>
<span class="line"><span>数值近似（中心差分法，更精确）：</span></span>
<span class="line"><span>N.x ≈ [SDF(p + εx) - SDF(p - εx)] / (2ε)</span></span>
<span class="line"><span>N.y ≈ [SDF(p + εy) - SDF(p - εy)] / (2ε)</span></span>
<span class="line"><span>N.z ≈ [SDF(p + εz) - SDF(p - εz)] / (2ε)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>其中：</span></span>
<span class="line"><span>- ε (epsilon) 是微小偏移量（如 0.001）</span></span>
<span class="line"><span>- εx = (ε, 0, 0)，εy = (0, ε, 0)，εz = (0, 0, ε)</span></span>
<span class="line"><span>- 中心差分法：同时向前和向后采样，精度更高（O(ε²) vs O(ε)）</span></span></code></pre></div><blockquote><p>💡 <strong>为什么要归一化？</strong></p><p><strong>梯度的两个属性</strong>：</p><ul><li><strong>方向</strong>：指向 SDF 值增加最快的方向（即&quot;离表面最快&quot;的方向）</li><li><strong>长度</strong>：表示 SDF 变化的速率</li></ul><p><strong>法线只需要方向</strong>：</p><ul><li>光照计算中，我们只关心&quot;表面朝哪个方向&quot;</li><li>不关心&quot;距离变化有多快&quot;</li><li>所以要归一化到单位长度（<code>length(N) = 1.0</code>）</li></ul><p><strong>示例</strong>：</p><ul><li>梯度 <code>(3, 4, 0)</code>，长度 = 5</li><li>归一化后 <code>(0.6, 0.8, 0)</code>，长度 = 1</li><li>方向不变，但长度标准化为 1</li></ul></blockquote><h4 id="🔧-glsl实现" tabindex="-1">🔧 GLSL实现 <a class="header-anchor" href="#🔧-glsl实现" aria-label="Permalink to &quot;🔧 GLSL实现&quot;">​</a></h4><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🧭 计算法线（使用梯度近似）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 输入：p - 表面上的点（Ray Marching 的命中点）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回：归一化的法线向量（单位长度）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vec3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 微小偏移量（epsilon）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(eps, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 巧妙的技巧：用 swizzle 构建偏移向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 计算三个方向的梯度（中心差分法） ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.xyy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.xyy),</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // x 方向的梯度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yxy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yxy),</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // y 方向的梯度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yyx) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yyx)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // z 方向的梯度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 Swizzle 技巧解析：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // h = (eps, 0.0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // h.xyy = (h.x, h.y, h.y) = (eps, 0, 0)   → x 轴偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // h.yxy = (h.y, h.x, h.y) = (0, eps, 0)   → y 轴偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // h.yyx = (h.y, h.y, h.x) = (0, 0, eps)   → z 轴偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 中心差分法：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 对于 x 方向：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 向右采样：SDF(p + (eps, 0, 0))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 向左采样：SDF(p - (eps, 0, 0))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 梯度 ≈ (右 - 左) / (2*eps) → 但我们省略了除以 2*eps，因为最后会 normalize</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 为什么不除以 2*eps？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - normalize 会把向量归一化到单位长度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 梯度的&quot;长度&quot;会被丢弃，只保留&quot;方向&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 所以可以省略常数因子，提高效率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><blockquote><p>💡 <strong>参数调优指南</strong>：</p><p><strong>eps（微小偏移量）的选择</strong>：</p><ul><li><p><strong>太小</strong>（如 0.00001）：</p><ul><li>问题：浮点精度误差放大，导致法线抖动</li><li>现象：表面出现奇怪的条纹、噪点</li><li>原因：<code>SDF(p+ε)</code> 和 <code>SDF(p-ε)</code> 的差异接近浮点误差范围</li></ul></li><li><p><strong>太大</strong>（如 0.1）：</p><ul><li>问题：数值近似不准确，法线粗糙</li><li>现象：表面细节丢失，凹凸不明显</li><li>原因：偏移量太大，违反了&quot;微分&quot;的&quot;无限小&quot;假设</li></ul></li><li><p><strong>推荐值</strong>：</p><ul><li><strong>0.001</strong>（默认）：适合大多数场景</li><li><strong>0.0001 - 0.01</strong>：根据场景尺度调整</li><li><strong>规则</strong>：eps ≈ 场景尺度的 0.001 倍</li><li>例如：场景单位是&quot;米&quot;，eps=0.001 表示 1 毫米</li></ul></li></ul></blockquote><hr><blockquote><p>⚠️ <strong>性能注意</strong>：</p><ul><li>这个函数会调用 <code>sceneSDF</code> <strong>6 次</strong>（每个轴正负各一次）</li><li>是 Ray Marching 渲染中的<strong>主要性能瓶颈之一</strong></li><li>优化方法： <ol><li>使用四面体法（Tetrahedron method）：只需 4 次采样（精度稍低）</li><li>仅在需要光照的地方计算法线</li><li>简化 sceneSDF 函数的复杂度</li></ol></li></ul></blockquote><h3 id="_3-2-添加光照-lambert漫反射" tabindex="-1">3.2 添加光照 - Lambert漫反射 <a class="header-anchor" href="#_3-2-添加光照-lambert漫反射" aria-label="Permalink to &quot;3.2 添加光照 - Lambert漫反射&quot;">​</a></h3><blockquote><p>💡 <strong>目标</strong>：让球体根据光源位置产生明暗变化，看起来更真实。</p></blockquote><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_lightPos;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 光源位置（世界空间）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤1：设置光线 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤2：Ray Marching ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 步骤3：计算光照 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 📍 命中点的世界坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🧭 计算表面法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 💡 光照方向（从表面指向光源）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_lightPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ☀️ Lambert漫反射：光照强度 = cos(入射角)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(N, L), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // dot(N, L) = cos(θ)，θ是入射角</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // max(..., 0.0) 确保背面不会变负</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🎨 物体的基础颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌍 环境光（模拟间接光照）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ambient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 20%的基础亮度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 最终颜色 = 基础色 × (环境光 + 漫反射)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ambient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //                    ↑           ↑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //                  最低亮度    直接光照</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌌 背景（天空）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>💡 <strong>光照计算解释</strong>：</p><ul><li><strong>N·L</strong>：点积等于 <code>cos(入射角)</code>，角度越小（越正对光源），值越大</li><li><strong>ambient</strong>：环境光确保背面不会全黑（模拟天空光等间接光）</li><li><strong>权重分配</strong>：<code>0.2环境 + 0.8漫反射</code> 可根据需要调整</li></ul></blockquote><p><strong>效果</strong>：球体会根据光源位置产生明暗渐变！</p><h3 id="_3-3-软阴影-ray-marching的优势" tabindex="-1">3.3 软阴影 - Ray Marching的优势 <a class="header-anchor" href="#_3-3-软阴影-ray-marching的优势" aria-label="Permalink to &quot;3.3 软阴影 - Ray Marching的优势&quot;">​</a></h3><p>Ray Marching 可以轻松实现<strong>软阴影</strong> (Soft Shadows)！</p><blockquote><p>💡 <strong>类比理解</strong>：硬阴影 vs 软阴影</p><p><strong>硬阴影（Hard Shadow）</strong>：</p><ul><li>光源：点光源（无限小，如激光笔）</li><li>特点：阴影边界清晰，非黑即白</li><li>现实例子：强烈的阳光、手电筒</li><li>判定：光线要么完全被遮挡（全黑），要么完全未遮挡（全亮）</li></ul><p><strong>软阴影（Soft Shadow）</strong>：</p><ul><li>光源：面光源（有体积，如窗户、灯管）</li><li>特点：阴影边界模糊，有渐变的半影区域</li><li>现实例子：阴天的光线、室内柔和的灯光</li><li>半影（Penumbra）：阴影边缘的灰色过渡区域</li></ul><p><strong>Ray Marching 的优势</strong>：</p><ul><li>可以模拟&quot;光线接近遮挡物但未完全遮挡&quot;的情况</li><li>通过&quot;接近程度&quot;计算半影强度</li><li>自然产生软阴影效果！</li></ul></blockquote><hr><p><strong>底层原理</strong>：</p><p>传统方法：从表面点向光源发射光线，判断是否被遮挡</p><ul><li>被遮挡 → 完全黑暗（硬阴影）</li><li>未遮挡 → 完全明亮</li></ul><p><strong>Ray Marching 的软阴影方法</strong>：</p><ul><li>发射光线的过程中，记录&quot;最接近物体的距离&quot;</li><li>如果光线<strong>接近但未命中</strong>物体 → 产生半影</li><li>距离越近 → 阴影越重</li><li>距离越远 → 阴影越轻</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>示例场景：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>光源 ●</span></span>
<span class="line"><span>       ╲</span></span>
<span class="line"><span>        ╲  ← 光线</span></span>
<span class="line"><span>         ╲</span></span>
<span class="line"><span>          ●──●──●  ← Ray Marching 步进点</span></span>
<span class="line"><span>           ╲   ↑</span></span>
<span class="line"><span>            ╲  │ 很接近遮挡物（产生半影）</span></span>
<span class="line"><span>             ╲ │</span></span>
<span class="line"><span>         遮挡物 ▓▓▓</span></span>
<span class="line"><span>              ↓</span></span>
<span class="line"><span>         表面点 ●  ← 接收阴影的点</span></span>
<span class="line"><span></span></span>
<span class="line"><span>关键洞察：</span></span>
<span class="line"><span>- 步进点 2 很接近遮挡物，虽然没有命中，但&quot;差点被遮挡&quot;</span></span>
<span class="line"><span>- 这种&quot;接近程度&quot;决定了阴影的强度</span></span></code></pre></div><h4 id="🔧-软阴影实现" tabindex="-1">🔧 软阴影实现 <a class="header-anchor" href="#🔧-软阴影实现" aria-label="Permalink to &quot;🔧 软阴影实现&quot;">​</a></h4><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🌑 软阴影计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 输入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   ro (Ray Origin)：光线起点（表面点，稍微偏离表面以避免自遮挡）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   rd (Ray Direction)：光线方向（从表面点指向光源，归一化）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   mint：起始距离（通常 0.01，避免检测到自己）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   maxt：最大检测距离（通常设为光源距离）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   k：软阴影锐度参数（8.0=很软，32.0=中等，128.0=接近硬阴影）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   阴影因子 [0.0, 1.0]，0.0=完全黑暗，1.0=完全明亮</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> softShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> mint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> maxt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 初始假设：完全无阴影（最亮状态）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mint;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 从起始距离开始步进</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== Ray Marching 检测遮挡 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 计算当前位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 查询 SDF：当前点到最近物体的距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 情况 A：完全遮挡（硬阴影）=====</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 光线被完全遮挡，返回全黑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 情况 B：接近物体（软阴影核心）=====</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌫️ 半影计算公式：res = min(res, k * h / t)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 直觉解释：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - h：当前点到物体的距离（越小 = 越接近遮挡物）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - t：光线已行进的距离（越大 = 越远离起点）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - h / t：接近度比例（越小 = 越危险，接近被遮挡）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - k * h / t：缩放后的阴影强度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 为什么除以 t？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - 在光线起点附近，即使 h 很小，也不应该产生很重的阴影</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - 在远离起点时，相同的 h 值应该产生更重的阴影</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - t 越大，h/t 越小，阴影越重（符合透视原理）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // k 的作用：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - k 越小（如 8.0）：阴影越柔和，半影区域越大</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - k 越大（如 128.0）：阴影越锐利，接近硬阴影</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res, k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //       ↑     ↑   ↑   ↑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //      保留  锐度 距离 累计</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //     最暗值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 安全步进 =====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 向前移动 h 单位</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 超出检测范围 =====</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 已检测到光源位置，退出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 返回最终阴影因子（在循环中可能被多次 min 更新）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 返回值含义：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 1.0：光线完全未遮挡，无阴影</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 0.5：半影区域，50% 明亮</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 0.0：完全遮挡，全黑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... (之前的代码)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 步骤1：基础光照 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_lightPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 💡 漫反射</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(N, L), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 步骤2：计算软阴影 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 从命中点向光源发射光线，检查是否被遮挡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shadow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> softShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.01</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 起点：表面点 + 微小偏移（防止自遮挡）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            L,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // 方向：指向光源</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            0.01</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // mint：最小距离</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // maxt：最大检测距离</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            8.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // k：软阴影锐度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 步骤3：应用阴影 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shadow;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 漫反射强度 × 阴影因子</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ambient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ambient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>💡 <strong>参数调优指南</strong>：</p><table><thead><tr><th>参数</th><th>推荐值</th><th>效果</th></tr></thead><tbody><tr><td><strong>k = 8.0</strong></td><td>软阴影</td><td>边界模糊，真实感强</td></tr><tr><td><strong>k = 32.0</strong></td><td>中等</td><td>半软半硬</td></tr><tr><td><strong>k = 128.0</strong></td><td>硬阴影</td><td>边界清晰</td></tr><tr><td><strong>mint = 0.01</strong></td><td>小偏移</td><td>防止表面自己遮挡自己</td></tr><tr><td><strong>maxt = 5.0</strong></td><td>场景大小</td><td>与光源距离相关</td></tr></tbody></table></blockquote><blockquote><p>⚠️ <strong>注意事项</strong>：</p><ul><li><strong>p + N * 0.01</strong>：起点必须稍微偏离表面，否则会检测到自己！</li><li><strong>循环次数</strong>：50次通常够用，复杂场景可增加到100</li><li><strong>性能消耗</strong>：每个像素会多执行一次Ray Marching，性能开销较大</li></ul></blockquote><p><strong>效果</strong>：地面上会出现球体的软阴影，边界自然过渡！</p><hr><h2 id="_4-🔮-环境贴图-environment-mapping" tabindex="-1">4. 🔮 环境贴图 (Environment Mapping) <a class="header-anchor" href="#_4-🔮-环境贴图-environment-mapping" aria-label="Permalink to &quot;4. 🔮 环境贴图 (Environment Mapping)&quot;">​</a></h2><h3 id="_4-1-什么是环境贴图" tabindex="-1">4.1 什么是环境贴图？ <a class="header-anchor" href="#_4-1-什么是环境贴图" aria-label="Permalink to &quot;4.1 什么是环境贴图？&quot;">​</a></h3><p><strong>核心思想</strong>：用<strong>2D图像</strong>存储周围环境的光照信息</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>真实场景 (360°全景) → 映射到 2D 纹理 → 用于反射/折射/环境光</span></span></code></pre></div><blockquote><p>💡 <strong>类比理解</strong>：天文馆的穹顶</p><p><strong>场景设定</strong>：你进入一个天文馆，抬头看到巨大的穹顶上投影着星空</p><p><strong>环境贴图的原理类似</strong>：</p><ul><li>穹顶 = 环境贴图</li><li>你站在中心 = 摄像机/物体位置</li><li>抬头看任意方向 = 查询某个方向的环境颜色</li><li>穹顶上的图像 = 360° 全景照片</li></ul><p><strong>应用场景</strong>：</p><ol><li><strong>反射</strong>：金属球表面反射周围环境（就像照镜子）</li><li><strong>折射</strong>：玻璃球内部看到的扭曲环境</li><li><strong>环境光照</strong>：物体被周围环境照亮（IBL）</li><li><strong>背景天空盒</strong>：渲染远景天空</li></ol></blockquote><hr><p><strong>为什么需要环境贴图？</strong></p><p>传统方法：场景中放置多个光源 → 计算每个光源的贡献</p><ul><li>问题：真实世界的光照来自四面八方（天空、墙壁反射等）</li><li>解决：用环境贴图&quot;存储&quot;整个环境的光照信息，一次采样即可</li></ul><hr><p><strong>两种主要格式</strong>：</p><ol><li><p><strong>球形贴图 (Spherical / Equirectangular)</strong>：</p><ul><li>像世界地图，把球面展开成矩形</li><li>一张图片存储完整 360° 信息</li><li>优点：简单，易于制作</li><li>缺点：极点失真严重（北极/南极被拉伸）</li></ul></li><li><p><strong>立方体贴图 (Cubemap)</strong>：</p><ul><li>像骰子，用 6 个面包裹场景</li><li>6 张正方形图片拼成立方体</li><li>优点：失真小，GPU 硬件优化</li><li>缺点：文件数量多，制作稍复杂</li></ul></li></ol><hr><h3 id="_4-2-球形环境贴图" tabindex="-1">4.2 球形环境贴图 <a class="header-anchor" href="#_4-2-球形环境贴图" aria-label="Permalink to &quot;4.2 球形环境贴图&quot;">​</a></h3><h4 id="_4-2-1-原理-从3d方向到2d坐标" tabindex="-1">4.2.1 原理：从3D方向到2D坐标 <a class="header-anchor" href="#_4-2-1-原理-从3d方向到2d坐标" aria-label="Permalink to &quot;4.2.1 原理：从3D方向到2D坐标&quot;">​</a></h4><p><strong>目标</strong>：将 3D 方向向量 <code>(x, y, z)</code> 映射到 2D 纹理坐标 <code>(u, v)</code></p><p><strong>完整流程</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>3D 笛卡尔坐标 (x, y, z) → 球坐标 (θ, φ) → UV 坐标 (u, v)</span></span></code></pre></div><p><strong>步骤 1：计算球坐标（Spherical Coordinates）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>θ (theta) = atan(z, x)     // 方位角（水平角）：范围 [-π, π]</span></span>
<span class="line"><span>φ (phi)   = asin(y)        // 仰角（垂直角）：范围 [-π/2, π/2]</span></span></code></pre></div><ul><li><p><strong>θ (方位角)</strong>：在 XZ 平面上的旋转角度</p><ul><li>正 X 轴方向：θ = 0</li><li>正 Z 轴方向：θ = π/2</li><li>负 X 轴方向：θ = π 或 -π</li><li>负 Z 轴方向：θ = -π/2</li></ul></li><li><p><strong>φ (仰角)</strong>：离 XZ 平面的高度角</p><ul><li>正 Y 轴（天顶）：φ = π/2</li><li>XZ 平面（地平线）：φ = 0</li><li>负 Y 轴（天底）：φ = -π/2</li></ul></li></ul><p><strong>步骤 2：归一化到 [0, 1] 范围</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>u = (θ + π) / (2π)       // 水平方向：[-π, π] → [0, 1]</span></span>
<span class="line"><span>v = (φ + π/2) / π        // 垂直方向：[-π/2, π/2] → [0, 1]</span></span></code></pre></div><hr><blockquote><p>💡 <strong>类比理解</strong>：地球仪 → 世界地图</p><p><strong>场景设定</strong>：你要把一个地球仪的表面&quot;展开&quot;成平面地图</p><p><strong>球坐标 = 经纬度</strong>：</p><ul><li><p><strong>θ (theta) = 经度</strong>：</p><ul><li>0° = 本初子午线（英国格林威治）</li><li>正值 = 东经（亚洲）</li><li>负值 = 西经（美洲）</li><li>范围：-180° ~ +180°（-π ~ π 弧度）</li></ul></li><li><p><strong>φ (phi) = 纬度</strong>：</p><ul><li>0° = 赤道</li><li>正值 = 北纬</li><li>负值 = 南纬</li><li>范围：-90° ~ +90°（-π/2 ~ π/2 弧度）</li></ul></li></ul><p><strong>映射规则</strong>：</p><ul><li>北极点 <code>(0, 1, 0)</code> → φ = π/2 → v = 1.0（图片顶部）</li><li>南极点 <code>(0, -1, 0)</code> → φ = -π/2 → v = 0.0（图片底部）</li><li>赤道任意点 → φ = 0 → v = 0.5（图片中间）</li></ul><p><strong>失真问题</strong>：</p><ul><li>极点附近严重拉伸（就像世界地图的格陵兰岛被拉得很大）</li><li>赤道附近失真最小</li></ul></blockquote><p><strong>可视化</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>      北极 (0, 1, 0)</span></span>
<span class="line"><span>         ↑</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>    ──────●────── 赤道面</span></span>
<span class="line"><span>        ╱│╲</span></span>
<span class="line"><span>       ╱ │ ╲</span></span>
<span class="line"><span>      ↙  ↓  ↘</span></span>
<span class="line"><span>   南极 (0, -1, 0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>展开成矩形（Equirectangular）:</span></span>
<span class="line"><span>┌─────────────────┐ ← 北极 (v=1.0)</span></span>
<span class="line"><span>│   全景图像      │</span></span>
<span class="line"><span>│                 │ ← 赤道 (v=0.5)</span></span>
<span class="line"><span>│                 │</span></span>
<span class="line"><span>└─────────────────┘ ← 南极 (v=0.0)</span></span>
<span class="line"><span>↑                 ↑</span></span>
<span class="line"><span>u=0.0 (-π)    u=1.0 (+π)</span></span></code></pre></div><h4 id="_4-2-2-glsl实现" tabindex="-1">4.2.2 GLSL实现 <a class="header-anchor" href="#_4-2-2-glsl实现" aria-label="Permalink to &quot;4.2.2 GLSL实现&quot;">​</a></h4><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sampler2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 球形环境贴图（Equirectangular格式）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.14159265359</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🌐 将3D方向转换为球形UV坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vec2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> directionToSphericalUV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 输入：归一化的3D方向向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 输出：[0, 1] 范围的UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤1：计算球坐标 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> theta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> atan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dir.z, dir.x);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 水平角（方位角）：[-π, π]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // atan(y, x) 返回点(x,y)的角度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> asin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dir.y);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // 垂直角（仰角）：[-π/2, π/2]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // asin(y) 返回 y 对应的角度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤2：归一化到[0, 1] ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uv.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (theta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // [-π, π] → [0, 1]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uv.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (phi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // [-π/2, π/2] → [0, 1]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uv;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🎨 采样环境贴图</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vec3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sampleEnvironment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">direction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 确保方向归一化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> directionToSphericalUV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(direction));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 从环境贴图采样颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> texture2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, uv).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤1：设置光线 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤2：Ray Marching ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 命中物体（后续会添加反射效果）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌌 背景 = 从环境贴图采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 光线方向rd就是&quot;看向&quot;的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sampleEnvironment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>💡 <strong>代码关键点</strong>：</p><ul><li><strong>atan(z, x)</strong>：返回 <code>(x, z)</code> 点在XZ平面的角度，用于水平旋转</li><li><strong>asin(y)</strong>：返回 <code>y</code> 对应的仰角，用于垂直方向</li><li><strong>背景采样</strong>：未命中物体时，直接用光线方向采样环境贴图</li></ul></blockquote><p><strong>效果</strong>：背景会显示全景图像，像站在一个巨大的球体内部！</p><hr><h3 id="_4-3-立方体贴图-cubemap" tabindex="-1">4.3 立方体贴图 (Cubemap) <a class="header-anchor" href="#_4-3-立方体贴图-cubemap" aria-label="Permalink to &quot;4.3 立方体贴图 (Cubemap)&quot;">​</a></h3><h4 id="_4-3-1-原理-六面包裹" tabindex="-1">4.3.1 原理：六面包裹 <a class="header-anchor" href="#_4-3-1-原理-六面包裹" aria-label="Permalink to &quot;4.3.1 原理：六面包裹&quot;">​</a></h4><p>用6个面的正方形纹理组成一个立方体：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        ┌───┐</span></span>
<span class="line"><span>        │ Y+│ (顶部/上)</span></span>
<span class="line"><span>    ┌───┼───┼───┬───┐</span></span>
<span class="line"><span>    │X- │Z+ │X+ │Z- │ (左/前/右/后)</span></span>
<span class="line"><span>    └───┼───┼───┴───┘</span></span>
<span class="line"><span>        │ Y-│ (底部/下)</span></span>
<span class="line"><span>        └───┘</span></span>
<span class="line"><span></span></span>
<span class="line"><span>采样时：根据方向向量，GPU自动选择对应的面</span></span></code></pre></div><blockquote><p>💡 <strong>类比理解</strong>：</p><ul><li>想象你站在一个盒子中心，六个面都贴着图片</li><li>球形贴图像&quot;地球仪展开&quot;，立方体贴图像&quot;盒子六面&quot;</li><li><strong>优势</strong>：边缘失真更小，GPU硬件加速更好</li></ul></blockquote><p><strong>方向选择规则</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>if |x| &gt; |y| &amp;&amp; |x| &gt; |z|:</span></span>
<span class="line"><span>    选择 X+ 或 X- 面</span></span>
<span class="line"><span>else if |y| &gt; |z|:</span></span>
<span class="line"><span>    选择 Y+ 或 Y- 面</span></span>
<span class="line"><span>else:</span></span>
<span class="line"><span>    选择 Z+ 或 Z- 面</span></span></code></pre></div><h4 id="_4-3-2-three-js中使用-cubemap" tabindex="-1">4.3.2 Three.js中使用 Cubemap <a class="header-anchor" href="#_4-3-2-three-js中使用-cubemap" aria-label="Permalink to &quot;4.3.2 Three.js中使用 Cubemap&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== JavaScript 加载 Cubemap ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> loader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> THREE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CubeTextureLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 加载6张图片（顺序固定！）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> envMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;px.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// +X (右侧)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;nx.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// -X (左侧)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;py.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// +Y (顶部)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;ny.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// -Y (底部)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;pz.jpg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// +Z (前方)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;nz.jpg&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // -Z (后方)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== 创建Shader材质 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> material</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> THREE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ShaderMaterial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uniforms: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        u_envMap: { value: envMap }  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 传递给Shader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fragmentShader: shaderCode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><blockquote><p>💡 <strong>图片命名规范</strong>：</p><ul><li><code>px</code> = Positive X（右）</li><li><code>nx</code> = Negative X（左）</li><li><code>py</code> = Positive Y（上）</li><li><code>ny</code> = Negative Y（下）</li><li><code>pz</code> = Positive Z（前）</li><li><code>nz</code> = Negative Z（后）</li></ul></blockquote><p><strong>GLSL中采样</strong>：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Cubemap类型（不是sampler2D！）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 direction </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 采样方向（3D向量）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 📦 直接用3D方向采样（GPU自动选择对应的面）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 envColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, direction).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                ↑               ↑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //           Cubemap采样函数   3D方向向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(envColor, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>💡 <strong>Cubemap vs 球形贴图对比</strong>：</p><table><thead><tr><th>特性</th><th>球形贴图</th><th>立方体贴图</th></tr></thead><tbody><tr><td><strong>文件格式</strong></td><td>1张图片</td><td>6张图片</td></tr><tr><td><strong>采样方式</strong></td><td><code>texture2D(map, uv)</code></td><td><code>textureCube(map, dir)</code></td></tr><tr><td><strong>失真程度</strong></td><td>极点严重失真</td><td>边缘少量失真</td></tr><tr><td><strong>GPU优化</strong></td><td>一般</td><td>硬件加速</td></tr><tr><td><strong>使用场景</strong></td><td>简单背景</td><td>高质量反射/IBL</td></tr></tbody></table></blockquote><p><strong>优势</strong>：</p><ul><li>✅ 更少的失真（相比球形贴图）</li><li>✅ GPU硬件优化（专门的Cubemap采样单元）</li><li>✅ 边缘过滤更好（三线性插值）</li><li>✅ 更适合实时渲染</li></ul><hr><h2 id="🪞-反射-reflection" tabindex="-1">🪞 反射 (Reflection) <a class="header-anchor" href="#🪞-反射-reflection" aria-label="Permalink to &quot;🪞 反射 (Reflection)&quot;">​</a></h2><h3 id="📐-原理-镜面反射的数学基础" tabindex="-1">📐 原理：镜面反射的数学基础 <a class="header-anchor" href="#📐-原理-镜面反射的数学基础" aria-label="Permalink to &quot;📐 原理：镜面反射的数学基础&quot;">​</a></h3><p><strong>物理现象</strong>：光线击中表面后弹开，就像球撞墙反弹</p><p><strong>关键要素</strong>：</p><ul><li><strong>入射光线 I</strong>：从光源射向表面的方向</li><li><strong>法线 N</strong>：表面的垂直方向（单位向量）</li><li><strong>反射光线 R</strong>：反弹后的方向</li></ul><p><strong>反射定律</strong>：</p><ol><li>入射角 = 反射角</li><li>入射光、反射光、法线在同一平面</li></ol><hr><p><strong>可视化</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>      N (法线，垂直表面)</span></span>
<span class="line"><span>      ↑</span></span>
<span class="line"><span>      │</span></span>
<span class="line"><span>  I ╱   ╲ R (反射光线)</span></span>
<span class="line"><span>   ╱     ╲</span></span>
<span class="line"><span>  ╱       ╲</span></span>
<span class="line"><span> ╱         ↘</span></span>
<span class="line"><span>━━━━━━━━━━━━━━  表面</span></span>
<span class="line"><span></span></span>
<span class="line"><span>入射角 = 反射角</span></span></code></pre></div><p><strong>在 Shader 中的特殊情况</strong>：</p><ul><li>我们通常使用<strong>视线方向 V</strong>（从表面指向摄像机）</li><li>要计算反射光线 R，需要取 <code>-V</code>（入射方向）</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>      N (法线)</span></span>
<span class="line"><span>      ↑</span></span>
<span class="line"><span>      │</span></span>
<span class="line"><span>  V ╱   ╲ R (反射)</span></span>
<span class="line"><span>   ╱     ╲</span></span>
<span class="line"><span>  ╱       ↘</span></span>
<span class="line"><span>摄像机    表面</span></span>
<span class="line"><span></span></span>
<span class="line"><span>V: 从表面指向摄像机（我们看向表面的方向）</span></span>
<span class="line"><span>R: 反射方向（表面&quot;看向&quot;环境的方向）</span></span></code></pre></div><hr><p><strong>数学公式</strong>：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(I, N)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> I </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(I, N) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> N</span></span></code></pre></div><p><strong>公式推导直觉</strong>：</p><ul><li><code>dot(I, N)</code>：入射光线在法线方向的投影</li><li><code>2 * dot(I, N) * N</code>：沿法线方向的&quot;反弹量&quot;（双倍，因为要从入射翻转到反射）</li><li><code>I - ...</code>：原方向减去反弹量，得到反射方向</li></ul><p><strong>示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>假设：</span></span>
<span class="line"><span>I = (1, -1, 0)  // 向右下方入射</span></span>
<span class="line"><span>N = (0, 1, 0)   // 法线向上</span></span>
<span class="line"><span></span></span>
<span class="line"><span>计算：</span></span>
<span class="line"><span>dot(I, N) = 1*0 + (-1)*1 + 0*0 = -1</span></span>
<span class="line"><span>2 * dot(I, N) * N = 2 * (-1) * (0, 1, 0) = (0, -2, 0)</span></span>
<span class="line"><span>R = I - (0, -2, 0) = (1, -1, 0) - (0, -2, 0) = (1, 1, 0)  // 向右上方反射</span></span>
<span class="line"><span></span></span>
<span class="line"><span>结果：入射角 = 45°，反射角 = 45°，符合反射定律！</span></span></code></pre></div><h3 id="🔧-镜面反射实现" tabindex="-1">🔧 镜面反射实现 <a class="header-anchor" href="#🔧-镜面反射实现" aria-label="Permalink to &quot;🔧 镜面反射实现&quot;">​</a></h3><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🪞 计算反射方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 V </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 视线方向(指向摄像机)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 反射方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🎨 采样环境贴图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, R).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 💡 可选:添加菲涅尔效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(V, N), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(baseColor, color, fresnel);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, rd).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="💎-折射-refraction" tabindex="-1">💎 折射 (Refraction) <a class="header-anchor" href="#💎-折射-refraction" aria-label="Permalink to &quot;💎 折射 (Refraction)&quot;">​</a></h2><h3 id="📐-斯涅尔定律-snell-s-law-光线穿越介质的规律" tabindex="-1">📐 斯涅尔定律 (Snell&#39;s Law)：光线穿越介质的规律 <a class="header-anchor" href="#📐-斯涅尔定律-snell-s-law-光线穿越介质的规律" aria-label="Permalink to &quot;📐 斯涅尔定律 (Snell&#39;s Law)：光线穿越介质的规律&quot;">​</a></h3><p><strong>物理现象</strong>：光线从一种介质进入另一种介质时，传播方向发生改变</p><blockquote><p>💡 <strong>日常例子</strong>：</p><ul><li>筷子插入水中，看起来&quot;折断&quot;了</li><li>游泳池的底部看起来比实际浅</li><li>透过玻璃杯看东西会变形</li></ul></blockquote><hr><p><strong>核心公式</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>n₁ × sin(θ₁) = n₂ × sin(θ₂)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>其中：</span></span>
<span class="line"><span>- n₁：入射介质的折射率（光在该介质中的传播速度相关）</span></span>
<span class="line"><span>- n₂：折射介质的折射率</span></span>
<span class="line"><span>- θ₁：入射角（入射光与法线的夹角）</span></span>
<span class="line"><span>- θ₂：折射角（折射光与法线的夹角）</span></span></code></pre></div><p><strong>常见材质的折射率</strong>：</p><ul><li><strong>真空</strong>：n = 1.0（光速最快）</li><li><strong>空气</strong>：n ≈ 1.000293（近似为 1.0）</li><li><strong>水</strong>：n ≈ 1.33</li><li><strong>玻璃</strong>：n ≈ 1.5（普通玻璃）</li><li><strong>钻石</strong>：n ≈ 2.42（非常高，产生强烈折射）</li><li><strong>蓝宝石</strong>：n ≈ 1.77</li></ul><hr><p><strong>可视化</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>  空气 (n₁ = 1.0，光速快)</span></span>
<span class="line"><span>──────────────────────── 界面（如玻璃表面）</span></span>
<span class="line"><span>  玻璃 (n₂ = 1.5，光速慢)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ↓ 入射光 (I)</span></span>
<span class="line"><span>    │ θ₁ = 45°</span></span>
<span class="line"><span>────●──── 法线 N</span></span>
<span class="line"><span>    │╲ θ₂ ≈ 28°（变小！）</span></span>
<span class="line"><span>    │ ╲</span></span>
<span class="line"><span>    ↓  ↘ 折射光 (T)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>关键现象：</span></span>
<span class="line"><span>- n₂ &gt; n₁（进入更&quot;密&quot;的介质）→ 光线&quot;弯向&quot;法线（θ₂ &lt; θ₁）</span></span>
<span class="line"><span>- n₂ &lt; n₁（进入更&quot;稀&quot;的介质）→ 光线&quot;远离&quot;法线（θ₂ &gt; θ₁）</span></span></code></pre></div><hr><p><strong>物理直觉</strong>：</p><blockquote><p>💡 <strong>类比理解</strong>：汽车从高速公路驶入泥地</p><p><strong>场景设定</strong>：</p><ul><li>高速公路 = 空气（n = 1.0，光速快）</li><li>泥地 = 玻璃（n = 1.5，光速慢）</li><li>汽车斜着进入泥地</li></ul><p><strong>现象</strong>：</p><ul><li>右侧轮子先进入泥地，速度变慢</li><li>左侧轮子还在高速公路上，速度较快</li><li>导致汽车&quot;转向&quot;（向右偏）</li></ul><p><strong>对应到光线</strong>：</p><ul><li>光波的&quot;波前&quot;斜着进入玻璃</li><li>一侧先减速，另一侧还在高速</li><li>导致光线方向改变（折射）</li></ul></blockquote><hr><p><strong>特殊情况</strong>：</p><ol><li><p><strong>垂直入射</strong>（θ₁ = 0°）：</p><ul><li>sin(0°) = 0 → sin(θ₂) = 0 → θ₂ = 0°</li><li>光线不改变方向，直穿而过</li></ul></li><li><p><strong>全反射</strong>（Total Internal Reflection）：</p><ul><li>当 n₁ &gt; n₂（从密介质到稀介质，如玻璃→空气）</li><li>且入射角超过临界角时，光线无法折射，全部反射</li><li>临界角：sin(θ_c) = n₂ / n₁</li><li>例子：光纤、钻石的闪光效果</li></ul></li></ol><h3 id="🔧-实现折射" tabindex="-1">🔧 实现折射 <a class="header-anchor" href="#🔧-实现折射" aria-label="Permalink to &quot;🔧 实现折射&quot;">​</a></h3><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_ior;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Index of Refraction (折射率)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 V </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 💎 计算折射方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> eta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_ior;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 空气→玻璃,使用倒数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N, eta);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // GLSL内置函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🎨 采样环境贴图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, T).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ✨ 组合反射和折射 (Fresnel混合)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 reflectColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, R).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 refractColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, T).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(V, N), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refractColor, reflectColor, fresnel);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, rd).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="🌈-色散-chromatic-dispersion-棱镜彩虹效果" tabindex="-1">🌈 色散 (Chromatic Dispersion)：棱镜彩虹效果 <a class="header-anchor" href="#🌈-色散-chromatic-dispersion-棱镜彩虹效果" aria-label="Permalink to &quot;🌈 色散 (Chromatic Dispersion)：棱镜彩虹效果&quot;">​</a></h3><p><strong>物理现象</strong>：白光通过棱镜分解成彩虹色</p><blockquote><p>💡 <strong>为什么会色散？</strong></p><p><strong>核心原因</strong>：不同波长的光在同一材质中的折射率不同</p><ul><li><strong>红光</strong>（波长长，约 700 nm）：折射率最小，偏折最少</li><li><strong>绿光</strong>（波长中，约 550 nm）：折射率中等</li><li><strong>蓝光</strong>（波长短，约 450 nm）：折射率最大，偏折最多</li></ul><p><strong>日常例子</strong>：</p><ul><li>三棱镜分解阳光成七色彩虹</li><li>钻石边缘的&quot;火彩&quot;（彩色闪光）</li><li>CD 光盘表面的彩虹色</li><li>水滴形成的彩虹</li></ul></blockquote><hr><p><strong>数学模型</strong>：</p><p>对于大多数材质，折射率 n 与波长 λ 的关系（科西方程简化）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>n(λ) = A + B/λ²</span></span>
<span class="line"><span></span></span>
<span class="line"><span>波长越短（蓝光）→ n 越大 → 折射角越大</span></span>
<span class="line"><span>波长越长（红光）→ n 越小 → 折射角越小</span></span></code></pre></div><p><strong>示例值（对于玻璃）</strong>：</p><ul><li>红光（λ = 700 nm）：n ≈ 1.50</li><li>绿光（λ = 550 nm）：n ≈ 1.52</li><li>蓝光（λ = 450 nm）：n ≈ 1.54</li></ul><p>差异虽小（仅 0.04），但足以产生可见的色散效果！</p><hr><p><strong>GLSL 实现</strong>：</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 🌈 模拟棱镜色散效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... (之前的代码：Ray Marching 等)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 V </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 视线方向（从表面指向摄像机）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 关键技巧：RGB 三个通道用不同折射率 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 💡 为什么是倒数？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - GLSL 的 refract 函数参数是 η = n₁ / n₂</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - 从空气（n₁=1.0）进入玻璃（n₂）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // - 所以 η = 1.0 / n₂</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 红光通道（折射率 1.50）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 绿光通道（折射率 1.52）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.54</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 蓝光通道（折射率 1.54）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 分别计算三个颜色通道的折射方向 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 TR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N, etaR);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 红光折射方向（偏折最少）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 TG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N, etaG);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 绿光折射方向（中等偏折）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 TB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N, etaB);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 蓝光折射方向（偏折最多）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 从环境贴图分别采样三个方向 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 关键：每个颜色通道看向不同的方向，产生分离效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, TR).r;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 只取红色通道</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, TG).g;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 只取绿色通道</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, TB).b;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 只取蓝色通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ========== 重新组合成最终颜色 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r, g, b);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 结果：RGB 三个通道来自不同方向，产生色散效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><blockquote><p>💡 <strong>效果说明</strong>：</p><p><strong>玻璃球边缘会出现彩虹色条纹</strong>：</p><ul><li>正面看（入射角小）：色散不明显</li><li>侧面看（入射角大）：色散明显，出现彩色条纹</li><li>类似真实的钻石&quot;火彩&quot;效果</li></ul><p><strong>调节色散强度</strong>：</p><ul><li><p><strong>增强色散</strong>：拉大折射率差异</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.48</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 差异更大</span></span></code></pre></div></li><li><p><strong>减弱色散</strong>：缩小折射率差异</p><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> etaB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.51</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 差异很小</span></span></code></pre></div></li></ul></blockquote><hr><h2 id="🌅-ibl-image-based-lighting-基于图像的光照" tabindex="-1">🌅 IBL (Image-Based Lighting) - 基于图像的光照 <a class="header-anchor" href="#🌅-ibl-image-based-lighting-基于图像的光照" aria-label="Permalink to &quot;🌅 IBL (Image-Based Lighting) - 基于图像的光照&quot;">​</a></h2><h3 id="🎯-原理-让整个环境成为光源" tabindex="-1">🎯 原理：让整个环境成为光源 <a class="header-anchor" href="#🎯-原理-让整个环境成为光源" aria-label="Permalink to &quot;🎯 原理：让整个环境成为光源&quot;">​</a></h3><p><strong>传统光照 vs IBL 对比</strong>：</p><table><thead><tr><th>传统光照</th><th>IBL (基于图像的光照)</th></tr></thead><tbody><tr><td>使用点光源/方向光源</td><td>整个环境贴图都是光源</td></tr><tr><td>光源数量有限（3-10个）</td><td>无数个方向的光照（360°）</td></tr><tr><td>环境光用常量（如0.2）</td><td>环境光来自实际环境图像</td></tr><tr><td>反射用简单技巧</td><td>反射用真实环境信息</td></tr></tbody></table><hr><blockquote><p>💡 <strong>类比理解</strong>：博物馆的照明</p><p><strong>传统光照</strong>：</p><ul><li>房间里放几盏聚光灯（点光源）</li><li>光照来自固定方向</li><li>阴影部分很暗</li></ul><p><strong>IBL</strong>：</p><ul><li>房间四周都是发光的墙壁（环境贴图）</li><li>光照来自四面八方</li><li>即使阴影区域也有柔和的光照（间接光）</li><li>更真实、更柔和</li></ul></blockquote><hr><p><strong>IBL 的核心思想</strong>：</p><p>不再用几个点光源，而是把<strong>环境贴图的每一个像素都当作一个小光源</strong>！</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>传统光照：</span></span>
<span class="line"><span>光源1 ●  光源2 ●  光源3 ●</span></span>
<span class="line"><span>        ↓  ↓  ↓</span></span>
<span class="line"><span>         物体 ⬤</span></span>
<span class="line"><span></span></span>
<span class="line"><span>IBL：</span></span>
<span class="line"><span>   ╭─────────────╮</span></span>
<span class="line"><span>   │ 环境贴图     │  ← 每个像素都发光</span></span>
<span class="line"><span>   │ ●●●●●●●●●●  │</span></span>
<span class="line"><span>   ╰──────⬤──────╯</span></span>
<span class="line"><span>         物体</span></span></code></pre></div><hr><p><strong>实现步骤</strong>：</p><ol><li><p><strong>漫反射 IBL (Diffuse IBL)</strong>：</p><ul><li>问题：物体表面接收来自四面八方的光照</li><li>方法：对环境贴图进行<strong>卷积</strong>（Convolution），预计算&quot;辐照度贴图&quot;</li><li>结果：存储每个方向的平均光照强度</li></ul></li><li><p><strong>镜面反射 IBL (Specular IBL)</strong>：</p><ul><li>问题：粗糙表面反射模糊，光滑表面反射清晰</li><li>方法：基于<strong>粗糙度</strong>预过滤环境贴图（生成 Mipmap 链）</li><li>结果：粗糙度越大，采样越模糊的环境贴图</li></ul></li></ol><hr><p><strong>为什么需要预计算？</strong></p><p>直接计算 IBL 需要对环境贴图的<strong>所有像素</strong>进行采样和积分，性能消耗巨大！</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// 理论上的漫反射 IBL（伪代码）</span></span>
<span class="line"><span>vec3 irradiance = vec3(0.0);</span></span>
<span class="line"><span>for(每个环境贴图像素 i) {</span></span>
<span class="line"><span>    vec3 lightDir = 像素i的方向;</span></span>
<span class="line"><span>    vec3 lightColor = 像素i的颜色;</span></span>
<span class="line"><span>    float cosTheta = max(dot(N, lightDir), 0.0);</span></span>
<span class="line"><span>    irradiance += lightColor * cosTheta;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>irradiance /= 像素总数;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 问题：如果环境贴图是 2048×1024，就要采样 2,097,152 次！</span></span></code></pre></div><p><strong>解决方案</strong>：预先计算好，存储到&quot;辐照度贴图&quot;中，运行时直接采样！</p><h3 id="🔧-简化漫反射ibl" tabindex="-1">🔧 简化漫反射IBL <a class="header-anchor" href="#🔧-简化漫反射ibl" aria-label="Permalink to &quot;🔧 简化漫反射IBL&quot;">​</a></h3><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_irradianceMap;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 预计算的辐照度贴图</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 V </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌍 漫反射IBL (用法线方向采样)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 irradiance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_irradianceMap, N).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 diffuse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> irradiance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 基础颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ✨ 镜面反射IBL (用反射方向采样)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 specular </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, R).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🎨 Fresnel混合</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(V, N), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(diffuse, specular, fresnel);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, rd).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="🎨-综合实战-玻璃球-ray-marching" tabindex="-1">🎨 综合实战: 玻璃球 Ray Marching <a class="header-anchor" href="#🎨-综合实战-玻璃球-ray-marching" aria-label="Permalink to &quot;🎨 综合实战: 玻璃球 Ray Marching&quot;">​</a></h2><h3 id="完整场景" tabindex="-1">完整场景 <a class="header-anchor" href="#完整场景" aria-label="Permalink to &quot;完整场景&quot;">​</a></h3><blockquote><p>💡 <strong>目标</strong>：综合应用所有学到的技术</p><ul><li>Ray Marching 渲染球体和地面</li><li>环境贴图作为背景</li><li>玻璃材质（反射 + 折射 + Fresnel）</li><li>地面漫反射光照</li><li>色调映射和 Gamma 校正</li></ul></blockquote><div class="language-glsl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">glsl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GL_ES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">precision highp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 使用高精度（Ray Marching 需要精确计算）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== Uniforms ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> vec2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 屏幕分辨率</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_time;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // 时间（用于摄像机旋转动画）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uniform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> samplerCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_envMap;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 环境贴图（立方体贴图）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ========== 常量配置 ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_STEPS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Ray Marching 最大步进次数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_DIST </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 最大渲染距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSILON </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 命中判定阈值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PI </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3.14159265359</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 圆周率（用于角度计算）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ============ SDF 函数 ============</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdSphere</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> r</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdBox</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q.x, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q.y, q.z)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ============ 场景组合 ============</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 🔮 玻璃球 (ID=1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sphere </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdSphere</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 📦 地面 (ID=2)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ground </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sphere, ground);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取材质ID</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getMaterialID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sphere </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sdSphere</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ground </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sphere </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ground) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1=玻璃, 2=地面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ============ Ray Marching ============</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_STEPS; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSILON) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MAX_DIST) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ============ 法线计算 ============</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vec3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vec3 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.xyy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.xyy),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yxy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yxy),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yyx) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sceneSDF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h.yyx)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ============ 主渲染 ============</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤 1：计算屏幕 UV 坐标 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec2 uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (gl_FragCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_resolution.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤 2：设置旋转摄像机 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 📹 摄像机绕场景中心旋转（实现环绕动画）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> angle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 旋转角度随时间变化（0.2 = 旋转速度）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(angle) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(angle) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 摄像机位置：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - x = sin(angle) * 4.0：水平圆周运动</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - y = 2.0：固定高度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - z = cos(angle) * 4.0：水平圆周运动</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 半径 = 4.0，摄像机围绕原点转圈</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 看向球心位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 构建摄像机坐标系 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 💡 为什么需要构建坐标系？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 我们需要知道摄像机的&quot;前、右、上&quot;三个方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 才能根据屏幕 UV 计算每个像素的光线方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 forward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 前向：指向目标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 right </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), forward));  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 右向：世界上方向 × 前向 = 右向（右手坐标系）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 up </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(forward, right);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 上向：前向 × 右向 = 上向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 计算光线方向 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 rd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uv.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> right </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uv.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> up </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> forward);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 组合三个方向：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - uv.x * right：水平偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - uv.y * up：垂直偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // - 1.5 * forward：焦距（控制视野角度）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 步骤 3：执行 Ray Marching ==========</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rayMarch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ro, rd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vec3 color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 命中物体：计算着色 =====</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 命中点的世界坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 表面法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vec3 V </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 视线方向（从表面指向摄像机）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> matID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getMaterialID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 材质 ID（1=玻璃，2=地面）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ========== 材质 1：玻璃 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 计算反射方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 R </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // -V 是入射方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 计算折射方向（空气 n=1.0 → 玻璃 n=1.5）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">V, N, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 从环境贴图采样反射和折射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 reflectColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, R).rgb;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 反射看到的环境</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 refractColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, T).rgb;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 折射看到的环境</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ========== Fresnel 效果 ==========</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 观察角度决定反射/折射的比例</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // - 正面看（V·N 接近 1）：主要是折射（透明）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // - 侧面看（V·N 接近 0）：主要是反射（像镜子）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(V, N), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.9</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 映射到 [0.1, 1.0]，确保最少 10% 反射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 混合反射和折射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refractColor, reflectColor, fresnel);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // fresnel = 0.1 → 90% 折射 + 10% 反射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // fresnel = 1.0 → 0% 折射 + 100% 反射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ========== 材质 2：地面（简单漫反射）==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 固定方向光源</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 从右上方照射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Lambert 漫反射</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(N, L), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 地面基础颜色（灰蓝色）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vec3 baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 最终颜色 = 基础色 × (环境光 + 漫反射)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> baseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ===== 未命中物体：显示背景 =====</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 🌌 直接用光线方向采样环境贴图（天空盒）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> textureCube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(u_envMap, rd).rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ========== 后期处理 ==========</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 📸 色调映射（Tone Mapping）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Reinhard 色调映射：压缩 HDR 到 LDR</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 避免过曝（颜色值 &gt; 1.0）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 🎨 Gamma 校正</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 显示器是非线性的，需要校正到 Gamma 2.2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // pow(color, 1/2.2) = 从线性空间转到 sRGB 空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gl_FragColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> vec4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="🎓-系列总结" tabindex="-1">🎓 系列总结 <a class="header-anchor" href="#🎓-系列总结" aria-label="Permalink to &quot;🎓 系列总结&quot;">​</a></h2><p>🎉 <strong>恭喜!</strong> 你已经完成了整个 Shader 进阶系列!</p><h3 id="✅-完整知识体系回顾" tabindex="-1">✅ 完整知识体系回顾 <a class="header-anchor" href="#✅-完整知识体系回顾" aria-label="Permalink to &quot;✅ 完整知识体系回顾&quot;">​</a></h3><p><strong>第一篇: Shader基础</strong></p><ul><li>GPU并行计算原理</li><li>uniform / attribute / varying 数据流</li><li>Swizzling语法糖</li><li>绘制三角形的多种方法</li></ul><p><strong>第二篇: 随机与噪声</strong></p><ul><li>伪随机函数</li><li>Value Noise, Perlin Noise, Simplex Noise</li><li>Worley Noise (细胞噪声)</li></ul><p><strong>第三篇: 分形与程序化</strong></p><ul><li>分形布朗运动 (fBm)</li><li>域扭曲技术</li><li>曼德布洛特集、谢尔宾斯基三角形</li></ul><p><strong>第四篇: 纹理与图像处理</strong></p><ul><li>UV坐标系统</li><li>卷积核原理</li><li>各种滤镜 (模糊、锐化、边缘检测)</li></ul><p><strong>第五篇: 高级模拟技术</strong></p><ul><li>乒乓缓冲</li><li>Conway生命游戏</li><li>水波模拟、反应扩散</li></ul><p><strong>第六篇: 光照与材质</strong></p><ul><li>Phong / Blinn-Phong 光照模型</li><li>法线贴图、视差贴图</li><li>PBR基础</li></ul><p><strong>第七篇 (本篇): 光线追踪与环境</strong></p><ul><li>Ray Marching 算法</li><li>软阴影实现</li><li>环境贴图 (球形/立方体)</li><li>反射、折射、IBL</li></ul><h3 id="🚀-进阶方向建议" tabindex="-1">🚀 进阶方向建议 <a class="header-anchor" href="#🚀-进阶方向建议" aria-label="Permalink to &quot;🚀 进阶方向建议&quot;">​</a></h3><ol><li><p><strong>性能优化</strong></p><ul><li>实例化渲染</li><li>LOD (Level of Detail)</li><li>遮挡剔除</li></ul></li><li><p><strong>高级PBR</strong></p><ul><li>完整的IBL管线</li><li>多重散射近似</li><li>各向异性材质</li></ul></li><li><p><strong>体积渲染</strong></p><ul><li>体积云</li><li>体积光 (God Rays)</li><li>烟雾模拟</li></ul></li><li><p><strong>后期处理</strong></p><ul><li>Bloom (辉光)</li><li>DOF (景深)</li><li>Motion Blur</li></ul></li><li><p><strong>计算着色器</strong></p><ul><li>GPU粒子系统</li><li>流体模拟</li><li>布料模拟</li></ul></li></ol><h3 id="📚-进阶资源推荐" tabindex="-1">📚 进阶资源推荐 <a class="header-anchor" href="#📚-进阶资源推荐" aria-label="Permalink to &quot;📚 进阶资源推荐&quot;">​</a></h3><p><strong>书籍:</strong></p><ul><li>《Real-Time Rendering》(实时渲染圣经)</li><li>《GPU Gems》系列</li><li>《Physically Based Rendering》(PBRT)</li></ul><p><strong>在线资源:</strong></p><ul><li><a href="https://www.shadertoy.com/" target="_blank" rel="noreferrer">Shadertoy</a> - 世界顶级Shader作品</li><li><a href="https://iquilezles.org/" target="_blank" rel="noreferrer">Inigo Quilez的博客</a> - SDF大师的技术文章</li><li><a href="https://learnopengl.com/" target="_blank" rel="noreferrer">LearnOpenGL</a> - 系统的OpenGL教程</li><li><a href="https://thebookofshaders.com/" target="_blank" rel="noreferrer">The Book of Shaders</a> - 艺术化的Shader入门</li></ul><p><strong>社区:</strong></p><ul><li><a href="https://discord.gg/XtmMN6E" target="_blank" rel="noreferrer">ShaderToy Discord</a></li><li><a href="https://discord.gg/6mgNGk7" target="_blank" rel="noreferrer">Graphics Programming Discord</a></li></ul><hr><h2 id="🎯-最终挑战" tabindex="-1">🎯 最终挑战 <a class="header-anchor" href="#🎯-最终挑战" aria-label="Permalink to &quot;🎯 最终挑战&quot;">​</a></h2><p>尝试组合所有技术,创造一个完整场景:</p><p><strong>项目: &quot;梦幻水晶球&quot;</strong></p><ol><li>使用 Ray Marching 渲染玻璃球</li><li>球内用 fBm 生成3D云雾</li><li>添加 Worley Noise 创造气泡</li><li>用 IBL 实现真实光照</li><li>反应扩散系统生成表面花纹</li><li>后期处理添加 Bloom 和色差</li></ol><p><strong>预期时间:</strong> 2-3天 <strong>难度:</strong> ⭐⭐⭐⭐⭐</p><hr><h2 id="💬-结语" tabindex="-1">💬 结语 <a class="header-anchor" href="#💬-结语" aria-label="Permalink to &quot;💬 结语&quot;">​</a></h2><p>Shader 编程是<strong>数学</strong>、<strong>物理</strong>和<strong>艺术</strong>的完美结合。你已经掌握了从基础到高级的完整工具链,剩下的就是<strong>无限的创造力</strong>!</p><p>记住:</p><ul><li>🎨 <strong>实验至上</strong>: 最好的学习方式是动手尝试</li><li>📖 <strong>阅读源码</strong>: Shadertoy上有无数优秀作品可以学习</li><li>🤝 <strong>分享交流</strong>: 加入社区,与全球开发者交流</li></ul><p><strong>祝你在 Shader 的旅程中创造出惊艳世界的作品!</strong> ✨🚀</p><hr><p><em>完</em></p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><!----></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/blogs/note/" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>前端基础</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blogs_algorithm_20220102.md\":\"_6aCx-lU\",\"blogs_algorithm_20221217.md\":\"CC7zKfQP\",\"blogs_algorithm_20221219.md\":\"C-gwKTmO\",\"blogs_algorithm_20231127.md\":\"CdoWdqBD\",\"blogs_algorithm_20240106.md\":\"DG3DJGEU\",\"blogs_algorithm_index.md\":\"BE0NQk3J\",\"blogs_backend_index.md\":\"C0DJQa_F\",\"blogs_backend_nest_index.md\":\"Dtz1kA0W\",\"blogs_backend_nest_nestprovider.md\":\"BalaCYMw\",\"blogs_backend_nest_nest守卫.md\":\"CEoj4llZ\",\"blogs_algorithm_20221205.md\":\"CY5xvaL1\",\"blogs_algorithm_20221211.md\":\"qGsw_j6f\",\"blogs_css_csstips_20220601.md\":\"B86CvgzT\",\"blogs_css_csstips_渐隐渐现过渡的实现.md\":\"1WN1dXX3\",\"blogs_css_csstips_20221117.md\":\"jSnxxFsE\",\"blogs_css_csstips_20230109.md\":\"CVmqnipu\",\"blogs_css_csstips_20230302.md\":\"DmaNyedp\",\"blogs_css_csstips_雪碧图多状态通用计算解决方案.md\":\"BQ5x7HmD\",\"blogs_css_csstips_20230305.md\":\"BBkwJibR\",\"blogs_css_csstips_20230420.md\":\"CyImtjiU\",\"blogs_css_csstips_20230708.md\":\"BWTsqoyd\",\"blogs_css_csstips_20231118.md\":\"BVZKJr3Z\",\"blogs_css_csstips_20231124.md\":\"BzAY2Poe\",\"blogs_css_csstips_20240706.md\":\"BkCooESl\",\"blogs_css_csstips_20240924.md\":\"Cgm_93XQ\",\"blogs_css_csstips_20250409.md\":\"sE-AR971\",\"blogs_css_csstips_20240918.md\":\"B3S9Ze2V\",\"blogs_css_csstips_20241029.md\":\"DtA9QRgd\",\"blogs_css_csstips_framer motion在企业级应用中的实践.md\":\"Bua9pL5i\",\"blogs_css_csstips_framer motion的高级动画技巧.md\":\"9rl4Qn8K\",\"blogs_css_csstips_css遮罩.md\":\"CvGb-gIV\",\"blogs_css_csstips_framer motion的性能优化和最佳实践.md\":\"-NQWd7h0\",\"blogs_algorithm_20220130.md\":\"DuPvXcoW\",\"blogs_algorithm_20220201.md\":\"DR_7PeSB\",\"blogs_css_csstips_framer motion的组件封装.md\":\"Br2e8gwv\",\"blogs_css_csstips_index.md\":\"SCOVPQS9\",\"blogs_backend_nest_nest装饰器.md\":\"BNEaU5r0\",\"blogs_css_csstips_深入理解动画系统.md\":\"B5Adm5M3\",\"blogs_backend_nest_nest配置系统.md\":\"jZuNd-sT\",\"blogs_backend_node_node-01.md\":\"D7QDL2_s\",\"blogs_backend_node_node-04.md\":\"CegtZMZ8\",\"blogs_backend_node_node-05.md\":\"DzXa_cvT\",\"blogs_cross-end_index.md\":\"3EgecCHR\",\"blogs_cross-end_reactnative入门.md\":\"BbpML1cf\",\"blogs_css_csstips_20200101.md\":\"LNDIFY1b\",\"blogs_css_csstips_20200102.md\":\"BvtP_4kH\",\"blogs_css_csstips_20200103.md\":\"BzpdSpBi\",\"blogs_backend_node_index.md\":\"_5I1nQTw\",\"blogs_css_csstips_20220304.md\":\"Jilc4L_F\",\"blogs_backend_node_node-02.md\":\"CbvS3v7l\",\"blogs_backend_node_node-03.md\":\"BERQ7O_p\",\"blogs_backend_nest_nest拦截器.md\":\"C36CaH8R\",\"blogs_backend_nest_nest异常过滤器.md\":\"CXutfPbK\",\"blogs_algorithm_20221118.md\":\"4somlPlO\",\"blogs_backend_nest_nest控制器.md\":\"CxsmelfP\",\"blogs_algorithm_20221209.md\":\"C8AvCjAG\",\"blogs_backend_nest_nest模块.md\":\"DmR_vjkj\",\"blogs_backend_nest_nest中间件.md\":\"B-CvQ9fH\",\"blogs_algorithm_20221206.md\":\"CN99K0Jh\",\"blogs_algorithm_20221215.md\":\"CUXNN8xn\",\"blogs_backend_nest_nest系列总结.md\":\"DsA2uQH0\",\"blogs_algorithm_20221212.md\":\"F-KAeuiD\",\"blogs_backend_node_dbeaver.md\":\"DxSU4fnF\",\"blogs_backend_nest_nest管道.md\":\"h0gWRsli\",\"blogs_algorithm_20220212.md\":\"B4Sz9DvV\",\"blogs_backend_node_express.md\":\"DUwKrg_U\",\"blogs_algorithm_20221207.md\":\"dwZdbBMR\",\"blogs_algorithm_20221112.md\":\"C9nuyC3w\",\"blogs_css_demo_20231105.md\":\"DRr7p5rs\",\"blogs_css_demo_20241204.md\":\"BeXxyiZq\",\"blogs_css_demo_20221112.md\":\"F6tof00K\",\"blogs_css_demo_20241205.md\":\"CGYt1dLX\",\"blogs_css_demo_20241227-flip 动画实现详解.md\":\"Boh-4199\",\"blogs_css_demo_index.md\":\"B2p6Q_Zi\",\"blogs_css_index.md\":\"DJRhl9Xv\",\"blogs_electron_electron打包问题.md\":\"CPOgOAOo\",\"blogs_electron_index.md\":\"T6rNwi6j\",\"blogs_engineering_20210506.md\":\"UzyWQn4T\",\"blogs_engineering_20240716.md\":\"C7rs5Lfo\",\"blogs_electron_github releases 发布应用.md\":\"Dm1HCNN4\",\"blogs_engineering_20240911.md\":\"DHfJl2TN\",\"blogs_hide_前端性能题目.md\":\"DtorQAaV\",\"blogs_hide_前端构建 _ 工程化 题目.md\":\"M02xQGW8\",\"blogs_hide_计算机网络和浏览器题目.md\":\"D3ZFaQkh\",\"blogs_index.md\":\"BqqacQuT\",\"blogs_engineering_20240912.md\":\"d-m2-DPX\",\"blogs_css_csstips_轻松实现流畅的react动画.md\":\"DrE9u48q\",\"blogs_engineering_20240910.md\":\"DCL4cey4\",\"blogs_javascript_es6_20230301.md\":\"BlgqZcE-\",\"blogs_javascript_es6_20240511.md\":\"B30CsXBf\",\"blogs_javascript_es6_index.md\":\"BZ7WJJBN\",\"blogs_javascript_index.md\":\"DCWV0waE\",\"blogs_backend_nest_nest入门.md\":\"Dr6vlbOq\",\"blogs_javascript_jstips_20200104.md\":\"D6D8oxXD\",\"blogs_javascript_jstips_20200105.md\":\"5zsvUcQr\",\"blogs_javascript_jstips_20200106.md\":\"C5LMnwfI\",\"blogs_javascript_jstips_20200205.md\":\"D5o8EbCd\",\"blogs_javascript_jstips_20200206.md\":\"DKyHxFQG\",\"blogs_javascript_jstips_20200207.md\":\"Cv99aSH-\",\"blogs_javascript_jstips_20200302.md\":\"hJYtmwFc\",\"blogs_javascript_jstips_20200401.md\":\"DENHo_kM\",\"blogs_javascript_jstips_20200501.md\":\"DsP8qtvy\",\"blogs_javascript_jstips_20210403.md\":\"7u32-hGT\",\"blogs_javascript_jstips_20210504.md\":\"BjLPKTML\",\"blogs_javascript_jstips_20210901.md\":\"Bx1lbd0Q\",\"blogs_javascript_jstips_20210908.md\":\"D1mg9xJy\",\"blogs_javascript_jstips_20220303.md\":\"DkW07dDR\",\"blogs_javascript_jstips_20220502.md\":\"DdUPPYSs\",\"blogs_javascript_jstips_20220602.md\":\"RW-MT8YC\",\"blogs_javascript_jstips_20220605.md\":\"tgOJq787\",\"blogs_electron_electron入门.md\":\"BMmYMWBt\",\"blogs_javascript_jstips_20220705.md\":\"B93D0z40\",\"blogs_javascript_jstips_20220809.md\":\"6cCFwdNM\",\"blogs_javascript_jstips_20221022.md\":\"Dt2wJ3RS\",\"blogs_javascript_jstips_20221112.md\":\"BqLkdqto\",\"blogs_javascript_jstips_20230106.md\":\"8uzmB_GA\",\"blogs_javascript_jstips_20230503.md\":\"DXXaAqBw\",\"blogs_javascript_jstips_20230506.md\":\"It5C-QEq\",\"blogs_javascript_jstips_20230513.md\":\"C5SVv5XX\",\"blogs_javascript_jstips_20240319.md\":\"CAC-10mR\",\"blogs_javascript_jstips_20240321.md\":\"D63XOPNB\",\"blogs_javascript_jstips_index.md\":\"CYleGm34\",\"blogs_note_20210302.md\":\"De-hDDc5\",\"blogs_note_20241105.md\":\"DYAQOryB\",\"blogs_note_20251026-shader纹理与图像处理.md\":\"DHP3i24u\",\"blogs_note_20251027-shader高级模拟技术.md\":\"M6U8OVbl\",\"blogs_note_20251028-shader光照与材质.md\":\"B3Az5Bam\",\"blogs_note_20251029-shader光线追踪与环境.md\":\"kkeECx9Y\",\"blogs_note_css.md\":\"NPAo-Ray\",\"blogs_note_html.md\":\"C60RZreu\",\"blogs_note_index.md\":\"BWp7UMmB\",\"blogs_note_jq.md\":\"MYETeVWu\",\"blogs_note_js.md\":\"7gxSdGEj\",\"blogs_note_nextjs.md\":\"DfpT2l1u\",\"blogs_note_react.md\":\"WRvmsocN\",\"blogs_note_redux.md\":\"B2BQJv-k\",\"blogs_note_ts.md\":\"BIo1W3Lr\",\"blogs_note_typescript.md\":\"gRq-NNcP\",\"blogs_note_xiaochengxu.md\":\"CIslTXur\",\"blogs_note_yaml.md\":\"NuHZ7K9I\",\"blogs_operations_linux.md\":\"CFZ3Ksjl\",\"blogs_product_index.md\":\"DYCkxMwH\",\"blogs_note_vue.md\":\"5GaMZ_7i\",\"blogs_note_20251025-shader分形与程序化.md\":\"DjzxoTAI\",\"blogs_operations_index.md\":\"VVUtwFz4\",\"blogs_word_2022_0608.md\":\"DkWnupRI\",\"blogs_word_2022_1008.md\":\"Qtk8ifek\",\"blogs_css_demo_20240423.md\":\"Dufobc20\",\"blogs_css_demo_20241015.md\":\"ByfoaWQ7\",\"blogs_css_demo_20241202.md\":\"GmkEntzD\",\"blogs_css_demo_20241203.md\":\"Dzu58wRM\",\"blogs_engineering_20240913.md\":\"BHikyTIN\",\"blogs_engineering_20240914.md\":\"Du6q1HPZ\",\"blogs_engineering_20240915.md\":\"-WY969a4\",\"blogs_engineering_20240916.md\":\"DnODMH-T\",\"blogs_engineering_20240917.md\":\"DZwGRDEN\",\"blogs_engineering_20241029.md\":\"RQOz8Tl_\",\"blogs_engineering_20241030.md\":\"BmrOlF9Q\",\"blogs_engineering_20241204.md\":\"puhFavyV\",\"blogs_hide_html_css题目.md\":\"9C6x2n8c\",\"blogs_engineering_index.md\":\"DWx-ZWi9\",\"blogs_engineering_webpack模板实践.md\":\"6UsVVqv1\",\"blogs_favorites_index.md\":\"D-KTCEjM\",\"blogs_frame_index.md\":\"D_7icocf\",\"blogs_frame_react_20240919.md\":\"D2QSQ9Oi\",\"blogs_frame_react_index.md\":\"DooEBfDC\",\"blogs_frame_vue_index.md\":\"CIGMt1w3\",\"blogs_frontpromote_browser_network_20210612.md\":\"BSwFKCMA\",\"blogs_frontpromote_browser_network_20210820.md\":\"D6hdzaTF\",\"blogs_frontpromote_browser_network_20211225.md\":\"C3Afm8T4\",\"blogs_frontpromote_browser_network_20221012.md\":\"DSGZ-5Zz\",\"blogs_frontpromote_browser_network_20230421.md\":\"_sCdCSj9\",\"blogs_frontpromote_browser_network_20240328.md\":\"C5IhzwAZ\",\"blogs_frontpromote_browser_network_20241117.md\":\"B_0MFzg8\",\"blogs_frontpromote_browser_network_20241120.md\":\"BorbUwcF\",\"blogs_frontpromote_performance_20211227.md\":\"Bms0pAqQ\",\"blogs_frontpromote_performance_index.md\":\"ZcC2YstR\",\"blogs_hide_react生态题目.md\":\"Crv3whXK\",\"blogs_engineering_20241205.md\":\"CeitDArt\",\"blogs_engineering_20241206.md\":\"CWxJoFAd\",\"blogs_hide_index.md\":\"BFfV89Xq\",\"blogs_frontpromote_browser_network_index.md\":\"BnCfq5UD\",\"blogs_tool_20230712.md\":\"BZF1BOpr\",\"blogs_tool_20230716.md\":\"CnVdPVI2\",\"blogs_tool_20240613.md\":\"DoBYGXCE\",\"blogs_tool_index.md\":\"6c0U5q2e\",\"blogs_visualization_canvas_0810.md\":\"Dnjb8kYA\",\"blogs_hide_javascript题目.md\":\"Bf1gPDc7\",\"blogs_visualization_svg_20231012.md\":\"YAabAOQG\",\"blogs_visualization_webgl_index.md\":\"CsEHWSUi\",\"blogs_word_2022_0620.md\":\"CheEs9_y\",\"blogs_word_2022_0621.md\":\"XGE6hvfI\",\"blogs_word_2022_0715.md\":\"DAi3ktb4\",\"blogs_word_2022_0722.md\":\"HKkI-a6z\",\"blogs_word_2022_0723.md\":\"D-ATG2Fb\",\"blogs_word_2022_0725.md\":\"XDEX-sve\",\"blogs_word_2022_0730.md\":\"Ct5rRF5G\",\"blogs_word_2022_0815.md\":\"DN5AxkzI\",\"blogs_word_2022_0825.md\":\"CZZIj5UF\",\"blogs_word_2022_0902.md\":\"DWNE2mU5\",\"blogs_word_2022_0910.md\":\"Ch8zI5ax\",\"blogs_word_2022_0925.md\":\"Fw27-1Uf\",\"blogs_word_2022_1002.md\":\"15KfHjmA\",\"blogs_word_2023_0205.md\":\"2X0LRAkp\",\"blogs_word_2023_0207.md\":\"BxrgFZJJ\",\"blogs_word_2023_0402.md\":\"BAKSrccp\",\"blogs_word_2023_0506.md\":\"DcCEg-6x\",\"blogs_word_2023_0507.md\":\"BuuITMjc\",\"blogs_word_2023_0509.md\":\"Cl0LOIba\",\"blogs_tool_20210718.md\":\"D54vdRgR\",\"blogs_word_2023_0522.md\":\"BlFanhL4\",\"blogs_word_2023_0602.md\":\"Bv-LNjOZ\",\"blogs_word_2023_0605.md\":\"DNxY7ObA\",\"blogs_word_2023_0606.md\":\"CJDx37My\",\"blogs_word_2023_0608.md\":\"BiOYSeof\",\"blogs_word_2023_0609.md\":\"CyPilwNt\",\"blogs_word_2023_0613.md\":\"Cy20hFfn\",\"blogs_word_2023_0701.md\":\"1Ss_8KI0\",\"blogs_word_2023_0706.md\":\"Dt1ZCp2M\",\"blogs_word_2023_0709.md\":\"BYZ5c1a0\",\"blogs_word_2023_0718.md\":\"qoBXDg9-\",\"blogs_word_2023_0725.md\":\"mSS4quCn\",\"blogs_word_2023_0811.md\":\"BCU2fEau\",\"blogs_word_2023_0812.md\":\"Bi88jV9Z\",\"blogs_word_2023_0813.md\":\"CG7ucVci\",\"blogs_word_2023_0815.md\":\"CJyeScJ7\",\"blogs_word_2023_0825.md\":\"Bf-mE8wz\",\"blogs_word_2023_0826.md\":\"CzOh9JcL\",\"blogs_word_2023_0902.md\":\"8oOIl3y2\",\"blogs_word_2023_0910.md\":\"CJS2XLox\",\"blogs_word_2023_0912.md\":\"B54fiJ0R\",\"blogs_word_2023_1022.md\":\"DqbpLw7T\",\"blogs_word_2024_20240319.md\":\"iASLL5Pl\",\"blogs_word_2024_20240321.md\":\"DR4Seo1y\",\"blogs_word_2024_20240716.md\":\"BY_pKoCr\",\"blogs_word_2024_20240722.md\":\"CzSFbF96\",\"blogs_word_2024_20240822.md\":\"C9FNDAVF\",\"blogs_word_2024_20240830.md\":\"DQ7z4cHg\",\"blogs_word_2024_20240909.md\":\"D5_hp6ND\",\"blogs_word_2024_20240925.md\":\"DpE9ta3x\",\"blogs_word_2024_20241010.md\":\"4Dwz_Cb4\",\"blogs_word_2024_20241031.md\":\"S4XTxvCW\",\"blogs_word_2024_20241120.md\":\"2CnxZfmf\",\"blogs_word_2024_20241122.md\":\"CWYB-NW0\",\"blogs_word_2024_20241126.md\":\"C_CcAJc1\",\"blogs_word_2024_20241211.md\":\"BN7EAH34\",\"blogs_word_2024_20241229.md\":\"DReiGSgw\",\"blogs_word_2025_20250107.md\":\"CGOPfj8-\",\"blogs_word_2025_20250108.md\":\"BGKpFLhy\",\"blogs_word_2025_20250110.md\":\"fLikVQSt\",\"blogs_word_2025_20250122.md\":\"CQ1OxT4U\",\"blogs_word_2025_20250213.md\":\"Byph8j-T\",\"blogs_word_2025_20250214.md\":\"BdmsLjft\",\"blogs_word_2025_20250218.md\":\"BNzOcII2\",\"blogs_word_2025_20250219.md\":\"BPaJPirx\",\"blogs_word_2025_20250220.md\":\"Bk85Rg4H\",\"blogs_word_2025_20250314.md\":\"VJoiXtPY\",\"blogs_word_2025_20250403.md\":\"VRlcYCyX\",\"blogs_word_2025_20250410.md\":\"CRrYuyCI\",\"blogs_tool_20230625.md\":\"BqPkLW6O\",\"blogs_hide_typescript题目.md\":\"CO9evuSm\",\"blogs_word_2025_20250515.md\":\"7ZiGzgDO\",\"blogs_word_2025_20250516.md\":\"BpQPsw53\",\"blogs_word_2025_20250711.md\":\"DFb2Ecza\",\"blogs_word_2025_20250812-react闭包陷阱与异步权限管理.md\":\"DpmzuYKA\",\"blogs_interview_20241115.md\":\"DE-aMDX5\",\"blogs_word_2025_20250819.md\":\"CrQsds_p\",\"blogs_word_2025_20250826-react事件池化.md\":\"BhDg4MRR\",\"blogs_hide_代码编程题目.md\":\"BNbAt2ZJ\",\"blogs_interview_20200205.md\":\"LQDDOJ7b\",\"blogs_interview_20210105.md\":\"BGy1C__p\",\"blogs_word_2025_20250929-react进阶学习.md\":\"Cv2QjWb2\",\"blogs_interview_20210106.md\":\"Bm7jxJO0\",\"blogs_word_index.md\":\"BmAhflaZ\",\"blogs_interview_20210107.md\":\"CrW1STdk\",\"blogs_interview_20210606.md\":\"Cf1IC3HF\",\"index.md\":\"DQUz6ClE\",\"blogs_interview_20210608.md\":\"fxz1rB-l\",\"blogs_interview_20210808.md\":\"8Z7HITJU\",\"blogs_interview_20211112.md\":\"9BzxVaw9\",\"blogs_interview_20211223.md\":\"DPwnXhcs\",\"blogs_word_2023_0719.md\":\"BPoEN1Do\",\"blogs_word_2022_1012.md\":\"D0OyKrz0\",\"blogs_interview_20211224.md\":\"CUSq9TpA\",\"blogs_tool_20220701.md\":\"DbiWtr0n\",\"blogs_interview_20241118.md\":\"CDxXORD3\",\"blogs_interview_20211226.md\":\"I-OFBnJy\",\"blogs_tool_20230615.md\":\"Dt2ODkVe\",\"blogs_hide_vue生态题目.md\":\"Drh1L-d_\",\"blogs_visualization_webgl_webgl.md\":\"CR94PQGA\",\"blogs_interview_20220718.md\":\"BCNG-KRz\",\"blogs_interview_20241116.md\":\"CKgeR_IR\",\"blogs_javascript_jstips_20200103.md\":\"ClTQAMgu\",\"blogs_visualization_three_20241121.md\":\"CsTxhNIE\",\"blogs_visualization_three_20241122.md\":\"CY1i4W8t\",\"blogs_visualization_three_index.md\":\"ClQU5803\",\"blogs_visualization_three_threejs.md\":\"Ctr3G5H5\",\"blogs_engineering_webpack.md\":\"BYiu2cyG\",\"blogs_visualization_canvas_20241205.md\":\"JVSKPd7C\",\"blogs_visualization_canvas_20241206.md\":\"CzoPR386\",\"blogs_visualization_canvas_canvas.md\":\"CtUQqDAf\",\"blogs_word_2024_20240902.md\":\"C-s2xTR0\",\"blogs_word_2024_20241226.md\":\"SumyIkno\",\"blogs_javascript_es6_20220908.md\":\"CnzkvnWh\",\"blogs_javascript_es6_20221011.md\":\"BFLAQ3Ls\",\"blogs_javascript_es6_20221012.md\":\"UiyNA_w2\",\"blogs_javascript_jstips_20200102.md\":\"Fy8SYsHK\",\"blogs_visualization_canvas_index.md\":\"CHnA3vMG\",\"blogs_note_20251024-shader随机与噪声.md\":\"CVFG4UsS\",\"blogs_word_2024_20241217.md\":\"B6ynQC9K\",\"blogs_word_2024_20241225.md\":\"BHYvJOUZ\",\"blogs_visualization_index.md\":\"CazitDAx\",\"blogs_word_2025_20250703.md\":\"Dq9Vg-Vd\",\"blogs_visualization_svg_index.md\":\"Buw28F3P\",\"blogs_interview_20241122.md\":\"CDuWaRKf\",\"blogs_interview_index.md\":\"Di3t3Dk6\",\"blogs_tool_20210412.md\":\"ewHK6zhE\",\"blogs_note_20251023-shader初学.md\":\"CFr2rylg\",\"blogs_word_2025_20250924-agi全栈项目.md\":\"vOomQZNb\",\"blogs_word_2022_0206.md\":\"BTntrg35\",\"blogs_word_2025_20250918-性能问题排查.md\":\"dZjTV3iP\",\"blogs_word_2022_0403.md\":\"D0Q78RHD\",\"blogs_visualization_three_20240606.md\":\"DxH2RwPu\",\"blogs_visualization_three_20240712.md\":\"Cl_N6nv9\",\"blogs_word_2025_20250117.md\":\"L6e-8nfS\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"EnlightenCode\",\"description\":\"EnlightenCode,ergo,blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"EnlightenCode\",\"nav\":[{\"text\":\"我的产品\",\"link\":\"/blogs/product/\"},{\"text\":\"工具库\",\"link\":\"/blogs/favorites/\",\"activeMatch\":\"/blogs/favorites/\"},{\"text\":\"学习笔记\",\"link\":\"/blogs/note/\",\"activeMatch\":\"/blogs/note/\"},{\"text\":\"工作随记\",\"link\":\"/blogs/word/\",\"activeMatch\":\"/blogs/word/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"前端基础\",\"items\":[{\"text\":\"CSS\",\"link\":\"/blogs/css//\"},{\"text\":\"Javascript\",\"link\":\"/blogs/javascript/\"}]},{\"text\":\"前端框架\",\"items\":[{\"text\":\"vue\",\"link\":\"/blogs/frame/vue/\"},{\"text\":\"react\",\"link\":\"/blogs/frame/react/\"}]},{\"text\":\"前端进阶\",\"items\":[{\"text\":\"工程化\",\"link\":\"/blogs/engineering/\"},{\"text\":\"浏览器与网络\",\"link\":\"/blogs/frontpromote/browser&network/\"},{\"text\":\"性能优化\",\"link\":\"/blogs/frontpromote/performance/\"}]},{\"text\":\"前端可视化\",\"items\":[{\"text\":\"canvas\",\"link\":\"/blogs/visualization/canvas/\"},{\"text\":\"svg\",\"link\":\"/blogs/visualization/svg/\"},{\"text\":\"ThreeJS\",\"link\":\"/blogs/visualization/three/\"},{\"text\":\"WebGL\",\"link\":\"/blogs/visualization/webgl/\"}]}]},{\"text\":\"后端\",\"items\":[{\"text\":\"node\",\"link\":\"/blogs/backend/node/\"},{\"text\":\"nest\",\"link\":\"/blogs/backend/nest/\"}]},{\"text\":\"面试\",\"link\":\"/blogs/interview/\"},{\"text\":\"算法\",\"link\":\"/blogs/algorithm/\"},{\"text\":\"图像工具集\",\"link\":\"https://imgprocessing.liuhuakawaii.icu\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/liuhuakawaii\"},{\"icon\":\"twitter\",\"link\":\"...\"}],\"sidebar\":{\"/blogs/\":[{\"text\":\"前端基础\",\"items\":[{\"text\":\"HTML基础知识\",\"link\":\"/blogs/note/html.md\"},{\"text\":\"CSS\",\"items\":[{\"text\":\"CSS基础知识\",\"link\":\"/blogs/note/css.md\"},{\"text\":\"CSS技巧\",\"link\":\"/blogs/css/csstips/\"},{\"text\":\"CSS Demo\",\"link\":\"/blogs/css/demo/\"}],\"link\":\"/blogs/css/\"},{\"text\":\"JavaScript\",\"items\":[{\"text\":\"JavaScript基础知识\",\"link\":\"/blogs/note/js\"},{\"text\":\"类型转换\",\"link\":\"/blogs/javascript/jstips/20220705\"},{\"text\":\"原型和原型链\",\"link\":\"/blogs/javascript/es6/20230301\"},{\"text\":\"事件循环\",\"link\":\"/blogs/frontpromote/browser&network/20210820\"},{\"text\":\"ES6进阶知识\",\"link\":\"/blogs/javascript/es6/\"}],\"link\":\"/blogs/javascript/\"},{\"text\":\"前端框架\",\"items\":[{\"text\":\"Vue\",\"link\":\"/blogs/frame/vue/\"},{\"text\":\"React\",\"link\":\"/blogs/frame/react/\"}]}],\"link\":\"/blogs/note/\",\"collapsible\":true},{\"text\":\"前端进阶\",\"items\":[{\"text\":\"前端工程化\",\"items\":[{\"text\":\"工程化详解\",\"link\":\"/blogs/engineering/20240910\"},{\"text\":\"Webpack 5 配置\",\"link\":\"/blogs/tool/20210718\"}],\"link\":\"/blogs/engineering/\"},{\"text\":\"前端可视化\",\"items\":[{\"text\":\"ThreeJS\",\"link\":\"/blogs/visualization/three/\"},{\"text\":\"canvas\",\"link\":\"/blogs/visualization/canvas/\"},{\"text\":\"svg\",\"link\":\"/blogs/visualization/svg/\"},{\"text\":\"WebGL\",\"link\":\"/blogs/visualization/webgl/\"}],\"link\":\"/blogs/visualization/\",\"collapsible\":true},{\"text\":\"浏览器与网络\",\"link\":\"/blogs/frontpromote/browser&network/\"},{\"text\":\"性能优化\",\"link\":\"/blogs/frontpromote/performance/\"},{\"text\":\"算法\",\"items\":[{\"text\":\"排序算法\",\"link\":\"/blogs/algorithm/20220212\"},{\"text\":\"栈与队列\",\"link\":\"/blogs/algorithm/20221209\"},{\"text\":\"数组与链表核心技巧\",\"link\":\"/blogs/algorithm/20221118\"}],\"link\":\"/blogs/algorithm/\",\"collapsible\":true}],\"collapsible\":true},{\"text\":\"前端面试\",\"items\":[{\"text\":\"CSS专题\",\"link\":\"/blogs/interview/20241116.md\"},{\"text\":\"JavaScript专题\",\"link\":\"/blogs/interview/20241115.md\"},{\"text\":\"浏览器专题\",\"link\":\"/blogs/frontpromote/browser&network/20241117.md\"},{\"text\":\"工程化专题\",\"link\":\"/blogs/interview/20241118.md\"},{\"text\":\"网络专题\",\"link\":\"/blogs/frontpromote/browser&network/20241120.md\"},{\"text\":\"算法专题\",\"link\":\"/blogs/interview/20241122.md\"}],\"link\":\"/blogs/interview/\",\"collapsible\":true},{\"text\":\"后端\",\"items\":[{\"text\":\"node\",\"link\":\"/blogs/backend/node\"},{\"text\":\"nest\",\"link\":\"/blogs/backend/nest\"}],\"link\":\"/blogs/backend/\",\"collapsible\":true}]},\"outlineTitle\":\"目录\",\"outline\":[2,6],\"search\":{\"provider\":\"local\",\"options\":{\"translations\":{\"button\":{\"buttonText\":\"Search\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>